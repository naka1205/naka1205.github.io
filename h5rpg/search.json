[{"title":"\u51c6\u5907","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/C3D207FADFAF5841.html","content":"\u51c6\u5907\n\u7b2c\u4e00\u6b65\u5f53\u7136\u662f\u51c6\u5907\u5de5\u4f5c\u4e86\u3002\n\u9996\u5148\uff0c\u786e\u8ba4\u4f60\u7684\u6d4f\u89c8\u5668\u7248\u672c\u5bf9HTML5\u7684\u652f\u6301\u3002\n\u5176\u6b21\uff0c\u51c6\u5907\u597d\u5f00\u53d1\u5de5\u5177\u3002\nIDE\u8fd9\u4e2a\u770b\u5404\u81ea\u7684\u559c\u597d\uff0c\u652f\u6301Web\u5f00\u53d1\u5c31\u884c\u3002\nPrototype.js \u662fSam Stephenson\u5199\u7684\u4e00\u4e2a\u975e\u5e38\u4f18\u96c5\u7684JavaScript\u57fa\u7840\u7c7b\u5e93\uff0c\u5bf9JavaScript\u505a\u4e86\u5927\u91cf\u7684\u6269\u5c55\uff0c\u800c\u4e14\u5f88\u597d\u7684\u652f\u6301Ajax\u3002\nPrototype.js\u7684\u4f7f\u7528\u65b9\u6cd5\u5728\u7f51\u7edc\u6709\u5927\u91cf\u7684\u4ecb\u7ecd\uff0c\u6211\u8fd9\u91cc\u7528\u5230\u662f\u4e00\u4e2a\u7b80\u5316\u7248\uff0c\u53ea\u4fdd\u7559\u4e86\u7c7b\u7684\u5b9e\u73b0\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\nvar Prototype = {\n    emptyFunction: function() { }\n};\nvar Class = {\n    create: function() {\n        var parent = null, properties = $A(arguments);\n        if (Object.isFunction(properties[0]))\n            parent = properties.shift();\n        function klass() {\n            this.initialize.apply(this, arguments);\n        }\n        Object.extend(klass, Class.Methods);\n        klass.superclass = parent;\n        klass.subclasses = [];\n        if (parent) {\n            var subclass = function() { };\n            subclass.prototype = parent.prototype;\n            klass.prototype = new subclass;\n            parent.subclasses.push(klass);\n        }\n        for (var i = 0; i &lt; properties.length; i++)\n            klass.addMethods(properties[i]);\n\n        if (!klass.prototype.initialize)\n            klass.prototype.initialize = Prototype.emptyFunction;\n        klass.prototype.constructor = klass;\n        return klass;\n    }\n};\nClass.Methods = {\n    addMethods: function(source) {\n        var ancestor = this.superclass &amp;&amp; this.superclass.prototype;\n        var properties = Object.keys(source);\n        if (!Object.keys({ toString: true }).length)\n            properties.push(\"toString\", \"valueOf\");\n        for (var i = 0, length = properties.length; i &lt; length; i++) {\n            var property = properties[i], value = source[property];\n            if (ancestor &amp;&amp; Object.isFunction(value) &amp;&amp; value.argumentNames().first() == \"$super\") {\n                var method = value;\n                value = (function(m) {\n                    return function() { return ancestor[m].apply(this, arguments) };\n                })(property).wrap(method);\n                value.valueOf = method.valueOf.bind(method);\n                value.toString = method.toString.bind(method);\n            }\n            this.prototype[property] = value;\n        }\n        return this;\n    }\n};\nObject.extend = function(destination, source) {\n    for (var property in source)\n        destination[property] = source[property];\n    return destination;\n};\nfunction $A(iterable) {\n    if (!iterable) return [];\n    if (iterable.toArray) return iterable.toArray();\n    var length = iterable.length || 0, results = new Array(length);\n    while (length--) results[length] = iterable[length];\n    return results;\n}\nObject.extend(Object, {\n    keys: function(object) {\n        var keys = [];\n        for (var property in object)\n            keys.push(property);\n        return keys;\n    },\n    isFunction: function(object) {\n        return typeof object == \"function\";\n    },\n    isUndefined: function(object) {\n        return typeof object == \"undefined\";\n    }\n});\nObject.extend(Function.prototype, {\n    argumentNames: function() {\n        var names = this.toString().match(\/^[\\s\\(]*function[^(]*\\(([^\\)]*)\\)\/)[1].replace(\/\\s+\/g, '').split(',');\n        return names.length == 1 &amp;&amp; !names[0] ? [] : names;\n    },\n    bind: function() {\n        if (arguments.length &lt; 2 &amp;&amp; Object.isUndefined(arguments[0])) return this;\n        var __method = this, args = $A(arguments), object = args.shift();\n        return function() {\n            return __method.apply(object, args.concat($A(arguments)));\n        }\n    },\n    wrap: function(wrapper) {\n        var __method = this;\n        return function() {\n            return wrapper.apply(this, [__method.bind(this)].concat($A(arguments)));\n        }\n    }\n});\nObject.extend(Array.prototype, {\n    first: function() {\n        return this[0];\n    }\n});\n\u6700\u540e\u662f\u5f00\u53d1RPG\u6e38\u620f\u7528\u7684\u8d44\u6e90\u3002\n\u5728\u8fd9\u4e2a\u4e92\u8054\u7f51\u65f6\u4ee3\uff0c\u6700\u4e0d\u7f3a\u7684\u5c31\u662f\u8d44\u6e90\u4e86\uff0c\u8fd9\u91cc\u63a8\u835066RPG\u7f51\u7ad9\uff0cRPG\u6e38\u620f\u5f00\u53d1\u8d44\u6e90\u5f88\u4e30\u5bcc\u3002\n\u5168\u90e8\u51c6\u5907\u597d\u540e\uff0c\u5c31\u8fdb\u5165\u4e0b\u4e00\u4e2a\u6b65\u9aa4\u5427\u3002","categories":"\u7b2c\u4e00\u6b65","tags":["HTML5"]},{"title":"\u8d44\u6e90\u9884\u52a0\u8f7d","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/9C30FBE79FB13821.html","content":"\u8d44\u6e90\u9884\u52a0\u8f7d\n\u4e3a\u4ec0\u4e48\u9700\u8981\u8d44\u6e90\u9884\u52a0\u8f7d\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a\u5982\u679c\u7b49\u5230\u4f7f\u7528\u65f6\u624d\u52a0\u8f7d\u8d44\u6e90\uff0c\u5f53\u8d44\u6e90\u8fc7\u5927\u6216\u7f51\u7edc\u4e0d\u597d\u65f6\uff0c\u52a0\u8f7d\u65f6\u95f4\u8fc7\u957f\uff0c\u4f1a\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\u8d44\u6e90\u9884\u52a0\u8f7d\u53ef\u4ee5\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u6539\u5584\u8fd9\u79cd\u60c5\u51b5\u3002\n\u6211\u4eec\u8fd9\u91cc\u9700\u8981\u9884\u52a0\u8f7d\u7684\u8d44\u6e90\u5305\u62ec\u56fe\u7247\u548c\u58f0\u97f3\uff0c\u8d44\u6e90\u5b9a\u4e49\u793a\u4f8b\u5982\u4e0b\uff1a\nvar ResourceData= {\n    Images:{\n        \/\/path\uff1a\u6587\u4ef6\u76f8\u5bf9\u8def\u5f84\uff0cpicNum:\u5f53\u524d\u56fe\u7247\u4e2d\u5bbd\u548c\u9ad8\u5305\u542b\u7684\u5c0f\u56fe\u7247\u6570\uff0ccellSize:\u5c0f\u56fe\u7247\u7684\u5bbd\u548c\u9ad8\uff0cdata\uff1a\u5b58\u653e\u52a0\u8f7d\u7684\u56fe\u7247\u6570\u636e\u3002\n        images001:{path:\"images\/images001.png\", picNum:{WNum:2,HNum:6},cellSize:{width:32,height:32}, data:null}\n        ,images002:{path:\"images\/images002.png\", picNum:{WNum:1,HNum:1},cellSize:{width:96,height:96}, data:null}\n    },\n    Sound:{\n        \/\/soundName:\u58f0\u97f3\u6587\u4ef6\u540d\u79f0\uff0cpath\uff1a\u6587\u4ef6\u5939\u76f8\u5bf9\u8def\u5f84\uff0cdata\uff1a\u5b58\u653e\u52a0\u8f7d\u7684\u58f0\u97f3\u6570\u636e\u3002\u7531\u4e8e\u5404\u79cd\u6d4f\u89c8\u5668\u5bf9\u58f0\u97f3\u683c\u5f0f\u7684\u652f\u6301\u4e0d\u4e00\u81f4\uff0c\u58f0\u97f3\u6587\u4ef6\u683c\u5f0f\u6709MP3\u548cOGG\u4e24\u79cd\n        sound001:{soundName:\"sound001\",path:\"sound\/\", data:null}\n        ,sound002:{soundName:\"sound002\",path:\"sound\/\", data:null}\n    }\n}\n\u8d44\u6e90\u5b9a\u4e49\u597d\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9e\u73b0\u9884\u52a0\u8f7d\u4e86\uff0c\u52a0\u8f7d\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a\n\nJFunction.PreLoadData = function () {\n    var loadedNum = 0;\/\/\u5df2\u52a0\u8f7d\u8d44\u6e90\u6570\u91cf\n    var resourceNum = 0;\/\/\u8d44\u6e90\u6570\u91cf\n    var postAction = function () {};\/\/\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210\u540e\u7684\u56de\u8c03\u51fd\u6570\n    function imageLoadPost() {\/\/\u6bcf\u6210\u529f\u52a0\u8f7d\u4e00\u4e2a\u56fe\u7247\u6267\u884c\u4e00\u6b21\n        loadedNum++;\n        if (loadedNum == resourceNum) {\/\/\u5168\u90e8\u56fe\u7247\u6587\u4ef6\u52a0\u8f7d\u5b8c\u540e\uff0c\u7ee7\u7eed\u52a0\u8f7d\u58f0\u97f3\n            loadedNum=0;\n            resourceNum=0;\n            loadAudio()\n        }\n    }\n    function audioLoadPost() {\/\/\u6bcf\u6210\u529f\u52a0\u8f7d\u4e00\u4e2a\u58f0\u97f3\u6267\u884c\u4e00\u6b21\n        loadedNum++;\n        if (loadedNum == resourceNum) {\/\/\u5168\u90e8\u58f0\u97f3\u6587\u4ef6\u52a0\u8f7d\u5b8c\u540e\uff0c\u6267\u884c\u56de\u8c03\u51fd\u6570\n            postAction()\n        }\n    }\n    function loadImage(){\/\/\u52a0\u8f7d\u56fe\u7247\n        for (var m2 in ResourceData.Images)  resourceNum++;\n        for (var m2 in ResourceData.Images) {\n            ResourceData.Images[m2].data = new Image();\n            ResourceData.Images[m2].data.src = ResourceData.Images[m2].path;\n            ResourceData.Images[m2].data.onload = function () {\n                imageLoadPost();\n            }\n            ResourceData.Images[m2].data.onerror = function () {\n                alert(\"\u8d44\u6e90\u52a0\u8f7d\u5931\u8d25\uff01\")\n                return;\n            }\n        }\n    }\n    function loadAudio(){\/\/\u52a0\u8f7d\u58f0\u97f3\n        for (var m1 in ResourceData.Sound)  resourceNum++;\n        for (var m1 in ResourceData.Sound) {\n            ResourceData.Sound[m1].data = new Audio();\n            var playMsg = ResourceData.Sound[m1].data.canPlayType('video\/ogg');\/\/\u6d4b\u8bd5\u6d4f\u89c8\u5668\u662f\u5426\u652f\u6301\u8be5\u683c\u5f0f\u58f0\u97f3\n            if (\"\" != playMsg) {\n                ResourceData.Sound[m1].data.src= ResourceData.Sound[m1].path + ResourceData.Sound[m1].soundName + \".ogg\";\n            } else {\n                ResourceData.Sound[m1].data.src= ResourceData.Sound[m1].path + ResourceData.Sound[m1].soundName + \".mp3\";\n            }\n            ResourceData.Sound[m1].data.addEventListener(\"canplaythrough\", function () {\n                audioLoadPost();\n            }, false);\n            ResourceData.Sound[m1].data.addEventListener(\"error\", function () {\n                alert(\"\u8d44\u6e90\u52a0\u8f7d\u5931\u8d25\uff01\")\n                return;\n            }, false);\n        }\n    }\n    loadImage();\n    return {\n        done:function (f) {\n            if (f)postAction = f;\n        }\n    }\n};\n\u8c03\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a\nJFunction.PreLoadData().done(function(){\n    \/\/\u6240\u6709\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u6267\u884c\u8be5\u5904\u4ee3\u7801\n});","categories":"\u7b2c\u4e8c\u6b65","tags":["HTML5"]},{"title":"\u57fa\u672c\u5bf9\u8c61\u8bbe\u8ba1\uff08\u4e00\uff09","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/D76025B918B5C635.html","content":"\u57fa\u672c\u5bf9\u8c61\u8bbe\u8ba1\uff08\u4e00\uff09\n\u901a\u8fc7\u5206\u6790\u57fa\u672c\u5bf9\u8c61\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u51e0\u7c7b\uff1a\n1\u3001\u6e38\u620f\u4e3b\u7a97\u4f53\n2\u3001\u6587\u5b57\n3\u3001\u6309\u94ae\n4\u3001\u56fe\u7247\n5\u3001\u52a8\u753b\n6\u3001\u5bb9\u5668\n7\u3001\u5bf9\u8bdd\u6846\n8\u3001\u58f0\u97f3\n9\u3001\u65f6\u949f\n\u524d\u9762\u4e03\u79cd\u90fd\u662f\u53ef\u89c6\u7684\u3002\u6240\u4ee5\u4e3a\u4ed6\u4eec\u5199\u4e00\u4e2a\u7236\u7c7b\uff0c\u901a\u8fc7\u7ee7\u627f\u4ee5\u63d0\u9ad8\u4ee3\u7801\u5229\u7528\u7387\u3002\n\u540e\u4e24\u79cd\u6ca1\u6709\u4ec0\u4e48\u5171\u540c\u70b9\uff0c\u53ea\u80fd\u5355\u72ec\u5199\u4e86\u3002\n\u7236\u7c7b\u4ee3\u7801\u5982\u4e0b\uff1a\nvar JControls = {};\nJControls.Object= Class.create({\n    name:null,\/\/\u5bf9\u8c61\u540d\u79f0\uff0c\u9700\u552f\u4e00\n    position:null, \/\/\u7edd\u5bf9\u4f4d\u7f6e{x:0,y:0}\n    alpha:null,\/\/\u900f\u660e\u5ea6\n    moveStep:null, \/\/\u79fb\u52a8\u6b65\u4f10{x:0,y:0}\n    canMove:true, \/\/\u662f\u5426\u53ef\u79fb\u52a8\n    size:null, \/\/\u5bf9\u8c61\u957f\u5bbd{width:0,height:0}\n    blockAngle:null, \/\/\u65cb\u8f6c\u89d2\u5ea6\n    rotationStep:null, \/\/\u65cb\u8f6c\u6b65\u4f10\n    blockInvert:null,\/\/\u662f\u5426\u53cd\u8f6c\n    bgColor:null,\/\/\u80cc\u666f\u989c\u8272\n    BGColorAlpha:null,\/\/\u80cc\u666f\u989c\u8272\u900f\u660e\u5ea6\n    BGImage:null,\/\/\u80cc\u666f\u56fe\u7247\n    BGImageAlpha:null,\/\/\u80cc\u666f\u900f\u660e\u5ea6\n    BGImagePosition:null,\/\/\u80cc\u666f\u56fe\u7247\u5f00\u59cb\u663e\u793a\u4f4d\u7f6e\n    BGImageSize:null,\/\/\u80cc\u666f\u56fe\u7247\u663e\u793a\u7684\u957f\u5bbd\n    focus:null,\/\/\u662f\u5426\u4e3a\u7126\u70b9\n    controls:null,\/\/\u5b50\u5bf9\u8c61\u6570\u7ec4\n    parent:null,\/\/\u7236\u5bf9\u8c61\n    relativePosition:null, \/\/\u4e0e\u7236\u5bf9\u8c61\u7684\u76f8\u5bf9\u4f4d\u7f6e\n    enabled:null,\/\/\u662f\u5426\u4e3a\u6fc0\u6d3b\u72b6\u6001\n    visible:null,\/\/\u662f\u5426\u663e\u793a\n    showImageData:null,\/\/\u8be5\u5bf9\u8c61\u4ee5\u53ca\u5176\u5b50\u5bf9\u8c61\u7684\u7f13\u5b58\u56fe\u7247\u6570\u636e\n    isHighLight:null,\/\/\u662f\u5426\u9ad8\u4eae\n    setSize:function (size) {\/\/\u8bbe\u7f6e\u5bbd\u9ad8\n        this.size = size;\n        return this;\n    },\n    setBGColor:function (bgColor) {\/\/\u8bbe\u7f6e\u80cc\u666f\u989c\u8272\n        this.BGColor = bgColor;\n        return this;\n    },\n    setBGImage:function (image) {\/\/\u8bbe\u7f6e\u80cc\u666f\u56fe\u7247\n        this.BGImage = image.data;\n        this.BGImagePosition={x:0,y:0};\n        this.BGImageSize={width:image.cellSize.width,height:image.cellSize.height};\n        return this;\n    },\n    setRelativePosition:function (relativePosition) {\/\/\u8bbe\u7f6e\u4e0e\u7236\u5bf9\u8c61\u7684\u76f8\u5bf9\u4f4d\u7f6e\n        this.relativePosition = relativePosition;\n        return this;\n    },\n    setFocus:function(fun){\/\/\u83b7\u53d6\u7126\u70b9\n        if(fun)fun();\n        if(JFocusControl)JFocusControl.lostFocus();\n        this.focus=true;\n        JFocusControl=this;\n    },\n    lostFocus:function(){\/\/\u5931\u53bb\u7126\u70b9\n        this.focus=false;\n        JFocusControl=null;\n    },\n    pointInBlock:function (e, _this) {\/\/\u5224\u65ad_this\u5bf9\u8c61\u662f\u5426\u5305\u542b\u5750\u6807e\n        if (!_this)_this = this;\n        if (e.x &gt;= _this.position.x &amp;&amp; e.x &lt; _this.position.x + _this.size.width &amp;&amp; e.y &gt;= _this.position.y &amp;&amp; e.y &lt; _this.position.y + _this.size.height) return true;\n        else return false;\n    },\n    onControlClick:function () {\/\/\u70b9\u51fb\u5bf9\u8c61\u65f6\uff0c\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\n        if (!this.visible || !this.enabled)return false;\n        for (var i = this.controls.length - 1; i &gt;= 0; i--) {\n            if (this.controls[i].pointInBlock(JForm.mousePosition, this.controls[i])\n                &amp;&amp; this.controls[i].onControlClick.call(this.controls[i])) return true;\n        }\n        if (this.onClick &amp;&amp; this.onClick())return true;\/\/\u5982\u679c\u6709\u81ea\u5b9a\u4e49\u70b9\u51fb\u4e8b\u4ef6\u5e76\u4e14\u6267\u884c\u540e\u8fd4\u56detrue\uff0c\u5219\u8fd4\u56detrue\u505c\u6b62\u9012\u5f52\uff0c\u7ed3\u675f\u70b9\u51fb\u4e8b\u4ef6\n        else return false;\/\/\u8fd4\u56defalse\u7ee7\u7eed\u904d\u5386\n    },\n    onControlMouseDown:function () {\/\/\u70b9\u51fb\u5bf9\u8c61\u65f6\uff0c\u9f20\u6807\u952e\u6309\u4e0b\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\n        if (!this.visible || !this.enabled)return false;\n        for (var i = this.controls.length - 1; i &gt;= 0; i--) {\n            if (this.controls[i].pointInBlock(JForm.mousePosition, this.controls[i])\n                &amp;&amp; this.controls[i].onControlMouseDown.call(this.controls[i])) return true;\n        }\n        if (this.onMouseDown &amp;&amp; this.onMouseDown())return true;\n        else return false;\n    },\n    onControlMouseUp:function () {\/\/\u70b9\u51fb\u5bf9\u8c61\u65f6\uff0c\u9f20\u6807\u952e\u5f39\u8d77\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\n        if (!this.visible || !this.enabled)return false;\n        for (var i = this.controls.length - 1; i &gt;= 0; i--) {\n            if (this.controls[i].pointInBlock(JForm.mousePosition, this.controls[i])\n                &amp;&amp; this.controls[i].onControlMouseUp.call(this.controls[i])) return true;\n        }\n        if (this.onMouseUp &amp;&amp; this.onMouseUp())return true;\n        return false;\n    },\n    onControlKeyDown:function () {\/\/\u952e\u76d8\u6309\u4e0b\u65f6\uff0c\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\n        if (!this.visible || !this.enabled)return false;\n        for (var i = this.controls.length - 1; i &gt;= 0; i--) {\n            if (this.controls[i].onControlKeyDown.call(this.controls[i])) return true;\n        }\n        if (this.onKeyDown &amp;&amp; this.onKeyDown())return true;\n        else return false;\n    },\n    onControlKeyUp:function () {\/\/\u952e\u76d8\u5f39\u8d77\u65f6\uff0c\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\n        if (!this.visible || !this.enabled)return false;\n        for (var i = this.controls.length - 1; i &gt;= 0; i--) {\n            if (this.controls[i].onControlKeyUp.call(this.controls[i])) return true;\n        }\n        if (this.onKeyUp &amp;&amp; this.onKeyUp())return true;\n        else return false;\n    },\n    onClick:null,\/\/\u81ea\u5b9a\u4e49\u70b9\u51fb\u4e8b\u4ef6\n    onMouseDown:null,\/\/\u81ea\u5b9a\u4e49\u9f20\u6807\u952e\u6309\u4e0b\u4e8b\u4ef6\n    onMouseUp:null,\/\/\u81ea\u5b9a\u4e49\u9f20\u6807\u952e\u5f39\u8d77\u4e8b\u4ef6\n    onKeyDown:null,\/\/\u81ea\u5b9a\u4e49\u952e\u76d8\u6309\u4e0b\u4e8b\u4ef6\n    onKeyUp:null,\/\/\u81ea\u5b9a\u4e49\u952e\u76d8\u5f39\u8d77\u4e8b\u4ef6\n    addControlInLast:function (aObj) {\/\/\u628a\u5bf9\u8c61\u6570\u7ec4aObj\u52a0\u5728\u5b50\u5bf9\u8c61\u6570\u7ec4\u540e\u9762\n        for (var i = 0; i &lt; aObj.length; i++) {\n            if (aObj[i]) {\n                var length = this.controls.length;\n                this.controls[length] = aObj[i];\n                this.controls[length].parent = this;\n                this.controls[length].position = {x:this.position.x + this.controls[length].relativePosition.x,\n                    y:this.position.y + this.controls[length].relativePosition.y};\n            }\n        }\n    },\n    removeControl:function (objName) {\/\/\u6839\u636e\u5bf9\u8c61\u540d\u79f0\u5220\u9664\u5b50\u5bf9\u8c61\u6570\u7ec4\u4e2d\u7684\u5bf9\u8c61\n        for (var i = 0; i &lt; this.controls.length; i++) {\n            if (objName == this.controls[i].name) {\n                this.controls[i] = null;\n                for (var j = i; j &lt; this.controls.length; j++) {\n                    this.controls[j] = this.controls[j + 1];\n                }\n                this.controls.length = this.controls.length - 1;\n                break;\n            }\n        }\n    },\n    remove:function () {\/\/\u5220\u9664\u5f53\u524d\u5bf9\u8c61\n        if (this.parent) {\n            this.parent.removeControl.call(this.parent, this.name);\n        } else {\n            this.name = null;\n        }\n    },\n    clearControls:function () {\/\/\u6e05\u7a7a\u5b50\u5bf9\u8c61\u6570\u7ec4\n        this.controls = [];\n    },\n    saveShowImageData:function () {\/\/\u4fdd\u5b58\u8be5\u5bf9\u8c61\u4ee5\u53ca\u5176\u5b50\u5bf9\u8c61\u7684\u7f13\u5b58\u56fe\u7247\u6570\u636e\n        var w = parseInt(this.size.width * JZoom.x), h = parseInt(this.size.height * JZoom.y);\n        var relativePosition = this.relativePosition;\n        var parent = this.parent;\n        this.parent = null;\n        this.relativePosition = {x:0, y:0};\n        JForm.canvas.width = w;\n        JForm.canvas.height = h;\n        this.showImageData = null;\n        this.show();\n        this.showImageData = JFunction.getImageData(JForm.context, this.relativePosition, {width:w, height:h});\n        this.parent = parent;\n        this.relativePosition = relativePosition;\n        JForm.canvas.width = parseInt(JForm.size.width * JZoom.x);\n        JForm.canvas.height = parseInt(JForm.size.height * JZoom.y);\n    },\n    beginShow:function () {\/\/\u663e\u793a\u8be5\u5bf9\u8c61\u524d\u6267\u884c\n        this.position.x = this.relativePosition.x;\n        this.position.y = this.relativePosition.y;\n        if (this.parent) {\n            this.position.x += this.parent.position.x;\n            this.position.y += this.parent.position.y;\n        }\n    },\n    showing:function(x, y, w, h){\/\/\u663e\u793a\u8be5\u5bf9\u8c61\u65f6\u6267\u884c\n        for (var member = 0; member &lt; this.controls.length; member++) {\n            this.controls[member].show.call(this.controls[member]);\n        }\n        if (!this.enabled) {\n            var imageData = JFunction.getImageData(JForm.context, {x:x, y:y},{width:w, height:h});\n            JFunction.drawImageData(JForm.context, JFunction.changeToGray(imageData), {x:x, y:y});\n        }\n    },\n    endShow:function () {\/\/\u663e\u793a\u8be5\u5bf9\u8c61\u540e\u6267\u884c\n        if (this.rotationStep) {\n            this.blockAngle += this.rotationStep;\n            this.blockAngle = this.blockAngle % 360;\n        }\n        if (this.canMove &amp;&amp; this.moveStep) {\n            this.relativePosition.x += this.moveStep.x;\n            this.relativePosition.y += this.moveStep.y;\n        }\n    },\n    show:function () {\/\/\u663e\u793a\u8be5\u5bf9\u8c61\n        this.beginShow();\n        if (this.visible) {\n            if (this.showImageData) {\/\/\u5982\u679c\u6709\u7f13\u5b58\u6570\u636e\uff0c\u76f4\u63a5\u7ed8\u56fe\n                JFunction.drawImageData(JForm.context, this.showImageData,\n                    {x:parseInt(this.position.x * JZoom.x), y:parseInt(this.position.y * JZoom.y)});\n            } else {\n                var _context = JForm.context;\n                if (this.name == null)return;\n                var x = parseInt(this.position.x * JZoom.x);\n                var y = parseInt(this.position.y * JZoom.y);\n                var w = parseInt(this.size.width * JZoom.x);\n                var h = parseInt(this.size.height * JZoom.y);\n                if (_context) {\n                    if(this.alpha&lt;1){\/\/\u8bbe\u7f6e\u753b\u5e03\u900f\u660e\u5ea6\n                        _context.save();\n                        _context.globalAlpha=this.alpha;\n                    }\n                    if(this.blockInvert){\/\/\u7ffb\u8f6c\u753b\u5e03\n                        _context.save();\n                        _context.translate(x + parseInt(w \/ 2),0);\n                        _context.scale(-1, 1);\n                        _context.translate((x + parseInt(w \/ 2))*-1,0);\n                    }\n                    if(this.blockAngle){\/\/\u65cb\u8f6c\u753b\u5e03\n                        _context.save();\n                        _context.translate(x + parseInt(w \/ 2), y + parseInt(h \/ 2));\n                        x = -parseInt(w \/ 2);\n                        y = -parseInt(h \/ 2);\n                        _context.rotate(this.blockAngle * Math.PI \/ 180);\n                    }\n                    if (this.BGColor) {\/\/\u7ed8\u5236\u80cc\u666f\u989c\u8272\n                        _context.save();\n                        _context.globalAlpha=this.alpha*this.BGColorAlpha;\n                        _context.fillStyle = this.BGColor.data;\n                        _context.fillRect(x, y, w, h);\n                        _context.restore();\n                    }\n                    if (this.BGImage) {\/\/\u7ed8\u5236\u80cc\u666f\u56fe\u7247\n                        _context.save();\n                        _context.globalAlpha=this.alpha*this.BGImageAlpha;\n                        _context.drawImage(this.BGImage, this.BGImagePosition.x, this.BGImagePosition.y, this.BGImageSize.width,\n                            this.BGImageSize.height, x, y, w, h);\n                        _context.restore();\n                    }\n                    this.showing&amp;&amp;this.showing(x, y, w, h);\/\/\u5982\u679c\u6709showing\u4e8b\u4ef6\uff0c\u5219\u6267\u884c\u8be5\u4e8b\u4ef6\n                    if(this.blockAngle) _context.restore();\/\/\u5982\u679c\u753b\u5e03\u6709\u65cb\u8f6c\u5219\u6062\u590d\u5230\u65cb\u8f6c\u524d\u72b6\u6001\n                    if(this.blockInvert){\/\/\u5982\u679c\u753b\u5e03\u6709\u7ffb\u8f6c\u5219\u6062\u590d\u5230\u7ffb\u8f6c\u524d\u72b6\u6001\n                        _context.translate(JForm.size.width-x - parseInt(w \/ 2),0);\n                        _context.scale(-1, 1);\n                        _context.translate((JForm.size.width-x - parseInt(w \/ 2))*-1,0);\n                        _context.restore();\n                    }\n                    if(this.alpha&lt;1)_context.restore();\/\/\u6062\u590d\u753b\u5e03\u900f\u660e\u5ea6\n                }\n            }\n        }\n        this.endShow();\n    },\n    initialize:function ( argname, argP, argWH) {\/\/\u7c7b\u6784\u9020\u51fd\u6570\uff0c\u521d\u59cb\u5316\u6570\u636e\n        this.name = argname;\n        this.position = argP;\n        this.size = argWH;\n        this.BGColorAlpha = 1.0;\n        this.BGImageAlpha = 1.0;\n        this.moveStep = {x:0, y:0};\n        this.fontColor=JColor.black;\n        this.textPos={x:0, y:0};\n        this.alpha=1.0;\n        this.relativePosition = argP;\n        this.controls = [];\n        this.parent = null;\n        this.enabled = true;\n        this.visible = true;\n    }\n});\n\u5176\u4e2dJColor\u5b9a\u4e49\u5982\u4e0b\uff1a\nvar JColor = {\n    white:{data:\"#FFFFFF\", r:255, g:255, b:255},\n    black:{data:\"#000000\", r:0, g:0, b:0},\n    red:{data:\"#FF0000\", r:255, g:0, b:0},\n    green:{data:\"#00FF00\", r:0, g:255, b:0},\n    blue:{data:\"#0000FF\", r:0, g:0, b:255},\n    gray:{data:\"#999999\", r:144, g:144, b:144}\n};","categories":"\u7b2c\u4e09\u6b65","tags":["HTML5"]},{"title":"\u57fa\u672c\u5bf9\u8c61\u8bbe\u8ba1\uff08\u4e8c\uff09","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/4D5F3CA0A1A7C8C7.html","content":"\u57fa\u672c\u5bf9\u8c61\u8bbe\u8ba1\uff08\u4e8c\uff09\n\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u5b8c\u6210\u4e86\u7236\u5bf9\u8c61\u7684\u7f16\u5199\uff0c\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f\u6765\u5b9e\u73b0\u5404\u5bf9\u8c61\u4e86\u3002\n1\u3001\u6e38\u620f\u4e3b\u7a97\u4f53\u3002\n\u6e38\u620f\u4e3b\u7a97\u4f53\u53ea\u6709\u4e00\u4e2a\uff0c\u6e38\u620f\u4e2d\u7684\u5bf9\u8c61\u663e\u793a\u90fd\u662f\u5728\u4e3b\u7a97\u4f53\u7684\u753b\u5e03\u4e0a\u7ed8\u5236\u7684\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n\nvar JForm = null;\nJControls.Form = Class.create(JControls.Object, {\/\/\u4ece\u7236\u7c7b\u7ee7\u627f\n    context:null,\/\/\u753b\u5e03\u73af\u5883\n    canvas:null,\/\/\u753b\u5e03\n    webPosition:null,\/\/\u4e3b\u7a97\u4f53\u5728Web\u9875\u9762\u4e2d\u5f97\u4f4d\u7f6e\n    mousePosition:null,\/\/\u9f20\u6807\u5728\u4e3b\u7a97\u4f53\u4e2d\u5f97\u76f8\u5bf9\u5750\u6807\n    initialize:function ($super, argname, argP, argWH) {\n        $super(argname, {x:0, y:0}, argWH);\n        this.webPosition = argP;\n        JForm = this;\n        this.setFocus();\/\/\u9ed8\u8ba4\u4e3b\u7a97\u4f53\u83b7\u5f97\u7126\u70b9\n        \/\/\u521b\u5efa\u753b\u5e03\u5bf9\u8c61\n        var f = document.getElementById(this.name);\n        if (f)  f.parentNode.removeChild(f);\n        this.canvas = document.createElement(\"canvas\");\n        this.canvas.id = this.name;\n        this.canvas.style.position = \"absolute\";\n        this.canvas.style.left = this.webPosition.x + \"px\";\n        this.canvas.style.top = this.webPosition.y + \"px\";\n        this.canvas.style.backgroundColor = \"black\";\n        this.canvas.width = parseInt(this.size.width * JZoom.x);\n        this.canvas.height = parseInt(this.size.height * JZoom.y);\n        \/\/\u4e3a\u753b\u5e03\u6dfb\u52a0\u4e8b\u4ef6\n        this.canvas.onclick = function (event) {\n            JForm.mousePosition = {x:parseInt((event.pageX - JForm.webPosition.x) \/ JZoom.x), y:parseInt((event.pageY - JForm.webPosition.y) \/ JZoom.y)};\n            JForm.onControlClick.call(JForm);\n        };\n        this.canvas.onmousedown = function (event) {\n            JForm.mousePosition = {x:parseInt((event.pageX - JForm.webPosition.x) \/ JZoom.x), y:parseInt((event.pageY - JForm.webPosition.y) \/ JZoom.y)};\n            JForm.onControlMouseDown.call(JForm);\n        };\n        this.canvas.onmouseup = function (event) {\n            JForm.mousePosition = {x:parseInt((event.pageX - JForm.webPosition.x) \/ JZoom.x), y:parseInt((event.pageY - JForm.webPosition.y) \/ JZoom.y)};\n            JForm.onControlMouseUp.call(JForm);\n        };\n        this.canvas.ontouchdown = function (event) {\n            JForm.mousePosition = {x:parseInt((event.pageX - JForm.webPosition.x) \/ JZoom.x), y:parseInt((event.pageY - JForm.webPosition.y) \/ JZoom.y)};\n            JForm.onControlMouseDown.call(JForm);\n        };\n        this.canvas.ontouchup = function (event) {\n            JForm.mousePosition = {x:parseInt((event.pageX - JForm.webPosition.x) \/ JZoom.x), y:parseInt((event.pageY - JForm.webPosition.y) \/ JZoom.y)};\n            JForm.onControlMouseUp.call(JForm);\n        };\n        document.onkeydown = function (event) {\n            event = window.event || event;\n            JKeyCode = event.keyCode || event.which;\n            JForm.onControlKeyDown.call(JForm);\n        };\n        document.onkeyup = function (event) {\n            event = window.event || event;\n            JKeyCode = event.keyCode || event.which;\n            JForm.onControlKeyUp.call(JForm);\n        };\n        document.body.appendChild(this.canvas);\/\/\u753b\u5e03\u6dfb\u52a0\u5230web\u9875\u9762\n        this.context = this.canvas.getContext('2d');\n    }\n});\n2\u3001\u6587\u5b57\n\u663e\u793a\u6587\u5b57\u7c7b\u4ee3\u7801\u5982\u4e0b\uff1a\nJControls.Label = Class.create(JControls.Object, {\/\/\u4ece\u7236\u7c7b\u7ee7\u627f\n    text:\"\",\/\/\u663e\u793a\u6587\u672c\n    textPos:null,\/\/\u7528\u4e8e\u8c03\u6574\u6587\u5b57\u5728Label\u4e2d\u5f97\u4f4d\u7f6e\n    fontType:\"normal\", \/\/\u6587\u5b57\u5c5e\u6027,\u5982:\"normal\",\"bold\"\u7b49\n    fontColor:null,\/\/\u5b57\u4f53\u989c\u8272\n    textAlign:\"left\",\/\/\u6c34\u5e73\u5bf9\u9f50\uff1aleft\uff0ccenter\uff0cright\n    textBaseline:\"top\", \/\/\u7ad6\u76f4\u5bf9\u9f50\uff1atop\uff0cmiddle\uff0cbottom\n    fontSize:10,\/\/\u5b57\u4f53\u5927\u5c0f\n    setText:function (text) {\n        this.text = text;\n        return this;\n    },\n    setTextPos:function (textPos) {\n        this.textPos = textPos;\n        return this;\n    },\n    setFontType:function (type) {\n        this.fontType = type;\n        return this;\n    },\n    setFontColor:function (color) {\n        this.fontColor = color;\n        return this;\n    },\n    setTextAlign:function(textAlign){\n        this.textAlign=textAlign;\n        return this;\n    },\n    setTextBaseline:function(textBaseline){\n        this.textBaseline=textBaseline;\n        return this;\n    },\n    setFontSize:function(fontSize){\n        this.fontSize=fontSize;\n        return this;\n    },\n    showing:function($super,x, y, w, h){\/\/\u8986\u76d6\u7236\u7c7b\u4e2dshowing\u65b9\u6cd5\n        $super();\/\/\u6267\u884c\u7236\u7c7b\u4e2dshowing\u65b9\u6cd5\n        var _context = JForm.context;\n        if (this.text) {\n            _context.fillStyle = this.fontColor.data;\n            _context.font = this.fontType + \" \" + parseInt(this.fontSize * (JZoom.y + JZoom.x) \/ 2) + \"px serif\";\n            _context.textBaseline = this.textBaseline;\n            _context.textAlign = this.textAlign;\n            var x1,y1;\n            if(_context.textAlign==\"left\"){\n                x1= x + parseInt(this.textPos.x * JZoom.x);\n            }else if(_context.textAlign==\"center\"){\n                x1= x + parseInt(w\/2);\n            }else if(_context.textAlign==\"right\"){\n                x1= x + w- parseInt(this.textPos.x * JZoom.x);\n            }\n            if(_context.textBaseline==\"top\"){\n                y1=y + parseInt(this.textPos.y * JZoom.y);\n            }else if(_context.textBaseline==\"middle\"){\n                y1=y + parseInt(h\/2);\n            }else if(_context.textBaseline==\"bottom\"){\n                y1=y +h- parseInt(this.textPos.y * JZoom.y);\n            }\n            _context.fillText(this.text,x1,y1, this.size.width);\n        }\n    },\n    initialize:function ($super, argname, argP, argtext) {\/\/\u8986\u76d6\u7236\u7c7b\u4e2d\u6784\u9020\u51fd\u6570\n        $super(argname, argP, {width:100, height:20});\/\/\u6267\u884c\u7236\u7c7b\u4e2d\u6784\u9020\u51fd\u6570\n        this.text = argtext;\n        this.textPos = {x:2, y:2};\n        this.fontSize = 15;\n        this.fontColor = JColor.black;\n    }\n});\n3\u3001\u6309\u94ae\n\u6309\u94ae\u7c7b\u4ee3\u7801\u5982\u4e0b\uff1a\n\nJControls.Button = Class.create(JControls.Object, {\n    buttonLabel:null,\/\/Label\u5bf9\u8c61\uff0c\u7528\u4e8e\u663e\u793a\u6309\u94ae\u4e0a\u7684\u6587\u5b57\n    setText:function(text){\n    this.buttonLabel.setText(text);\n    },\n    setSize:function($super,size){\n        $super(size);\n        if(size)this.buttonLabel.setSize({width:size.width,height:size.height});\n    },\n    initialize:function ($super, argname, argP, argWH, argimage) {\n        $super(argname, argP, argWH);\n        if (argimage)this.BGImage = argimage.data;\/\/argimage.data\u5c31\u662f\u9884\u52a0\u8f7d\u7684\u56fe\u7247\u6570\u636e\n        this.buttonLabel=new JControls.Label(this.name+\"_Label\",{x:0,y:0})\/\/\u521b\u5efa\u4e86\u4e00\u4e2aLabel\u5bf9\u8c61\n            .setSize(argWH)  .setTextBaseline(\"middle\").setTextAlign(\"center\").setFontType(\"bold\");\n        this.addControlInLast([this.buttonLabel]);\/\/\u6dfb\u52a0\u5230\u5f53\u524d\u6309\u94ae\u5b50\u5bf9\u8c61\u6570\u7ec4\u4e2d\n    }\n});","categories":"\u7b2c\u4e09\u6b65","tags":["HTML5"]},{"title":"\u57fa\u672c\u5bf9\u8c61\u8bbe\u8ba1\uff08\u4e09\uff09","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/49224D56030C9863.html","content":"\u57fa\u672c\u5bf9\u8c61\u8bbe\u8ba1\uff08\u4e09\uff09\n4\u3001\u56fe\u7247\n\u8be5\u5bf9\u8c61\u7528\u4e8e\u663e\u793a\u56fe\u7247\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\nJControls.PictureBox = Class.create(JControls.Object, {\n    picture:null,\/\/\u56fe\u7247\u6570\u636e\n    picAlpha:null,\/\/t\u900f\u660e\u5ea6\n    picState:null,\/\/\u663e\u793a\u65b9\u5f0f\uff08flex\uff0ccut\uff09\n    picPosition:null,\/\/cut\u65b9\u5f0f\u4e0b\uff0c\u4ece\u8be5\u5750\u6807\u5f00\u59cb\u622a\u53d6\u56fe\u7247\u6570\u636e\n    picSize:null,\/\/cut\u65b9\u5f0f\u4e0b\uff0c\u622a\u53d6\u56fe\u7247\u7684\u957f\u5bbd\n    initialize:function ($super, argname, argP, argWH, argimage) {\n        $super(argname, argP, argWH);\n        if(argimage){\n            this.picture = argimage.data;\n            this.picSize={width:argimage.cellSize.width,height:argimage.cellSize.height};\n        }\n        this.picAlpha=1.0;\n        this.picState = \"cut\";\n        this.picPosition={x:0,y:0};\n    },\n    setPicture:function(image,position){\/\/\u8bbe\u7f6e\u8be5\u5bf9\u8c61\u56fe\u7247\u5c5e\u6027\n        this.picture=image.data;\n        this.picPosition=position;\n        this.picSize={width:image.cellSize.width,height:image.cellSize.height};\n        return this;\n    },\n    showing:function ($super, x, y, w, h){\/\/\u8986\u76d6\u7236\u7c7b\u4e2dshowing\u51fd\u6570\n        var _context=JForm.context;\n        if(this.picture){\n            _context.save();\n            _context.globalAlpha=this.alpha*this.picAlpha;\n            if (this.picState == \"flex\") {\n                _context.drawImage(this.picture, 0, 0, this.picture.width, this.picture.height, x, y, w, h);\n            }else if (this.picState == \"cut\") {\n                _context.drawImage(this.picture, this.picPosition.x, this.picPosition.y, this.picSize.width,\n                    this.picSize.height, x, y, w, h);\n            }\n            _context.restore();\n        }\n        if (this.selected) {\n            _context.strokeStyle = JColor.red.data;\n            _context.lineWidth = 1;\n            _context.strokeRect(x + _context.lineWidth, y + _context.lineWidth,\n                w - _context.lineWidth*2, h - _context.lineWidth*2);\n        }\n        $super(x, y, w, h);\/\/\u6267\u884c\u7236\u7c7b\u4e2dshowing\u51fd\u6570\n    }\n});\n5\u3001\u52a8\u753b\n\u8be5\u5bf9\u8c61\u663e\u793a\u7684\u52a8\u753b\u7531\u591a\u5f20\u56fe\u7ec4\u5408\u800c\u6210\uff0c\u6240\u4ee5\u52a8\u753b\u4f7f\u7528\u7684\u56fe\u7247\u662f\u7531\u591a\u5f20\u5c0f\u56fe\u5408\u6210\u7684\u5927\u56fe\u3002\n\u52a8\u753b\u8d44\u6e90\u5b9a\u4e49\u5982\u4e0b\uff1a\nvar ResourceData= {\n    Images:{\n        \/\/path\uff1a\u6587\u4ef6\u76f8\u5bf9\u8def\u5f84\uff0cpicNum:\u5f53\u524d\u56fe\u7247\u4e2d\u5bbd\u548c\u9ad8\u5305\u542b\u7684\u5c0f\u56fe\u6570\uff0ccellSize:\u5c0f\u56fe\u7247\u7684\u5bbd\u548c\u9ad8\uff0cdata\uff1a\u5b58\u653e\u52a0\u8f7d\u7684\u56fe\u7247\u6570\u636e\u3002\n        ZS1:{path:\"images\/battle\/ZS1.png\", picNum:{WNum:4,HNum:8},cellSize:{width:81,height:81}, data:null}\n    },\n    Animation:{\n        \/\/imageName:\u8d44\u6e90\u4e2d\u56fe\u7247\u7684Key\u503c\uff0c\u52a8\u753b\u8d77\u59cb\u4f4d\u7f6e\uff08\u5c0f\u56fe\uff09\uff0callPlayNum\uff1a\u52a8\u753b\u5c0f\u56fe\u6570\uff0cGHz\uff1a\u64ad\u653e\u9891\u7387\n        ZS1_battle:{imageName:\"ZS1\",beginPoint:{WNum:0,HNum:0},allPlayNum:4,GHz:3}\n    }\n}\n\u52a8\u753b\u7c7b\u4ee3\u7801\u5982\u4e0b\uff1a\nJControls.AnimationBox = Class.create(JControls.Object, {\n    animationName:null,\/\/\u52a8\u753b\u8d44\u6e90key\u503c\n    animationPlayNum:null,\/\/\u5f53\u524d\u8981\u663e\u793a\u7684\u52a8\u753b\u56fe\u7247\u7f16\u53f7\n    animationTime:null,\/\/\u6bcf\u6b21\u663e\u793a\u65f6\u8ba1\u6570\u52a01\n    animationOffset:null,\/\/\u504f\u79fb\u91cf\n    loop:null,\/\/\u662f\u5426\u5faa\u73af\u64ad\u653e\u52a8\u753b\n    stopPlayAnimation:null,\/\/\u662f\u5426\u6682\u505c\u64ad\u653e\u52a8\u753b\n    showing:function ($super, x, y, w, h) {\n        if (this.animationName) {\n            var animation = ResourceData.Animation[this.animationName];\n            var image = ResourceData.Images[animation.imageName];\n            var w1 = image.cellSize.width;\n            var h1 = image.cellSize.height;\n            var x1 = (animation.beginPoint.WNum + this.animationOffset.WNum + this.animationPlayNum) % image.picNum.WNum;\n            var y1 = animation.beginPoint.HNum + this.animationOffset.HNum + parseInt((animation.beginPoint.WNum + this.animationOffset.WNum + this.animationPlayNum) \/ image.picNum.WNum);\n\n            JForm.context.drawImage(image.data, w1 * x1, h1 * y1, w1, h1, x, y, w, h);\n            if(this.isHighLight){\/\/\u7ed8\u5236\u9ad8\u4eae\u56fe\u7247\n                JForm.context.save();\n                JForm.context.globalCompositeOperation=\"lighter\";\n                JForm.context.globalAlpha=this.alpha*0.2;\n                JForm.context.drawImage(image.data, w1 * x1, h1 * y1, w1, h1, x, y, w, h);\n                JForm.context.restore();\n            }\n            if (!this.stopPlayAnimation) {\n                this.animationTime++;\n            }\n            if (this.animationTime &gt;= animation.GHz) {\/\/\u5f53\u8ba1\u6570\u5927\u4e8e\u6216\u7b49\u4e8e\u52a8\u753b\u9891\u7387\u65f6\n                this.animationPlayNum++;\/\/\u8981\u663e\u793a\u7684\u52a8\u753b\u56fe\u7247\u7f16\u53f7\u52a01\uff0c\n                if (this.animationPlayNum &gt;= animation.allPlayNum) {\n                    if (this.loop)this.animationPlayNum = 0;\/\/\u5faa\u73af\u64ad\u653e\n                    else this.remove();\/\/\u5df2\u64ad\u653e\u5230\u672b\u5c3e\uff0c\u5220\u9664\u8be5\u5bf9\u8c61\n                }\n                this.animationTime = 0;\/\/\u91cd\u7f6e\u8ba1\u6570\n            }\n        }\n        $super( x, y, w, h);\n    },\n    setAnimation:function (animationName) {\/\/\u8bbe\u7f6e\u52a8\u753b\u8d44\u6e90\n        this.animationName = animationName;\n        return this;\n    },\n    initialize:function ($super, argname, argP, argWH, argAnimationName) {\n        $super(argname, argP, argWH);\n        this.animationName = argAnimationName;\n        this.animationPlayNum = 0;\n        this.animationTime = 0;\n        this.animationOffset = {WNum:0, HNum:0};\n        this.loop = true;\n        this.stopPlayAnimation = false;\n    }\n});\n6\u3001\u5bb9\u5668\n\u4e3b\u8981\u7528\u4e8e\u63a7\u5236\u5176\u4ed6\u5bf9\u8c61\u5206\u7ec4,\u4fbf\u4e8e\u63a7\u5236\u3002\n\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a\nJControls.Panel = Class.create(JControls.Object, {\/\/\u4ece\u7236\u7c7b\u7ee7\u627f\n    closeButton:null,\/\/\u5173\u95ed\u6309\u94ae\n    title:null,\/\/\u663e\u793a\u6807\u9898\u7684\u63a7\u4ef6\n    isShowTitle:null,\/\/\u662f\u5426\u663e\u793a\u6807\u9898\u680f\n    titleHeight:40,\/\/\u6807\u9898\u680f\u9ad8\u5ea6\n    initialize:function ($super, argname, argP, argWH) {\n        $super(argname, argP, argWH);\n        this.isShowTitle=false;\n        this.titleHeight=40;\n    },\n    showTitle:function(title){\n        if(this.isShowTitle){\n            this.title.setText(title);\n        }else{\n            this.title=new JControls.Label(this.name+\"_title\",{x:0,y:0}).setSize({width:this.size.width,height:this.titleHeight})\n                .setText(title).setBGColor(JColor.blue).setFontSize(27).setTextBaseline(\"middle\").setFontType(\"bold\").setTextPos({x:20,y:0});\n            this.closeButton=new JControls.Button(this.name+\"_closeButton\",{x:this.size.width-60,y:0},{width:60,height:this.titleHeight})\n                .setBGColor(JColor.white);\n            this.closeButton.buttonLabel.setText(\"\u5173\u95ed\").setFontColor(JColor.red).setFontSize(22);\n            this.closeButton.onClick=function(){\n                this.parent.visible=false;\n                this.parent.parent.show();\n                this.parent.onCloseButtonClick&amp;&amp;this.parent.onCloseButtonClick();\n                return true;\n            }\n            this.addControlInLast([this.title,this.closeButton]);\n            this.isShowTitle=true;\n        }\n    },\n    onCloseButtonClick:null,\n    beginShow:function ($super) {\/\/\u8986\u76d6\u7236\u7c7b\u4e2dbeginShow\u65b9\u6cd5\n        $super();\n        if (this.parent&amp;&amp;this.isShowTitle)this.position.y +=this.titleHeight;\n    }\n});","categories":"\u7b2c\u4e09\u6b65","tags":["HTML5"]},{"title":"\u57fa\u672c\u5bf9\u8c61\u8bbe\u8ba1\uff08\u56db\uff09","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/A43AAAD554420BE4.html","content":"\u57fa\u672c\u5bf9\u8c61\u8bbe\u8ba1\uff08\u56db\uff09\n7\u3001\u5bf9\u8bdd\u6846\n\u7528\u4e8e\u663e\u793a\u4fe1\u606f\u3002\nJControls.MessageBox = Class.create(JControls.Object, {\n    initialize:function ($super, argname, argWH, argAString,argP) {\n        \/\/\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u663e\u793a\u4f4d\u7f6e\uff0c\u5219\u5c45\u4e2d\u663e\u793a\n        if(!argP)argP={x:parseInt((JForm.size.width - argWH.width) \/ 2), y:parseInt((JForm.size.height - argWH.height) \/ 2)};\n        $super(argname,argP, argWH);\n        this.BGColor = JColor.white;\n        JForm.addControlInLast([this]);\/\/\u628a\u6d88\u606f\u6846\u6dfb\u52a0\u5230\u4e3b\u7a97\u4f53\u5185\n        var messageTitle = new JControls.Label(argname + \"lbT\", {x:0, y:0}, \"\u7cfb\u7edf\u63d0\u793a\");\n        messageTitle.BGColor = JColor.blue;\n        messageTitle.fontColor = JColor.red;\n        messageTitle.size.width = argWH.width;\n        messageTitle.size.height = 25;\n        messageTitle.fontSize = 20;\n        messageTitle.fontType = \"bold\";\n        this.addControlInLast([messageTitle]);\/\/\u6dfb\u52a0\u6d88\u606f\u6807\u9898\u680f\n        var h = messageTitle.size.height;\n        for (var i = 0; i &lt; argAString.length; i++) {\/\/\u6dfb\u52a0\u6d88\u606f\u5185\u5bb9\n            var m = new JControls.Label(argname + \"lbM\" + i, {x:0, y:h}, argAString[i]);\n            m.size.width = argWH.width;\n            m.textPos.x = 10;\n            h += m.size.height;\n            this.addControlInLast([m]);\n        }\n        this.size.height = h+20;\n    },\n    onClick:function () {\/\/\u70b9\u51fb\u540e\uff0c\u5220\u9664\u5bf9\u8c61\n        this.remove.call(this);\n        JForm.show.call(JForm);\n    }\n});\n8\u3001\u58f0\u97f3\n\u8fd9\u91cc\u5199\u7684\u6bd4\u8f83\u7b80\u5355\u3002\nJControls.Audio = Class.create({\n    audioData:null,\/\/Audio\u6570\u636e\n    initialize:function (audio,loop) {\n        this.setAudio(audio,loop);\n    },\n    setAudio:function(audio,loop){\n        if(audio){\n            this.audioData = audio.data;\n            if(loop)this.audioData.loop=true;\n        }\n    },\n    play:function () {\n        if (this.audioData)this.audioData.play();\n    },\n    pause:function () {\n        if (this.audioData)this.audioData.pause();\n    }\n});\n9\u3001\u65f6\u949f\n\u65f6\u949f\u53ea\u6709\u4e00\u4e2a\uff0c\u6240\u6709\u7684\u52a8\u753b\u548c\u79fb\u52a8\uff0c\u90fd\u662f\u7531\u5b83\u6765\u9a71\u52a8\u7684\u3002\nvar JTick=null;\nJControls.Tick = Class.create({\n    time:40,\/\/\u95f4\u9694\u65f6\u95f4\n    fun:[],\/\/\u8981\u5faa\u73af\u663e\u793a\u7684\u5bf9\u8c61\u6570\u7ec4\n    handle:null,\/\/\u53e5\u67c4\n    initialize:function(time){\n        this.time=time;\n        this.fun=[];\n        this.handle=null;\n        JTick=this;\n    },\n    begin:function(){\n        this.handle=setTimeout(this.runOneTime, this.time);\n    },\n    end:function(){\n        if(this.handle)clearTimeout(this.handle);\n    },\n    add:function(aObj){\n        if(aObj){\n            for (var i = 0; i &lt; aObj.length; i++) {\n                this.fun[this.fun.length]=aObj[i];\n            }\n        }\n    },\n    delete:function(obj){\n        if(obj){\n            for(var i=0;i&lt;this.fun.length;i++){\n                if(this.fun[i].name==obj.name){\n                    for(var j=i;j&lt;this.fun.length-1;j++){\n                        this.fun[j]=this.fun[j+1];\n                    }\n                    this.fun.length--;\n                }\n            }\n        }\n    },\n    runOneTime:function(){\n        JTick.end();\n        for(var i=0;i&lt;JTick.fun.length;i++){\n            if(JTick.fun[i])JTick.fun[i].show.call(JTick.fun[i]);\n        }\n        JTick.handle=setTimeout(JTick.runOneTime, JTick.time);\n    }\n});\n\u81f3\u6b64\uff0c\u57fa\u672c\u5bf9\u8c61\u5df2\u7ecf\u8bbe\u8ba1\u5b8c\u6210\uff0c\u4e0b\u7bc7\u5f00\u59cb\u5c31\u8981\u8bbe\u8ba1\u6e38\u620f\u4e2d\u7684\u5177\u4f53\u5bf9\u8c61\u4e86\u3002","categories":"\u7b2c\u4e09\u6b65","tags":["HTML5"]},{"title":"\u6e38\u620f\u5bf9\u8c61\u8bbe\u8ba1","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/7B45EBEA4E81B2F1.html","content":"\u6e38\u620f\u5bf9\u8c61\u8bbe\u8ba1\n\u6e38\u620f\u5bf9\u8c61\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u51e0\u7c7b\uff1a\n1\u3001\u5730\u56fe\u5355\u5143\n\u5730\u56fe\u5355\u5143\u662f\u7ec4\u6210\u5730\u56fe\u7684\u5355\u5143\u683c\uff0c\u5730\u56fe\u5355\u5143\u4e2d\u53ef\u4ee5\u653e\u7f6e\u89e6\u53d1\u5668\uff0c\u4e3b\u89d2\u884c\u8d70\u5728\u5355\u5143\u683c\u4e0a\u4f1a\u89e6\u53d1\u653e\u7f6e\u7684\u89e6\u53d1\u5668\u4e8b\u4ef6\u3002\n2\u3001\u89e6\u53d1\u5668\n\u89e6\u53d1\u5668\u53ea\u662f\u4e00\u4e2a\u7edf\u79f0\uff0c\u5b83\u5177\u4f53\u4e4b\u540e\u53ef\u4ee5\u662f\u5b9d\u7bb1\u3001\u4f20\u9001\u9635\u7b49\uff0c\u53ef\u4ee5\u63a7\u5236\u6e38\u620f\u7684\u8fdb\u5ea6\u3002\n3\u3001\u7269\u54c1\n\u7269\u54c1\u5305\u62ec\u88c5\u5907\u3001\u836f\u54c1\u7b49\u3002\n4\u3001\u6e38\u620f\u89d2\u8272\n\u6e38\u620f\u89d2\u8272\u53ef\u5206\u4e3a\u4e3b\u89d2\u548cNPC\u3002\n1\u3001\u5730\u56fe\u5355\u5143\n\u5730\u56fe\u5355\u5143\u53ef\u8bbe\u7f6e\u6e38\u620f\u89d2\u8272\u662f\u5426\u53ef\u4ee5\u901a\u884c\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\nvar GControls={};\nGControls.MapCell = Class.create(JControls.PictureBox, {\n    walk:null,\/\/\u662f\u5426\u53ef\u4ee5\u884c\u8d70\n    initialize:function ($super,  argP, argWH, argPicName) {\n        $super( argP, argWH);\n        if(argPicName)this.setMapPic(argPicName);\n    },\n    setMapPic:function(mapPicName){\n        if(mapPicName){\n            this.setPicture(ResourceData.Images[ResourceData.MainPic[mapPicName].imageName]\n                ,ResourceData.MainPic[mapPicName].picPosition);\n            if(ResourceData.MainPic[mapPicName].walk)this.walk=true;\n            else this.walk=false;\n        }\n        return this;\n    }\n});\n\u5176\u4e2dResourceData.MainPic\u5982\u4e0b\uff1a\n\nvar ResourceData= {\n    MainPic:{\n        \/\/imageName\uff1a\u8d44\u6e90ResourceData.Images\u4e2d\u7684\u56fe\u7247\u540d\u79f0\uff0cpicPosition\uff1a\u4ece\u56fe\u7247\u7684\u90a3\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u663e\u793a\uff0cwalk\uff1a\u662f\u5426\u53ef\u4ee5\u901a\u884c\n        Move_0_0:{\"imageName\":\"move\",\"picPosition\":{\"x\":0,\"y\":0},\"walk\":true}\n    }\n}\n2\u3001\u89e6\u53d1\u5668\n\u4ee3\u7801\u5982\u4e0b\uff1a\nGControls.Trigger = Class.create(JControls.PictureBox, {\/\/\u89e6\u53d1\u88c5\u7f6e\uff0c\u9002\u7528\u5982\u5b9d\u7bb1\uff08Treasure\uff09\uff0c\u4f20\u9001\u9635\uff08JumpToMap\uff09\u7b49\n    open:false,\/\/\u662f\u5426\u53ef\u4ee5\u89e6\u53d1\n    eventData:null,\/\/\u89e6\u53d1\u88c5\u7f6e\u6570\u636e\n    triggerType:null,\n    initialize:function ($super,  argP, argWH, argTriggerPicName,triggerType) {\n        $super( argP, argWH, ResourceData.Images[ResourceData.MainPic[argTriggerPicName].imageName]);\n        if(triggerType)this.triggerType=triggerType;\n        else this.triggerType=\"Treasure\";\/\/\u9ed8\u8ba4\u4e3a\u5b9d\u7bb1\n        this.setPicture(ResourceData.Images[ResourceData.MainPic[argTriggerPicName].imageName]\n            ,ResourceData.MainPic[argTriggerPicName].picPosition);\n    },\n    onTrigger:function(){\/\/\u89e6\u53d1\n        switch(this.triggerType){\n            case \"Treasure\":\n                var a=[], b=[];\n                if(this.eventData.goods)b=this.eventData.goods.split(\",\");\n                if(this.eventData.goldNum){\n                    a[0]=\"\u83b7\u5f97\"+this.eventData.goldNum+\"\u91d1\u5e01.\";\n                    GMain.GoldNum+=parseInt(this.eventData.goldNum);\n                }\n                GFunction.gainGoods(b);\n                for(var i=0;i&lt; b.length;i++){\n                    a[a.length]=\"\u83b7\u5f97\"+ResourceData.Goods[b[i]].showName+\".\";\n                }\n                var msgBox=new JControls.MessageBox({width:200,height:0},a);\n                msgBox.onClick=function(){\n                    this.remove.call(this);\n                    GMain.MapPanel.saveShowImageData();\/\/\u66f4\u65b0\u5730\u56fe\u7f13\u5b58\u6570\u636e\n                    return true;\n                }\n                this.open=true;\n                this.picPosition.x+= this.picSize.width;\n                break;\n            case \"JumpToMap\":\n                GMain.FloorsNum=this.eventData.goToFloorNum;\n                GMain.MapData=GFunction.createMap();\n                GMain.loadMapPanel();\n                GMain.showMapPanel();\n                break;\n            default: break;\n        }\n    }\n});\n\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199onTrigger\u65b9\u6cd5\u6765\u5b9e\u73b0\u4e0d\u540c\u89e6\u53d1\u4e8b\u4ef6\u3002\n3\u3001\u7269\u54c1\n\u4ee3\u7801\u5982\u4e0b\uff1a\nGControls.Goods = Class.create(JControls.PictureBox, {\n    num:null,\/\/\u6570\u91cf\n    goodsData:null,\/\/\u7269\u54c1\u6570\u636e\n    isUsed:null,\/\/\u662f\u5426\u88c5\u5907\u5728\u8eab\u4e0a\n    initialize:function ($super,goodsName) {\n        $super();\n        this.num=1;\n        this.isUsed=false;\n        var goodsLabel=new JControls.Label({x:0,y:0}, this.num)\n            .setTextPos({x:2, y:2}).setFontSize(15).setFontColor(JColor.red);\n        this.addControlInLast([goodsLabel]);\n        this.BGColor=JColor.white;\n        this.setGoodsName(goodsName);\n    },\n    setNum:function(num){\n        this.num=num;\n        return this;\n    },\n    setSize:function($super,size){\n        $super(size);\n        this.controls[0].setSize(size);\n    },\n    setGoodsName:function(goodsName){\n        if(goodsName){\n            this.setPicture(ResourceData.Images[ResourceData.Goods[goodsName].imageName]\n                ,ResourceData.Goods[goodsName].picPosition);\n            this.goodsData=ResourceData.Goods[goodsName];\n        }\n        return this;\n    },\n    getSaveData:function(){\n        var saveData={};\n        saveData.goodsData=this.goodsData;\n        saveData.num=this.num;\n        saveData.isUsed=this.isUsed;\n    },\n    beginShow:function($super){\n        if(this.num&gt;1){\n            this.controls[0].setText(this.num);\n            this.controls[0].visible=true;\n        }\n        else  this.controls[0].visible=false;\n        $super();\n    },\n    onClick:function(){\n        if(GMain.SelectedGoods){\n            GMain.SelectedGoods.selected=false;\n        }\n        GMain.SelectedGoods=this;\n        GMain.SelectedGoods.selected=true;\n        GMain.DataPanel.loadData();\n        return true;\n    }\n});\n\u5176\u4e2dResourceData.Goods\u5982\u4e0b\uff1a\nvar ResourceData= {\n    Goods:{\n        \/\/showName:\u7269\u54c1\u540d\u79f0\uff0cgoodsLevel\uff1a\u7269\u54c1\u7ea7\u522b\uff0cuseStandards\uff1a\u4f7f\u7528\u8981\u6c42\uff0cgoodsType\uff1a\u7269\u54c1\u7c7b\u578b\uff0cimageName\uff1a\u56fe\u7247\u540d\u79f0\uff0cpicPosition\uff1a\u56fe\u7247\u4e2d\u5f97\u663e\u793a\u4f4d\u7f6e\uff0cattributes\uff1a\u7269\u54c1\u5c5e\u6027\n        \"ZB1_0_0\":{\"showName\":\"\u957f\u5251\",goodsLevel:1,useStandards:{level:1,jobsName:\"Soldier\"},\"goodsType\":\"handR\",\"imageName\":\"ZB1\",\n            \"picPosition\":{\"x\":0,\"y\":0},attributes:{\"ATK\":\"10\"}}\n    }\n}\n4\u3001\u6e38\u620f\u89d2\u82724\u3001\u6e38\u620f\u89d2\u8272\n\u4ee3\u7801\u5982\u4e0b\uff1a\nGControls.GameRole=Class.create(JControls.AnimationBox,{\n    GameRoleData:null,\/\/GameRole\u952e\u503c\n    mStep:4,\/\/\u884c\u8d70\u6b65\u4f10\u6570\u503c\n    moveDirection:GMain.Direction.down,\/\/\u79fb\u52a8\u65b9\u5411\uff0c37:\u5de6\uff0c 38:\u4e0a\uff0c39:\u53f3\uff0c40:\u4e0b\n    level:1,\/\/\u7b49\u7ea7\n    EXP:0,\/\/\u7ecf\u9a8c\u503c\n    base:null,\/\/\u57fa\u7840\u80fd\u529b\n    HP:0,\/\/\u5269\u4f59\u8840\u503c\n    MP:0,\/\/\u5269\u4f59\u9b54\u529b\u503c\n    bodySlots:null,\/\/\u7a7f\u6234\u7684\u88c5\u5907\n    \/\/\/\/\/\/\/\/\/\/\/\n    basePosition:null,\/\/\u6218\u6597\u65f6\u7ad9\u7acb\u7684\u4f4d\u7f6e\n    toGameRoleArray:null,\/\/\u8981\u653b\u51fb\u5bf9\u8c61\u6570\u7ec4\n    usedSkillName:null,\/\/\u8981\u91ca\u653e\u7684\u6280\u80fd\n    attackTime:null,\/\/\u653b\u51fb\u8ba1\u65f6\n    isAttacking:null,\/\/\u653b\u51fb\u6216\u65bd\u6cd5\u4e2d\n    bodyState:null,\/\/\u9644\u52a0\u72b6\u6001\n    \/\/\/\/\/\n    GameRoleSign:1,\/\/\u654c\u5bf9GameRole\n    isControl:false,\n    usedGoods:null,\n\n    initialize :function ($super,argGameRoleName,GameRoleSign) {\n        $super();\n        \/\/this.canMove=false;\n        this.bodyState={defend:false,died:false};\n        this.base={STR:0,VIT:0,DEX:0,INT:0,HP:0,MP:0};\n        this.bodySlots={head:null,body:null,foot:null,handL:null,handR:null,neck:null,fingerL:null,fingerR:null,glove:null};\n        this.setGameRoleName(argGameRoleName,GameRoleSign);\n    },\n    setGameRoleName:function(GameRoleName,GameRoleSign){\n        if(GameRoleName){\n            this.GameRoleData=ResourceData.GameRole[GameRoleName];\n            this.HP=this.getMaxHP();\n            this.MP=this.getMaxMP();\n        }\n        if(GameRoleSign==1){\n            this.initBattle();\n            this.GameRoleSign=1;\n        }\n        else{\n            this.initMove();\n            this.GameRoleSign=0;\n        }\n        return this;\n    },\n    setRelativePosition:function ($super,relativePosition) {\n        $super(relativePosition);\n        if(GMain.IsBattle)this.basePosition={x:relativePosition.x,y:relativePosition.y};\n        return this;\n    },\n    selectAttackBegin:function(){\n        GMain.FromAttackSelect=false;\n        GMain.BattleControlPanel.visible=true;\n        this.isHighLight=true;\n        this.usedSkillName=null;\n        this.clearControls();\n        this.addControlInLast([\n            new JControls.Label({x:0,y:-60},\"LV\"+this.level+\" \"+this.getShowName()).setFontType(\"bold\")\n            ,new JControls.Label({x:0,y:-40}).setFontColor(JColor.red).setFontType(\"bold\")\n            ,new JControls.Label({x:0,y:-20}).setFontColor(JColor.blue).setFontType(\"bold\")\n        ]);\n    },\n    setBattleState:function(state){\n        this.animationTime = 0;\n        this.animationPlayNum = 0;\n        this.blockInvert=false;\n        switch (state){\n            case ResourceData.BattleState.stand:\n                this.animationOffset={WNum:0,HNum:1};\n                break;\n            case ResourceData.BattleState.moveTo:\n                this.animationOffset={WNum:0,HNum:0};\n                break;\n            case ResourceData.BattleState.moveBack:\n                this.animationOffset={WNum:0,HNum:0};\n                this.blockInvert=true;\n                break;\n            case ResourceData.BattleState.underFire:\n                this.animationOffset={WNum:0,HNum:3};\n                break;\n            case ResourceData.BattleState.attack:\n                this.animationOffset={WNum:0,HNum:4};\n                break;\n            case ResourceData.BattleState.die:\n                this.animationOffset={WNum:0,HNum:6};\n                break;\n        }\n        return this;\n    },\n    getHP:function(){\n        return this.HP;\n    },\n    getMP:function(){\n        return this.MP;\n    },\n    attack:function(toGameRoleArray,usedSkillName){\n        this.toGameRoleArray=toGameRoleArray;\n        this.isHighLight=false;\n        this.attackTime=0;\n        if(usedSkillName)this.usedSkillName=usedSkillName;\n    },\n    playEffects:function (animationName,playPosition,size){\n        var effects=new JControls.AnimationBox(playPosition,size,animationName);\n        effects.loop=false;\n        this.parent.addControlInLast([effects]);\n    },\n    onClick:function(){\n        if(GMain.BattlesGameRole[0][GMain.SelectLeaderNum].usedSkillName){\n            JMain.JForm.canvas.style.cursor=\"default\";\n            GMain.BattlesGameRole[0][GMain.SelectLeaderNum].attack([this]);\n            GMain.BattlesGameRole[0][GMain.SelectLeaderNum].clearControls();\n            GFunction.nextAttackSelect();\n        }\n        return true;\n    },\n\n    getHeadImageName:function(){\n        return this.GameRoleData.headImageName;\n    },\n    getShowName:function(){\n        return ResourceData.Professions[this.GameRoleData.jobsName].showName;\n    },\n    getJobsName:function(){\n        return this.GameRoleData.jobsName;\n    },\n    getLevelExp:function(){\n        var num1=0;\n        for(var i=this.level;i&gt;0;i--)num1+=100*i;\n        return num1;\n    },\n    getSTR:function(){\n        var n=this.GameRoleData.growUp.STR*this.level+this.base.STR;\n        for(var bs in this.bodySlots){\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.STR)n+=parseInt(this.bodySlots[bs].goodsData.attributes.STR);\n        }\n        return n;\n    },\n    getVIT:function(){\n        var n=this.GameRoleData.growUp.VIT*this.level+this.base.VIT;\n        for(var bs in this.bodySlots){\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.VIT){\n                n+=parseInt(this.bodySlots[bs].goodsData.attributes.VIT);\n            }\n        }\n        return n;\n    },\n    getDEX:function(){\n        var n=this.GameRoleData.growUp.DEX*this.level+this.base.DEX;\n        for(var bs in this.bodySlots){\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.DEX)n+=parseInt(this.bodySlots[bs].goodsData.attributes.DEX);\n        }\n        return n;\n    },\n    getINT:function(){\n        var n=this.GameRoleData.growUp.INT*this.level+this.base.INT;\n        for(var bs in this.bodySlots)\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.INT)n+=parseInt(this.bodySlots[bs].goodsData.attributes.INT);\n        return n;\n    },\n    getATK:function(){\n        var n=this.getSTR()*2+this.getDEX();\n        for(var bs in this.bodySlots)\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.ATK)n+=parseInt(this.bodySlots[bs].goodsData.attributes.ATK);\n        return n;\n    },\n    getDEF:function(){\n        var n=this.getVIT();\n        for(var bs in this.bodySlots)\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.DEF)n+=parseInt(this.bodySlots[bs].goodsData.attributes.DEF);\n        return n;\n    },\n    getMATK:function(){\n        var n=this.getINT()*2;\n        for(var bs in this.bodySlots)\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.MATK)n+=parseInt(this.bodySlots[bs].goodsData.attributes.MATK);\n        return n;\n    },\n    getMDEF:function(){\n        var n=this.getINT();\n        for(var bs in this.bodySlots)\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.MDEF)n+=parseInt(this.bodySlots[bs].goodsData.attributes.MDEF);\n        return n;\n    },\n    getMaxHP:function(){\n        var n=this.base.HP+this.getVIT()*5+this.GameRoleData.growUp.HP*this.level;\n        for(var bs in this.bodySlots)\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.HP)n+=parseInt(this.bodySlots[bs].goodsData.attributes.HP);\n        return n;\n    },\n    getMaxMP:function(){\n        var n=this.base.MP+this.getINT()*5+this.GameRoleData.growUp.MP*this.level;\n        for(var bs in this.bodySlots)\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.MP)n+=parseInt(this.bodySlots[bs].goodsData.attributes.MP);\n        return n;\n    },\n    getSpeed:function(){\n        var n=this.getDEX();\n        for(var bs in this.bodySlots)\n            if(this.bodySlots[bs]&amp;&amp;this.bodySlots[bs].goodsData.attributes.SPD)n+=parseInt(this.bodySlots[bs].goodsData.attributes.SPD);\n        return n;\n    },\n    addEXP:function(exp){\n        this.EXP+=exp;\n        var levelExp=this.getLevelExp();\n        if(this.EXP&gt;=levelExp){\n            this.level++;\n            this.EXP=this.EXP-levelExp;\n            this.HP=this.getMaxHP();\n            this.MP=this.getMaxMP();\n        }\n    },\n    useGoods:function(goods){\/\/\u4f7f\u7528\u7269\u54c1\n        \/\/{head:null,body:null,foot:null,handL:null,handR:null,neck:null,fingerL:null,fingerR:null,glove:null};\n        \/\/\"0\"&gt;\u6b66\u5668,\"1\"&gt;\u62a4\u7532,\"2\"&gt;\u5934\u76d4,\"3\"&gt;\u9774\u5b50,\"4\"&gt;\u6212\u5b50,\"5\"&gt;\u9879\u94fe,\"6\"&gt;\u76fe\u724c,\"7\"&gt;\u836f\u54c1\n        switch (goods.goodsData.goodsType){\n            case \"drug\":\n                if(goods.goodsData.attributes.HP){\n                    this.HP+=parseInt(goods.goodsData.attributes.HP);\n                    if( this.HP&gt;this.getMaxHP())this.HP=this.getMaxHP();\n                }\n                if(goods.goodsData.attributes.MP){\n                    this.MP+=parseInt(goods.goodsData.attributes.MP);\n                    if( this.MP&gt;this.getMaxMP())this.HP=this.getMaxMP();\n                }\n                if(goods.goodsData.attributes.MaxHP){\n                    this.base.HP+=parseInt(goods.goodsData.attributes.MaxHP);\n                }\n                if(goods.goodsData.attributes.MaxMP){\n                    this.base.MP+=parseInt(goods.goodsData.attributes.MaxMP);\n                }\n                if(goods.goodsData.attributes.STR){\n                    this.base.STR+=parseInt(goods.goodsData.attributes.STR);\n                }\n                if(goods.goodsData.attributes.VIT){\n                    this.base.VIT+=parseInt(goods.goodsData.attributes.VIT);\n                }\n                if(goods.goodsData.attributes.DEX){\n                    this.base.DEX+=parseInt(goods.goodsData.attributes.DEX);\n                }\n                if(goods.goodsData.attributes.INT){\n                    this.base.INT+=parseInt(goods.goodsData.attributes.INT);\n                }\n                goods.num--;\n                for (var i = 0; i &lt; GMain.Goods.length; i++) {\n                    if(GMain.Goods[i].num==0){\n                        for (var j = i; j &lt; GMain.Goods.length-1; j++) {\n                            GMain.Goods[j]=GMain.Goods[j+1];\n                        }\n                        GMain.Goods.length-=1;\n                    }\n                }\n                GMain.SelectedGoods=null;\n                break;\n            default:\n                if(this.bodySlots[goods.goodsData.goodsType])this.bodySlots[goods.goodsData.goodsType].isUsed=false;\n                this.bodySlots[goods.goodsData.goodsType]=goods;\n                this.bodySlots[goods.goodsData.goodsType].isUsed=true;\n                break;\n        }\n\n    },\n    deleteCombatGear:function(goods){\/\/\u5378\u4e0b\u88c5\u5907\n        if(goods){\n            goods.isUsed=false;\n            this.bodySlots[goods.goodsData.goodsType]=null;\n        }\n\n    },\n    setMoveDirection:function(direction){\/\/\u8bbe\u7f6e\u884c\u8d70\u65b9\u5411\n        this.moveDirection=direction;\n        this.animationTime=0;\n        switch (this.moveDirection){\n            case GMain.Direction.left:\n                this.animationOffset={WNum:0,HNum:1};\n                GMain.MapPanel.moveStep={x:this.mStep,y:0};\n                break;\n            case GMain.Direction.up:\n                this.animationOffset={WNum:0,HNum:3};\n                GMain.MapPanel.moveStep={x:0,y:this.mStep};\n                break;\n            case GMain.Direction.right:\n                this.animationOffset={WNum:0,HNum:2};\n                GMain.MapPanel.moveStep={x:this.mStep*-1,y:0};\n                break;\n            case GMain.Direction.down:\n                this.animationOffset={WNum:0,HNum:0};\n                GMain.MapPanel.moveStep={x:0,y:this.mStep*-1};\n                break;\n        }\n\n    },\n    initMove:function(){\n        this.setRelativePosition({x:GMain.CellSize.width*GMain.InPoint.x,y:GMain.CellSize.height*(GMain.InPoint.y-0.5)});\n        this.setSize({width:GMain.CellSize.width,height:GMain.CellSize.height*1.5});\n        this.setAnimation(this.GameRoleData.animation.move);\n        this.setMoveDirection(this.moveDirection);\n        this.canMove=false;\n        GMain.MapPanel.moveStep=null;\n        this.stopPlayAnimation=true;\n    },\n    initBattle:function(){\n        this.setSize({width:80,height:80});\n        this.setAnimation(this.GameRoleData.animation.battle);\n        this.setBattleState(ResourceData.BattleState.stand);\n        this.usedSkillName=null;\n        this.usedGoods=null;\n        GMain.MapPanel.moveStep=null;\n        this.canMove=true;\n    },\n    beginShow:function($super){\n        $super();\n        if(GMain.IsBattle){\n            this.toBattle();\n        }else {\n            if(this.isControl){\n                this.toMove();\n            }\n        }\n    },\n    toMove:function(){\n        if (GMain.MapPanel.canMove&amp;&amp;GMain.MapPanel.moveStep&amp;&amp;(GMain.MapPanel.moveStep.x||GMain.MapPanel.moveStep.y)) {\n            var x=this.position.x-GMain.MapPanel.moveStep.x;\n            var y=this.position.y-GMain.MapPanel.moveStep.y;\n            var c=parseInt((x-GMain.MapPanel.position.x+GMain.CellSize.width\/2)\/GMain.CellSize.width);\n            var r=parseInt((y-GMain.MapPanel.position.y+GMain.CellSize.width)\/GMain.CellSize.width);\n            var toMove;\n            if(this.pointInBlock({x:x,y:y+parseInt(GMain.CellSize.height\/2)},GMain.MapPanel)\n                &amp;&amp;this.pointInBlock({x:x+this.size.width,y:y+parseInt(GMain.CellSize.height\/2)},GMain.MapPanel)\n                &amp;&amp;this.pointInBlock({x:x,y:y+this.size.height},GMain.MapPanel)\n                &amp;&amp;this.pointInBlock({x:x+this.size.width,y:y+this.size.height},GMain.MapPanel)){\n                toMove=GMain.MapCells[r][c].walk;\n                if(GMain.MapCells[r][c].controls.length&gt;0){\n                    toMove=GMain.MapCells[r][c].controls[0].open;\n                }\n            }else{\n                toMove=false;\n            }\n            if(toMove){\n                var n=JFunction.Random(1,100);\n                if(n&lt;GMain.BattleProbability){\n                    GMain.MapPanel.moveStep=null;\n                    GMain.BattlesGameRole[0][0].stopPlayAnimation=true;\n                    var n1=JFunction.Random(1,5);\n                    GMain.BattlesGameRole[1]=[];\n                    for(var i=0;i&lt;n1;i++){\n                        GMain.BattlesGameRole[1][i]=new GControls.GameRole(\"Lang\",1).setSize({width:160,height:160});\n                    }\n                    GFunction.showBattlePanel();\n                }\n            }else{\n                GMain.MapPanel.relativePosition.x -=  GMain.MapPanel.moveStep.x;\n                GMain.MapPanel.relativePosition.y -=  GMain.MapPanel.moveStep.y;\n            }\n        }\n    },\n    toBattle:function(){\n        if(this.controls[1])this.controls[1].setText(\"HP:\"+this.HP+\"\/\"+this.getMaxHP());\n        if(this.controls[2])this.controls[2].setText(\"MP:\"+this.MP+\"\/\"+this.getMaxMP());\n        var MTime=15,ATime=10;\n        if(this.isAttacking&amp;&amp;this.usedSkillName){\n            if(ResourceData.Skill[this.usedSkillName].toMove){\n                if(this.attackTime==0){\/\/\u79fb\u52a8\n                    this.moveStep={x:(this.toGameRoleArray[0].position.x+this.toGameRoleArray[0].size.width-this.size.width-this.position.x)*1.0\/MTime,\n                        y:(this.toGameRoleArray[0].position.y+this.toGameRoleArray[0].size.height-this.size.height-this.position.y)*1.0\/MTime};\n                    this.setBattleState(ResourceData.BattleState.moveTo);\n                }else if(this.attackTime==MTime){\/\/\u653b\u51fb\n                    this.moveStep={x:0,y:0};\n                    if(ResourceData.Skill[this.usedSkillName].effect.fromShow)this.playEffects(ResourceData.Skill[this.usedSkillName].effect.fromShow,\n                        {x:this.relativePosition.x-16,y:this.relativePosition.y-16},{width:96,height:96});\n                    if(ResourceData.Skill[this.usedSkillName].effect.toShow)this.playEffects(ResourceData.Skill[this.usedSkillName].effect.toShow,\n                        {x:this.toGameRoleArray[0].relativePosition.x-32,y:this.toGameRoleArray[0].relativePosition.y-32},{width:192,height:192});\n                    this.setBattleState(ResourceData.BattleState.attack);\n\n                    var DHP=getDHP(this,this.toGameRoleArray[0])\n                    this.toGameRoleArray[0].showNumber({x:40,y:40},DHP);\n                    if(DHP&lt;0)this.toGameRoleArray[0].setBattleState(ResourceData.BattleState.underFire);\n                    this.toGameRoleArray[0].HP+=DHP;\n                    if(this.toGameRoleArray[0].HP&lt;=0)this.toGameRoleArray[0].HP=0;\n                }else if(this.attackTime==(MTime+ATime)){\/\/\u8fd4\u56de\n                    this.moveStep={x:(this.basePosition.x-this.relativePosition.x)*1.0\/MTime,\n                        y:(this.basePosition.y-this.relativePosition.y)*1.0\/MTime};\n                    this.setBattleState(ResourceData.BattleState.moveBack);\n                    if(this.toGameRoleArray[0].HP&lt;=0){\n                        this.toGameRoleArray[0].setBattleState(ResourceData.BattleState.die);\n                        this.toGameRoleArray[0].bodyState.died=true;\n                    }\n                    else {\n                        this.toGameRoleArray[0].setBattleState(ResourceData.BattleState.stand);\n                    }\n                }else if(this.attackTime==(MTime*2+ATime)){\/\/\u653b\u51fb\u5b8c\u6210\n                    this.moveStep={x:0,y:0};\n                    this.setBattleState(ResourceData.BattleState.stand);\n                    this.isAttacking=false;\n                    GFunction.nextBattle();\n                }\n            }else{\n                if(this.attackTime==0){\/\/\u541f\u5531\n                    this.playEffects(ResourceData.Skill[this.usedSkillName].effect.fromShow,\n                        {x:this.relativePosition.x-16,y:this.relativePosition.y-16},{width:96,height:96});\n                    this.setBattleState(ResourceData.BattleState.stand);\n                }else if(this.attackTime==MTime){\/\/\u65bd\u653e\n                    for(var i1=0;i1&lt;this.toGameRoleArray.length;i1++){\n                        this.playEffects(ResourceData.Skill[this.usedSkillName].effect.toShow,\n                            {x:this.toGameRoleArray[i1].relativePosition.x-32,y:this.toGameRoleArray[i1].relativePosition.y-32},{width:192,height:192});\n                        if(this.usedGoods){\n                            this.toGameRoleArray[i1].useGoods(this.usedGoods);\n                        }else{\n                            var DHP=getDHP(this,this.toGameRoleArray[i1])\n                            this.toGameRoleArray[i1].showNumber({x:40,y:40},DHP);\n                            if(DHP&lt;0)this.toGameRoleArray[i1].setBattleState(ResourceData.BattleState.underFire);\n                            this.toGameRoleArray[i1].HP+=DHP;\n                            if(this.toGameRoleArray[i1].HP&lt;=0){\n                                this.toGameRoleArray[i1].HP=0;\n                            }\n                        }\n                    }\n                }else if(this.attackTime==(MTime+ATime)){\n                    for(var i1=0;i1&lt;this.toGameRoleArray.length;i1++){\n                        if(this.toGameRoleArray[i1].HP&lt;=0){\n                            this.toGameRoleArray[i1].setBattleState(ResourceData.BattleState.die);\n                            this.toGameRoleArray[i1].bodyState.died=true;\n                        }\n                        else  this.toGameRoleArray[i1].setBattleState(ResourceData.BattleState.stand);\n                    }\n                }else if(this.attackTime==(MTime*2+ATime)){\n                    this.setBattleState(ResourceData.BattleState.stand);\n                    this.isAttacking=false;\n                    GFunction.nextBattle();\n                }\n            }\n            this.attackTime++;\n        }\n        function getDHP(_this,toGameRole){\n            var data={};\n            if(ResourceData.Skill[_this.usedSkillName].damageType==\"attack\")data.ATK=_this.getATK();\n            else if(ResourceData.Skill[ _this.usedSkillName].damageType==\"magic\")data.MTK=_this.getMATK();\n            var toDEF=toGameRole.getDEF();\n            var toMDEF=toGameRole.getMDEF();\n            if(toGameRole.bodyState.defend){\n                toDEF=toDEF*2;\n                toMDEF=toMDEF*2;\n            }\n            var DHP1=0;\n            if(data.ATK)DHP1+=toDEF\/5.0-data.ATK;\n            if(data.MATK)DHP1+=toMDEF\/5.0-data.MATK;\n            if(DHP1&gt;0)DHP1=0;\n            return parseInt(DHP1);\n        }\n    },\n    getSaveData:function(){\n        var saveData={};\n        saveData.GameRoleData=this.GameRoleData;\n        saveData.base=this.base;\n        saveData.HP=this.HP;\n        saveData.MP=this.MP;\n        saveData.level=this.level;\n        saveData.bodySlots=this.bodySlots;\n        return saveData;\n    },\n    showNumber:function(p,num){\/\/\u7528\u4e8e\u663e\u793a\u589e\u52a0\u548c\u51cf\u5c11\u751f\u547d\u503c\u548c\u9b54\u6cd5\u503c\n        var strNum=Math.abs(num).toString();\n        var numSize=ResourceData.Images.DamageNumber.cellSize;\n        var w=strNum.length*numSize.width;\n        var showNumberObj=new JControls.Object({x:p.x-w\/2,y:p.y}, {width:w,height:numSize.height});\n        showNumberObj.moveStep={x:0,y:-4};\n        showNumberObj.endShow=function(){\n            if (this.canMove &amp;&amp; this.moveStep) {\n                this.relativePosition.x += this.moveStep.x;\n                this.relativePosition.y += this.moveStep.y;\n            }\n            this.alpha-=0.05;\n            if(this.alpha&lt;=0){\n                this.remove();\n            }\n        }\n        var n=[]\n        for(var i=0;i&lt;strNum.length;i++){\n            n[i]=new JControls.PictureBox({x:i*numSize.width,y:0},numSize)\n                .setPicture(ResourceData.Images.DamageNumber,{x:parseInt(strNum[i])*numSize.width,y:num&gt;=0?numSize.height:0});\n        }\n        showNumberObj.addControlInLast(n);\n    }\n});\n\u5176\u4e2dResourceData.GameRole\u5982\u4e0b\uff1a\nvar ResourceData= {\n    GameRole:{\n        Leader0:{headImageName:\"ZSTX\",jobsName:\"Soldier\", growUp:{STR:8,VIT:8,DEX:5,INT:4,HP:20,MP:5},\n            animation:{ move:\"ZS1_move\",battle:\"ZS1_battle\"},\n            skills:\"attack1\"\n        }\n    }\n}\nResourceData.Skill\u5982\u4e0b\uff1a\nvar ResourceData= {\n    Skill:{\n        \/\/showName:\u6280\u80fd\u540d\u79f0\uff0cskillLevel\uff1a\u6280\u80fd\u7ea7\u522b\uff0ctoMove:\u662f\u5426\u8981\u8fd1\u8eab,damageType\uff1a\u6280\u80fd\u4f24\u5bb3\u7c7b\u578b(attack,magic)\n        attack:{showName:\"\u666e\u901a\u653b\u51fb\",toMove:true,damageType:\"attack\",toRival:true,fromGameRole:{level:1},toGameRole:{num:1},effect:{num:1}}\n    }\n}\n\u628a\u6240\u6709\u5bf9\u8c61\u90fd\u8bbe\u8ba1\u597d\u4e4b\u540e\uff0c\u5c31\u662f\u8bbe\u8ba1\u6e38\u620f\u754c\u9762\u4e86\u3002","categories":"\u7b2c\u56db\u6b65","tags":["HTML5"]},{"title":"\u6e38\u620f\u754c\u9762\u8bbe\u8ba1\uff08\u4e00\uff09","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/3F05B0A70B69E895.html","content":"\u6e38\u620f\u754c\u9762\u8bbe\u8ba1\uff08\u4e00\uff09\n\u6e38\u620f\u754c\u9762\u5305\u62ec\u5730\u56fe\u3001\u4e3b\u89d2\u3001\u64cd\u4f5c\u754c\u9762\u3001\u6218\u6597\u754c\u9762\u3001\u6570\u636e\u754c\u9762\u7b49\u3002\n1\u3001\u5730\u56fe\n\u8981\u663e\u793a\u5730\u56fe\uff0c\u9996\u5148\u6211\u4eec\u8981\u6709\u5730\u56fe\u6570\u636e\uff0c\u4e3a\u4e86\u65b9\u4fbf\u7f16\u8f91\uff0c\u9700\u8981\u4e00\u4e2a\u5730\u56fe\u7f16\u8f91\u5668\uff0c\u8fd9\u91cc\u6211\u5c31\u968f\u673a\u751f\u6210\u8ff7\u5bab\u5730\u56fe\u6765\u83b7\u53d6\u5730\u56fe\u6570\u636e\u3002\n\u968f\u673a\u751f\u6210\u8ff7\u5bab\u5730\u56fe\u65b9\u6cd5\u5982\u4e0b\uff1a\n\nGFunction.createMap=function(){\/\/\u81ea\u52a8\u751f\u6210\u8ff7\u5bab\u5730\u56fe\n    var autoMapNum=0;\/\/\u4f7f\u7528\u7684\u8ff7\u5bab\u5730\u56fe\u56fe\u7247\u7f16\u53f7\n    var cells=[];\/\/\u8bb0\u5f55\u5730\u56fe\u6570\u636e\uff0c\uff08true\u4e3a\u53ef\u901a\u884c\uff0cfalse\u4e3a\u4e0d\u53ef\u901a\u884c\uff09\n    var minNum=40;\/\/\u5730\u56fe\u884c\u548c\u5217\u6700\u5c0f\u5355\u5143\u6570\n    var maxNum=100;\/\/\u5730\u56fe\u884c\u548c\u5217\u6700\u5927\u5355\u5143\u6570\n    var minLengthNum=19;\/\/\u5165\u53e3\u548c\u51fa\u53e3\u76f8\u9694\u7684\u6700\u5c0f\u5355\u5143\u6570\n    var sizeNum={x:JFunction.Random(minNum,maxNum),y:JFunction.Random(minNum,maxNum)};\/\/\u968f\u673a\u751f\u6210\u884c\u548c\u5217\u5355\u5143\u6570\n    for(var i=0;i&lt;sizeNum.y;i++){\n        cells[i]=[];\n    }\n    var inPoint={x:JFunction.Random(0,sizeNum.x-1),y:JFunction.Random(0,sizeNum.y-1)};\/\/\u968f\u673a\u751f\u6210\u5165\u53e3\n    cells[inPoint.y][inPoint.x]=true;\n    var outPoint={x:JFunction.Random(0,sizeNum.x-1),y:JFunction.Random(0,sizeNum.y-1)};\/\/\u968f\u673a\u751f\u6210\u51fa\u53e3\n    while(Math.abs(outPoint.x-inPoint.x)&lt;minLengthNum&amp;&amp;Math.abs(outPoint.y-inPoint.y)&lt;minLengthNum){\/\/\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u91cd\u65b0\u751f\u6210\u51fa\u53e3\n        outPoint={x:JFunction.Random(0,sizeNum.x-1),y:JFunction.Random(0,sizeNum.y-1)};\n    }\n    cells[outPoint.y][outPoint.x]=true;\n    var blockPoint,blockSizeNum={},num=20;\n    while(num&gt;0||!isLink()){\/\/\u751f\u6210\u5730\u56fe\u53ef\u901a\u884c\u5355\u5143\n        var n=JFunction.Random(0,1);\n        blockPoint={x:JFunction.Random(0,sizeNum.x-1),y:JFunction.Random(0,sizeNum.y-1)};\n        if(n){\n            blockSizeNum.x=JFunction.Random(5,10);\n            blockSizeNum.y=JFunction.Random(1,2);\n        }else{\n            blockSizeNum.x=JFunction.Random(1,2);\n            blockSizeNum.y=JFunction.Random(5,10);\n        }\n        for(var r=blockPoint.y;r&lt;blockPoint.y+blockSizeNum.y&amp;&amp;r&lt;sizeNum.y;r++){\n            for(var c=blockPoint.x;c&lt;blockPoint.x+blockSizeNum.x&amp;&amp;c&lt;sizeNum.x;c++){\n                cells[r][c]=true;\n            }\n        }\n        num--;\n    }\n    var AM = {widthNum:sizeNum.x, heightNum:sizeNum.y,inPoint:inPoint,outPoint:outPoint, BGPicName:ResourceData.AutoMap[autoMapNum].BGPicName,BGWalk:false};\n    for(var r=0;r&lt;sizeNum.y;r++){\n        for(var c=0;c&lt;sizeNum.x;c++){\n            if(cells[r][c]){\/\/\u8bbe\u7f6e\u53ef\u901a\u884c\u5355\u5143\u7684\u5730\u56fe\u6570\u636e\n                if (!AM[r]) AM[r] = {};\n                AM[r][c] = {};\n                AM[r][c][\"mapPicName\"] = ResourceData.AutoMap[autoMapNum].roadName;\n                AM[r][c][\"walk\"] = true;\n            }else if(r&gt;0&amp;&amp;cells[r-1][c]){\/\/\u8bbe\u7f6e\u53ef\u901a\u884c\u533a\u57df\u5730\u56fe\u8fb9\u754c\u6570\u636e\n                if (!AM[r]) AM[r] = {};\n                AM[r][c] = {};\n                AM[r][c][\"mapPicName\"] = ResourceData.AutoMap[autoMapNum].railName;\n                AM[r][c][\"walk\"] = false;\n            }\n        }\n    }\n    var TreasureNum=JFunction.Random(10,50);\/\/\u968f\u673a\u751f\u6210\u5b9d\u7bb1\u6570\u91cf\n    for(var n=0;n&lt;TreasureNum;n++){\/\/\u751f\u6210\u5b9d\u7bb1\u6570\u636e\n        var TreasurePointX=JFunction.Random(0,sizeNum.x-1);\n        var TreasurePointY=JFunction.Random(0,sizeNum.y-1);\n        while(!cells[TreasurePointY][TreasurePointX]||(TreasurePointX==inPoint.x&amp;&amp;TreasurePointY==inPoint.y)||(TreasurePointX==outPoint.x&amp;&amp;TreasurePointY==outPoint.y)){\n            TreasurePointX=JFunction.Random(0,sizeNum.x-1);\n            TreasurePointY=JFunction.Random(0,sizeNum.y-1);\n        }\n        AM[TreasurePointY][TreasurePointX].Treasure={};\n        AM[TreasurePointY][TreasurePointX].Treasure.walk=false;\n        AM[TreasurePointY][TreasurePointX].Treasure.eventData={};\n        var n1=JFunction.Random(1,100);\n        var gn=0\n        if(n1&lt;=50){\n            AM[TreasurePointY][TreasurePointX].Treasure.TreasureName=\"Treasure_1\";\n            AM[TreasurePointY][TreasurePointX].Treasure.eventData.goldNum=JFunction.Random(20,50);\n            gn=JFunction.Random(0,1);\n        }else if(n1&lt;=80){\n            AM[TreasurePointY][TreasurePointX].Treasure.TreasureName=\"Treasure_2\";\n            AM[TreasurePointY][TreasurePointX].Treasure.eventData.goldNum=JFunction.Random(50,100);\n            gn=JFunction.Random(0,2);\n        }else if(n1&lt;=90){\n            AM[TreasurePointY][TreasurePointX].Treasure.TreasureName=\"Treasure_3\";\n            AM[TreasurePointY][TreasurePointX].Treasure.eventData.goldNum=JFunction.Random(100,200);\n            gn=JFunction.Random(0,3);\n        }else if(n1&lt;=95){\n            AM[TreasurePointY][TreasurePointX].Treasure.TreasureName=\"Treasure_4\";\n            AM[TreasurePointY][TreasurePointX].Treasure.eventData.goldNum=JFunction.Random(200,500);\n            gn=JFunction.Random(0,4);\n        }else if(n1&lt;=98){\n            AM[TreasurePointY][TreasurePointX].Treasure.TreasureName=\"Treasure_5\";\n            AM[TreasurePointY][TreasurePointX].Treasure.eventData.goldNum=JFunction.Random(500,1000);\n            gn=JFunction.Random(0,5);\n        }else if(n1&lt;=100){\n            AM[TreasurePointY][TreasurePointX].Treasure.eventData.goldNum=JFunction.Random(1000,2000);\n            AM[TreasurePointY][TreasurePointX].Treasure.TreasureName=\"Treasure_6\";\n            gn=JFunction.Random(0,6);\n        }\n        var str=\"\";\n        for(var i=0;i&lt;gn;i++){\n            var n2=JFunction.Random(1,100);\n            str+=(i&gt;0?\",\":\"\")+getGoods(n2);\n        }\n        AM[TreasurePointY][TreasurePointX].Treasure.eventData.goods=str;\n    }\n\n    \/\/\u8bbe\u7f6e\u4f20\u9001\u9635\u6570\u636e\n    if(GMain.FloorsNum&gt;1){\n        AM[inPoint.y][inPoint.x].JumpToMap={PicName:ResourceData.AutoMap[autoMapNum].inPointName,eventData:{goToFloorNum:GMain.FloorsNum-1}};\n    }\n    AM[outPoint.y][outPoint.x].JumpToMap={PicName:ResourceData.AutoMap[autoMapNum].outPointName,eventData:{goToFloorNum:GMain.FloorsNum+1}};\n    return AM;\n    function isLink(){\/\/\u68c0\u67e5\u751f\u6210\u7684\u5730\u56fe\u5165\u53e3\u548c\u51fa\u53e3\u662f\u5426\u76f8\u8fde\n        var cellsA=[inPoint];\n        var cellsB=[];\n        for(var i=0;i&lt;sizeNum.y;i++){\n            cellsB[i]=[];\n        }\n        cellsB[cellsA[0].y][cellsA[0].x]=true;\n        for(var l=0;l&lt;cellsA.length;l++){\n            if((cellsA[l].x-1&gt;=0)&amp;&amp;cells[cellsA[l].y][cellsA[l].x-1]&amp;&amp;!cellsB[cellsA[l].y][cellsA[l].x-1]){\n                cellsB[cellsA[l].y][cellsA[l].x-1]=true;\n                cellsA[cellsA.length]={x:cellsA[l].x-1,y:cellsA[l].y};\n            }\n            if((cellsA[l].y-1&gt;=0)&amp;&amp;cells[cellsA[l].y-1][cellsA[l].x]&amp;&amp;!cellsB[cellsA[l].y-1][cellsA[l].x]){\n                cellsB[cellsA[l].y-1][cellsA[l].x]=true;\n                cellsA[cellsA.length]={x:cellsA[l].x,y:cellsA[l].y-1};\n            }\n            if((cellsA[l].x+1&lt;sizeNum.x)&amp;&amp;cells[cellsA[l].y][cellsA[l].x+1]&amp;&amp;!cellsB[cellsA[l].y][cellsA[l].x+1]){\n                cellsB[cellsA[l].y][cellsA[l].x+1]=true;\n                cellsA[cellsA.length]={x:cellsA[l].x+1,y:cellsA[l].y};\n            }\n            if((cellsA[l].y+1&lt;sizeNum.y)&amp;&amp;cells[cellsA[l].y+1][cellsA[l].x]&amp;&amp;!cellsB[cellsA[l].y+1][cellsA[l].x]){\n                cellsB[cellsA[l].y+1][cellsA[l].x]=true;\n                cellsA[cellsA.length]={x:cellsA[l].x,y:cellsA[l].y+1};\n            }\n            if(cellsB[outPoint.y][outPoint.x])return true;\n        }\n        return false;\n    }\n    function getGoods(n2){\/\/\u968f\u673a\u751f\u6210\u5b9d\u7bb1\u53ca\u5b9d\u7bb1\u7269\u54c1\n        var goods=[];\n        var goodsLevel;\n        if(n2&lt;=50){\n            goodsLevel=1;\n        }else if(n2&lt;=80){\n            goodsLevel=JFunction.Random(1,2);\n        }else if(n2&lt;=90){\n            goodsLevel=JFunction.Random(1,3);\n        }else if(n2&lt;=95){\n            goodsLevel=JFunction.Random(1,4);\n        }else if(n2&lt;=98){\n            goodsLevel=JFunction.Random(1,5);\n        }else if(n2&lt;=100){\n            goodsLevel=JFunction.Random(1,6);\n        }\n        goodsLevel+=parseInt(GMain.FloorsNum\/10);\n        if(goodsLevel&gt;6)goodsLevel=6;\n        for(var g in ResourceData.Goods){\n            if(ResourceData.Goods[g].goodsLevel==goodsLevel){\n                goods[goods.length]=g;\n            }\n        }\n        var n=JFunction.Random(0,goods.length-1);\n        return goods[n];\n    }\n};\n\u6709\u4e86\u5730\u56fe\u6570\u636e\uff0c\u4e0b\u9762\u6211\u5c31\u8981\u52a0\u8f7d\u5730\u56fe\u4e86\uff1a\n\nGFunction.loadMapPanel=function() {\/\/\u52a0\u8f7d\u5730\u56fe\n    \/\/GMain.MapData\u4e3a\u5730\u56fe\u6570\u636e\n    GMain.MapPanel.size={width:GMain.MapData.widthNum*GMain.CellSize.width,height:GMain.MapData.heightNum*GMain.CellSize.height};\n    GMain.MapCells=[];\/\/\u4fdd\u5b58\u5730\u56fe\u5355\u5143\u6570\u636e\n    GMain.MapPanel.clearControls();\/\/\u6e05\u7a7a\u5730\u56fe\u754c\u9762\n    for (var r = 0; r &lt; GMain.MapData.heightNum; r++) {\n        GMain.MapCells[r] = [];\n        for (var c = 0; c &lt; GMain.MapData.widthNum; c++) {\n            \/\/\u751f\u6210\u5730\u56fe\u5355\u5143\uff0c\u5e76\u52a0\u5165\u5230\u5730\u56fe\u754c\u9762\n            GMain.MapCells[r][c] = new GControls.MapCell( {x:c * GMain.CellSize.width, y:r * GMain.CellSize.height}, GMain.CellSize);\n            GMain.MapPanel.addControlInLast([GMain.MapCells[r][c]]);\n            if (GMain.MapData[r] &amp;&amp; GMain.MapData[r][c]) {\n                if(GMain.MapData[r][c][\"mapPicName\"]){\/\/\u8bbe\u7f6e\u5730\u56fe\u5355\u5143\u7684\u56fe\u7247\n                    GMain.MapCells[r][c].setMapPic(GMain.MapData[r][c][\"mapPicName\"]);\n                }else if(GMain.MapData.BGPicName){\n                    GMain.MapCells[r][c].setMapPic(GMain.MapData.BGPicName);\n                }\n                if(GMain.MapData[r][c][\"JumpToMap\"]){\/\/\u5730\u56fe\u5355\u5143\u6dfb\u52a0\u4f20\u9001\u9635\n                    var JumpToMap = new GControls.Trigger({x:0, y:0},\n                        GMain.CellSize, GMain.MapData[r][c][\"JumpToMap\"].PicName,\"JumpToMap\");\n                    JumpToMap.eventData=GMain.MapData[r][c][\"JumpToMap\"].eventData;\n                    GMain.MapCells[r][c].addControlInLast([JumpToMap]);\n                }else if(GMain.MapData[r][c][\"Treasure\"]){\/\/\u5730\u56fe\u5355\u5143\u6dfb\u52a0\u5b9d\u7bb1\n                    var Treasure = new GControls.Trigger({x:0, y:0},\n                        GMain.CellSize, GMain.MapData[r][c][\"Treasure\"].TreasureName);\n                    Treasure.eventData=GMain.MapData[r][c][\"Treasure\"].eventData;\n                    GMain.MapCells[r][c].addControlInLast([Treasure]);\n                }\n            } else {\n                if (GMain.MapData.BGPicName) {\n                    GMain.MapCells[r][c].setMapPic(GMain.MapData.BGPicName);\/\/\u8bbe\u7f6e\u5730\u56fe\u4e0d\u53ef\u901a\u884c\u5355\u5143\u56fe\u7247\n                }\n            }\n        }\n    }\n    var x=GMain.MapData.inPoint.x;\n    var y=GMain.MapData.inPoint.y;\n    if(GMain.MapPanelRelPos){\n        GMain.MapPanel.setRelativePosition({x:GMain.MapPanelRelPos.x,y:GMain.MapPanelRelPos.y});\n        GMain.MapPanelRelPos=null;\n    }else{\n        \/\/\u901a\u8fc7\u8bbe\u7f6e\u5730\u56fe\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u4f7f\u5c4f\u5e55\u4e2d\u5fc3\u5904\u4e8e\u5165\u53e3\u9644\u8fd1\n        if((y+1)&lt;GMain.MapData.heightNum &amp;&amp;GMain.MapCells[y+1][x].walk){\n            GMain.MapPanel.setRelativePosition({x:GMain.CellSize.width*(GMain.InPoint.x-x), y:GMain.CellSize.height*(GMain.InPoint.y-y-1)});\n        }else if((x+1)&lt;GMain.MapData.widthNum &amp;&amp;GMain.MapCells[y][x+1].walk){\n            GMain.MapPanel.setRelativePosition({x:GMain.CellSize.width*(GMain.InPoint.x-x-1), y:GMain.CellSize.height*(GMain.InPoint.y-y)});\n        }else if((y-1)&gt;=0 &amp;&amp;GMain.MapCells[y-1][x].walk){\n            GMain.MapPanel.setRelativePosition({x:GMain.CellSize.width*(GMain.InPoint.x-x), y:GMain.CellSize.height*(GMain.InPoint.y-y+1)});\n        }else if((x-1)&gt;=0 &amp;&amp;GMain.MapCells[y][x-1].walk){\n            GMain.MapPanel.setRelativePosition({x:GMain.CellSize.width*(GMain.InPoint.x-x+1), y:GMain.CellSize.height*(GMain.InPoint.y-y)});\n        }\n    }\n    GMain.MapPanel.saveShowImageData();\/\/\u7f13\u5b58\u5730\u56fe\uff0c\u4ee5\u63d0\u9ad8\u901f\u5ea6\n};\n2\u3001\u4e3b\u89d2\n\u8fd9\u91cc\u6211\u4eec\u53ea\u663e\u793a\u4e00\u4e2a\u4e3b\u89d2\uff0c\u76f4\u63a5\u628a\u4e3b\u89d2\u56fa\u5b9a\u5728\u5c4f\u5e55\u4e2d\u95f4\u3002\nGMain.BattlesGameRole[0][0]=new GControls.GameRole(\"Leader0\");\nGMain.BattlesGameRole[0][0].initMove();\/\/\u521d\u59cb\u5316\u884c\u8d70\n3\u3001\u64cd\u4f5c\u754c\u9762\n\u64cd\u4f5c\u754c\u9762\u5305\u62ec\u65b9\u5411\u6309\u94ae\u3001\u786e\u5b9a\u53d6\u6d88\u6309\u94ae\u4ee5\u53ca\u5176\u4ed6\u754c\u9762\u5207\u6362\u6309\u94ae\u3002\n\u4ee3\u7801\u5982\u4e0b\uff1a\nGFunction.loadButtonPanel=function(){\n    \/\/\u52a0\u8f7d\u64cd\u4f5c\u754c\u9762\n    var btnOpenData=new JControls.Button({x:10,y:0},{width:80,height:30}).setBGColor(JColor.gray).setText(\"\u7269\u54c1\");\n    btnOpenData.onClick=function(){\n        GFunction.showDataPanel();\/\/\u663e\u793a\u4eba\u7269\u6570\u636e\u548c\u4f7f\u7528\u7269\u54c1\n        return true;\n    }\n    var btnShowShop=new JControls.Button({x:100,y:0},{width:80,height:30}).setBGColor(JColor.gray).setText(\"\u5546\u5e97\");\n    btnShowShop.onClick=function(){\n        \/\/GFunction.showShop();\n        return true;\n    }\n    var btnSaveData=new JControls.Button({x:190,y:0},{width:80,height:30}).setBGColor(JColor.gray).setText(\"\u4fdd\u5b58\");\n    btnSaveData.onClick=function(){\n        GFunction.showSavePanel();\/\/\u4fdd\u5b58\u6e38\u620f\n        return true;\n    }\n    var btnMainMenu=new JControls.Button({x:280,y:0},{width:80,height:30}).setBGColor(JColor.gray).setText(\"\u9000\u51fa\");\n    btnMainMenu.onClick=function(){\n        GFunction.showMainMenu();\/\/\u9000\u51fa\u6e38\u620f\u5230\u4e3b\u83dc\u5355\n        return true;\n    }\n\n    var BtnKeyDown=function(keyCode){\n        if(keyCode==this.keyCode){\n            if(keyCode&gt;=37&amp;&amp;keyCode&lt;=40){\n                GMain.BattlesGameRole[0][0].setMoveDirection(keyCode);\n                GMain.BattlesGameRole[0][0].stopPlayAnimation=false;\n            }\n            var x=GMain.BattlesGameRole[0][0].position.x;\n            var y=GMain.BattlesGameRole[0][0].position.y;\n            var c=parseInt((x-GMain.MapPanel.position.x+GMain.CellSize.width\/2)\/GMain.CellSize.width);\n            var r=parseInt((y-GMain.MapPanel.position.y+GMain.CellSize.width)\/GMain.CellSize.width);\n            switch (GMain.BattlesGameRole[0][0].moveDirection){\n                case GMain.Direction.left:c-=1;break;\/\/\u5de6\n                case GMain.Direction.up:r-=1;break;\/\/\u4e0a\n                case GMain.Direction.right:c+=1; break;\/\/\u53f3\n                case GMain.Direction.down:r+=1;break;\/\/\u4e0b\n            }\n            if(GMain.MapCells[r][c]){\n                if(GMain.MapCells[r][c].controls.length&gt;0){\n                    if(!GMain.MapCells[r][c].controls[0].open){\n                        GMain.MapCells[r][c].controls[0].onTrigger();\/\/\u89e6\u53d1\n                    }\n                }\n            }\n            return true;\n        }else return false;\n    };\n    var btnKeyUp=function(keyCode){\n        if(keyCode==this.keyCode){\n            if(keyCode&gt;=37&amp;&amp;keyCode&lt;=40){\n                GMain.MapPanel.moveStep=null;\n                GMain.BattlesGameRole[0][0].stopPlayAnimation=true;\n            }\n            return true;\n        }else return false;\n    };\n\n    var btnW=80,btnH=80,jl=10;\n    var btnLeft=new JControls.Button({x:0,y:GMain.Size.height-btnH-btnW-jl},{width:btnH,height:btnW},null)\n        .setKeyCode(37);\n    btnLeft.onKeyDown=BtnKeyDown;\n    btnLeft.onKeyUp=btnKeyUp;\n    var btnTop=new JControls.Button({x:btnH+jl,y:GMain.Size.height-btnH*2-btnW-jl*2},{width:btnW,height:btnH},null)\n        .setKeyCode(38);\n    btnTop.onKeyDown=BtnKeyDown;\n    btnTop.onKeyUp=btnKeyUp\n    var btnRight=new JControls.Button({x:btnH+btnW+jl*2,y:GMain.Size.height-btnH-btnW-jl},{width:btnH,height:btnW},null)\n        .setKeyCode(39);\n    btnRight.onKeyDown=BtnKeyDown;\n    btnRight.onKeyUp=btnKeyUp;\n    var btnBottom=new JControls.Button({x:btnH+jl,y:GMain.Size.height-btnH},{width:btnW,height:btnH},null)\n        .setKeyCode(40);\n    btnBottom.onKeyDown=BtnKeyDown;\n    btnBottom.onKeyUp=btnKeyUp;\n    var btnOK=new JControls.Button({x:GMain.Size.width-100,y:GMain.Size.height-110},{width:100,height:100},null)\n        .setKeyCode(13);\n    btnOK.onKeyDown=BtnKeyDown;\n    btnOK.onKeyUp=btnKeyUp;\n    var btnCancel=new JControls.Button({x:GMain.Size.width-100,y:GMain.Size.height-250},{width:100,height:100},null)\n        .setKeyCode(27);\n    btnCancel.onKeyDown=BtnKeyDown;\n    btnCancel.onKeyUp=btnKeyUp;\n    GMain.ButtonPanel.addControlInLast([btnOpenData,btnSaveData,btnMainMenu,btnShowShop,btnLeft,btnTop,btnRight,btnBottom,btnOK,btnCancel]);\n};\n\u6700\u540e\u8981\u663e\u793a\u8fd9\u4e9b\u754c\u9762\uff0c\u8fd8\u9700\u8981\u628a\u4ed6\u4eec\u52a0\u5165\u5230\u5c4f\u5e55\u4e0a\u6765\u3002\nJMain.JForm.addControlInLast([GMain.MapPanel,GMain.BattlesGameRole[0][0],GMain.BattlePanel,GMain.DataPanel,GMain.SavePanel ,GMain.ButtonPanel])\n\u540e\u9762\u5c06\u4ecb\u7ecd\u6218\u6597\u754c\u9762\u548c\u6570\u636e\u754c\u9762\u3002","categories":"\u7b2c\u4e94\u6b65","tags":["HTML5"]},{"title":"\u6e38\u620f\u754c\u9762\u8bbe\u8ba1\uff08\u4e8c\uff09","url":"https:\/\/naka1205.github.io\/h5rpg\/p\/906DB896392B9838.html","content":"\u6e38\u620f\u754c\u9762\u8bbe\u8ba1\uff08\u4e8c\uff09\n3\u3001\u6218\u6597\u754c\u9762\n\u6218\u6597\u754c\u9762\u662f\u7ecf\u5178\u7684\u56de\u5408\u5236\u6218\u6597\u754c\u9762\uff0c\u5176\u4ee3\u7801\u5982\u4e0b\uff1a\nGFunction.loadBattlePanel=function(){\/\/\u52a0\u8f7d\u6218\u6597\u754c\u9762\n    GMain.BattlePanel.clearControls();\n    var battlePanel=new JControls.Panel({x:0,y:0},GMain.Size);\n    battlePanel.setBGImage(ResourceData.Images.battleBG1);\n    battlePanel.loadData=function(){\/\/\u52a0\u8f7d\u89d2\u8272\u5230\u6218\u6597\u754c\u9762\n        this.clearControls();\n        if(GMain.BattlesGameRole[1].length==1){\n            GMain.BattlesGameRole[1][0].setRelativePosition({x:150,y:70});\n        }else if(GMain.BattlesGameRole[1].length==2){\n            GMain.BattlesGameRole[1][0].setRelativePosition({x:80,y:120});\n            GMain.BattlesGameRole[1][1].setRelativePosition({x:280,y:20});\n        }else if(GMain.BattlesGameRole[1].length==3){\n            GMain.BattlesGameRole[1][0].setRelativePosition({x:80,y:230});\n            GMain.BattlesGameRole[1][1].setRelativePosition({x:280,y:130});\n            GMain.BattlesGameRole[1][2].setRelativePosition({x:480,y:30});\n        }else if(GMain.BattlesGameRole[1].length==4){\n            GMain.BattlesGameRole[1][0].setRelativePosition({x:40,y:120});\n            GMain.BattlesGameRole[1][1].setRelativePosition({x:240,y:20});\n            GMain.BattlesGameRole[1][2].setRelativePosition({x:180,y:180});\n            GMain.BattlesGameRole[1][3].setRelativePosition({x:380,y:80});\n        }else if(GMain.BattlesGameRole[1].length==5){\n            GMain.BattlesGameRole[1][0].setRelativePosition({x:80,y:100});\n            GMain.BattlesGameRole[1][1].setRelativePosition({x:280,y:0});\n            GMain.BattlesGameRole[1][2].setRelativePosition({x:80,y:230});\n            GMain.BattlesGameRole[1][3].setRelativePosition({x:280,y:130});\n            GMain.BattlesGameRole[1][4].setRelativePosition({x:480,y:30});\n        }\n        this.addControlInLast(GMain.BattlesGameRole[1]);\n        var size1={x:400,y:380};\n        if(GMain.BattlesGameRole[0].length==1){\n            GMain.BattlesGameRole[0][0].setRelativePosition({x:size1.x+180,y:size1.y-120});\n        }else if(GMain.BattlesGameRole[0].length==2){\n            GMain.BattlesGameRole[0][0].setRelativePosition({x:size1.x+120,y:size1.y-80});\n            GMain.BattlesGameRole[0][1].setRelativePosition({x:size1.x+240,y:size1.y-160});\n        }else if(GMain.BattlesGameRole[0].length==3){\n            GMain.BattlesGameRole[0][0].setRelativePosition({x:size1.x+60,y:size1.y-40});\n            GMain.BattlesGameRole[0][1].setRelativePosition({x:size1.x+180,y:size1.y-120});\n            GMain.BattlesGameRole[0][2].setRelativePosition({x:size1.x+300,y:size1.y-200});\n        }else if(GMain.BattlesGameRole[0].length==4){\n            GMain.BattlesGameRole[0][0].setRelativePosition({x:size1.x,y:size1.y});\n            GMain.BattlesGameRole[0][1].setRelativePosition({x:size1.x+80,y:size1.y-50});\n            GMain.BattlesGameRole[0][2].setRelativePosition({x:size1.x+160,y:size1.y-100});\n            GMain.BattlesGameRole[0][3].setRelativePosition({x:size1.x+240,y:size1.y-150});\n        }\n        this.addControlInLast(GMain.BattlesGameRole[0]);\n    };\n\n    \/\/\u52a0\u8f7d\u6218\u6597\u63a7\u5236\u9762\u677f\n    GMain.BattleControlPanel=new JControls.Panel({x:GMain.Size.width-80, y:120},{width:80,height:200});\n    GMain.BattleControlPanel.loadData=function(){\n        this.clearControls();\n        var btnAttack=new JControls.Button({x:0,y:0},{width:80,height:40});\n        btnAttack.buttonLabel.setText(\"\u653b\u51fb\").setFontType(\"bold\").setFontSize(22).setTextPos({x:15,y:5});\n        btnAttack.BGColor=JColor.white;\n        btnAttack.onClick=function(){\n            GMain.FromAttackSelect=true;\n            JMain.JForm.canvas.style.cursor=\"pointer\"\n            GMain.BattlesGameRole[0][GMain.SelectLeaderNum].usedSkillName=\"attack1\";\n        }\n        var btnSkill=new JControls.Button({x:0,y:40},{width:80,height:40});\n        btnSkill.buttonLabel.setText(\"\u6280\u80fd\").setFontType(\"bold\").setFontSize(22).setTextPos({x:15,y:5});\n        btnSkill.BGColor=JColor.white;\n        btnSkill.onClick=function(){\n            JMain.JForm.canvas.style.cursor=\"default\"\n            GMain.SkillSelectPanel.loadSkill();\n        }\n        var btnDefense=new JControls.Button({x:0,y:80},{width:80,height:40});\n        btnDefense.buttonLabel.setText(\"\u9632\u5fa1\").setFontType(\"bold\").setFontSize(22).setTextPos({x:15,y:5});\n        btnDefense.BGColor=JColor.white;\n        btnDefense.onClick=function(){\n            JMain.JForm.canvas.style.cursor=\"default\"\n            GMain.BattlesGameRole[0][GMain.SelectLeaderNum].bodyState.defend=true;\n            GMain.BattlesGameRole[0][GMain.SelectLeaderNum].clearControls();\n            GFunction.nextAttackSelect();\n        }\n        var btnDrug=new JControls.Button({x:0,y:120},{width:80,height:40});\n        btnDrug.buttonLabel.setText(\"\u7269\u54c1\").setFontType(\"bold\").setFontSize(22).setTextPos({x:15,y:5});\n        btnDrug.BGColor=JColor.white;\n        btnDrug.onClick=function(){\n            JMain.JForm.canvas.style.cursor=\"default\"\n            GMain.DrugUsePanel.loadDrug();\n        }\n        GMain.BattleBtnRunAway=new JControls.Button({x:0,y:160},{width:80,height:40});\n        GMain.BattleBtnRunAway.buttonLabel.setText(\"\u9003\u8dd1\").setFontSize(22).setFontType(\"bold\").setTextPos({x:15,y:5});\n        GMain.BattleBtnRunAway.BGColor=JColor.white;\n        GMain.BattleBtnRunAway.onClick=function(){\n            JMain.JForm.canvas.style.cursor=\"default\"\n            if(JFunction.Random(1,100)&lt;=95){\n                GFunction.showMapPanel();\n            }else{\n                new JControls.MessageBox({width:200,height:0},[\"\u9003\u8dd1\u5931\u8d25\uff01\"]);\n                this.enabled=false;\n            }\n        }\n        this.addControlInLast([btnAttack,btnSkill,btnDefense,btnDrug, GMain.BattleBtnRunAway]);\n    };\n    GMain.SkillSelectPanel=new JControls.Panel({x:200,y:80},{width:400,height:240});\n    GMain.SkillSelectPanel.BGColor=JColor.gray;\n    GMain.SkillSelectPanel.visible=false;\n    GMain.SkillSelectPanel.loadSkill=function(){\/\/\u52a0\u8f7d\u6280\u80fd\u4f7f\u7528\u9762\u677f\n        this.clearControls();\n        this.visible=true;\n        this.isShowTitle=false;\n        this.showTitle(\"\u6280\u80fd\");\n        var skillName=GMain.BattlesGameRole[0][GMain.SelectLeaderNum].gameRoleData.skills.split(\",\");\n        var skillsButtons=[];\n        for(var i=0;i&lt;skillName.length;i++){\n            if(GMain.BattlesGameRole[0][GMain.SelectLeaderNum].level&gt;=ResourceData.Skill[skillName[i]].fromGameRole.level){\n                var l=skillsButtons.length;\n                var wNum= 8,cWidth=200,cHeight=40;\n                skillsButtons[l]=new JControls.Button({x:(i%wNum)*cWidth,y:parseInt(i\/2)*cHeight+40},{width:cWidth,height:cHeight});\n                skillsButtons[l].buttonLabel.setText(ResourceData.Skill[skillName[i]].showName).setFontType(\"bold\").setFontSize(22).setTextPos({x:15,y:5});\n                skillsButtons[l].skillName=skillName[i];\n                skillsButtons[l].onClick=function(){\n                    GMain.BattlesGameRole[0][GMain.SelectLeaderNum].usedSkillName=this.skillName;\n                    GMain.SkillSelectPanel.visible=false;\n                    if(ResourceData.Skill[this.skillName].toGameRole.num==1){\n                        GMain.BattleControlPanel.visible=false;\n                        JMain.JForm.canvas.style.cursor=\"pointer\"\n                    }else{\n                        GFunction.nextAttackSelect();\n                    }\n                }\n            }\n        }\n        this.addControlInLast(skillsButtons);\n        this.closeButton.visible=true;\n        this.onCloseButtonClick=function(){\n            GMain.BattleControlPanel.visible=true;\n        };\n    }\n    GMain.DrugUsePanel=new JControls.Panel({x:200,y:80},{width:400,height:240});\n    GMain.DrugUsePanel.BGColor=JColor.gray;\n    GMain.DrugUsePanel.visible=false;\n    GMain.DrugUsePanel.loadDrug=function(){\/\/\u52a0\u8f7d\u7269\u54c1\u4f7f\u7528\u9762\u677f\n        this.clearControls();\n        this.isShowTitle=false;\n        this.showTitle(\"\u7269\u54c1\");\n        this.visible=true;\n        GMain.SelectedGoods=null;\n        \/\/var level=GMain.BattlesGameRole[0][GMain.SelectLeaderNum].level;\n        var drugs=[];\n        for(var i=0;i&lt;GMain.Goods.length;i++){\n            var l=drugs.length;\n            var wNum= 8,cWidth=50,cHeight=50;\n            if(GMain.Goods[i].goodsData.goodsType==\"drug\"){\n                drugs[l]=GMain.Goods[i].setRelativePosition({x:(i%wNum)*cWidth,y:parseInt(i\/wNum)*cHeight+40}).setSize({width:cWidth,height:cHeight});\n                drugs[l].onClick=function(){\n                    GMain.BattlesGameRole[0][GMain.SelectLeaderNum].usedSkillName=\"useDrug\";\n                    GMain.BattlesGameRole[0][GMain.SelectLeaderNum].usedGoods=this;\n                    GMain.DrugUsePanel.visible=false;\n                    if(ResourceData.Goods[this.goodsData.showName].toGameRole.num==1){\n                        GMain.BattleControlPanel.visible=false;\n                        JMain.JForm.canvas.style.cursor=\"pointer\";\n                    }else{\n                        GFunction.nextAttackSelect();\n                    }\n                }\n            }\n        }\n        this.addControlInLast(drugs);\n        this.onCloseButtonClick=function(){\n            GMain.BattleControlPanel.visible=true;\n        }\n    }\n    GMain.BattlePanel.addControlInLast([battlePanel, GMain.BattleControlPanel,GMain.SkillSelectPanel,GMain.DrugUsePanel]);\n};\n4\u3001\u6570\u636e\u754c\u9762\n\u6570\u636e\u754c\u9762\uff0c\u7528\u4e8e\u67e5\u770b\u548c\u4f7f\u7528\u7269\u54c1\u3001\u67e5\u770b\u4e3b\u89d2\u6570\u636e\u7b49\u3002\nGFunction.loadDataPanel=function(){\/\/\u52a0\u8f7d\u6570\u636e\u754c\u9762\n    GMain.DataPanel.clearControls();\n    GMain.DataPanel.loadData=function(){\n        for(var i=0;i&lt;GMain.DataPanel.controls.length;i++){\n            GMain.DataPanel.controls[i].loadData&amp;&amp;GMain.DataPanel.controls[i].loadData();\n        }\n    };\n    var w1=150;\n    var w2=450;\n    var w3=200;\n    var GameRoleHeadPanel=new JControls.Panel({x:0,y:0},{width:w1,height:120});   \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    GameRoleHeadPanel.loadData=function(){\/\/\u52a0\u8f7d\u4e3b\u89d2\u5934\u50cf\n        this.clearControls();\n        var GameRoleHeadPic=new JControls.PictureBox({x:2,y:2},{width:w1-4,height:116});\n        GameRoleHeadPic.setPicture(ResourceData.Images[GMain.BattlesGameRole[0][GMain.SelectLeaderNum].getHeadImageName()]);\n        this.addControlInLast([GameRoleHeadPic]);\n    }\n\n    var LeadersPanel=new JControls.Panel({x:0,y:120},{width:w1,height:96});\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    LeadersPanel.loadData=function(){\/\/\u52a0\u8f7d\u4e3b\u89d2\uff0c\u70b9\u51fb\u53ef\u67e5\u770b\u5176\u6570\u636e\n        this.clearControls();\n        var ls=[];\n        for(var i=0;i&lt;GMain.BattlesGameRole[0].length;i++){\n            ls[i]=new JControls.Label({x:0,y:i*24},GMain.BattlesGameRole[0][i].getShowName()+\"(\"+GMain.BattlesGameRole[0][i].getJobsName()+\")\")\n                .setFontType(\"Bold\").setSize({width:w1,height:24}).setTextPos({x:5,y:2});\n            ls[i].num=i;\n            if(i== GMain.SelectLeaderNum)ls[i].isSelect=true;\n            else ls[i].isSelect=false;\n            ls[i].onClick=function(){\n                GMain.SelectLeaderNum=this.num;\n                GMain.DataPanel.loadData();\n                return true;\n            }\n        }\n        this.addControlInLast(ls);\n    }\n\n    var EquipmentPanel=new JControls.Panel({x:w1,y:0},{width:w2,height:300});\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    EquipmentPanel.loadData=function(){\/\/\u52a0\u8f7d\u5f53\u524d\u9009\u4e2d\u4e3b\u89d2\u8eab\u4e0a\u88c5\u5907\n        this.clearControls();\n        var bodySlotsSize={width:80,height:80};\n        var jg={x:55,y:15};\n        for(var bodySlots in GMain.BattlesGameRole[0][GMain.SelectLeaderNum].bodySlots){\n            if(GMain.BattlesGameRole[0][GMain.SelectLeaderNum].bodySlots[bodySlots]){\n                var p={x:0,y:0};\n                switch (bodySlots){\n                    case \"handR\":\n                        p={x:jg.x,y:bodySlotsSize.height+jg.y*2};\n                        break;\n                    case \"fingerR\":\n                        p={x:jg.x,y:bodySlotsSize.height*2+jg.y*3};\n                        break;\n                    case \"head\":\n                        p={x:bodySlotsSize.width+jg.x*2,y:jg.y};\n                        break;\n                    case \"body\":\n                        p={x:bodySlotsSize.width+jg.x*2,y:bodySlotsSize.height+jg.y*2};\n                        break;\n                    case \"foot\":\n                        p={x:bodySlotsSize.width+jg.x*2,y:bodySlotsSize.height*2+jg.y*3};\n                        break;\n                    case \"neck\":\n                        p={x:bodySlotsSize.width*2+jg.x*3,y:jg.y};\n                        break;\n                    case \"handL\":\n                        p={x:bodySlotsSize.width*2+jg.x*3,y:bodySlotsSize.height+jg.y*2};\n                        break;\n                    case \"fingerL\":\n                        p={x:bodySlotsSize.width*2+jg.x*3,y:bodySlotsSize.height*2+jg.y*3};\n                        break;\n                }\n                GMain.BattlesGameRole[0][GMain.SelectLeaderNum].bodySlots[bodySlots].setRelativePosition(p).setSize(bodySlotsSize);\n                this.addControlInLast([GMain.BattlesGameRole[0][GMain.SelectLeaderNum].bodySlots[bodySlots]]);\n            }\n        }\n    };\n\n    var GoodsPanel=new JControls.Panel({x:w1,y:300},{width:w2,height:180});\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    GoodsPanel.loadData=function(){\/\/\u52a0\u8f7d\u7269\u54c1\u680f\n        this.clearControls();\n        for(var i=0;i&lt;GMain.Goods.length;i++){\n            if(!GMain.Goods[i].isUsed){\n                this.addControlInLast([GMain.Goods[i]]);\n            }\n        }\n        var wNum=10,cWidth=45,cHeight=45;\n        for(var i=0;i&lt;this.controls.length;i++){\n            this.controls[i].setRelativePosition({x:(i%wNum)*cWidth,y:parseInt(i\/wNum)*cHeight}).setSize({width:cWidth,height:cHeight});\n        }\n        this.goldLabel=new JControls.Label({x:50,y:155}).setFontType(\"Bold\");\n        this.goldLabel.setText(\"\u91d1\u5e01:\"+GMain.GoldNum);\n        this.addControlInLast([this.goldLabel]);\n    };\n\n    var GoodsStatsPanel=new JControls.Panel({x:w1+w2,y:0},{width:w3,height:450});\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    GoodsStatsPanel.loadData=function(){\/\/\u52a0\u8f7d\u9009\u4e2d\u7269\u54c1\u7684\u5c5e\u6027\u6570\u636e\n        this.clearControls();\n        if(GMain.SelectedGoods){\n            var goodsName=GMain.SelectedGoods.goodsData.showName;\n            var btnZBSY=new JControls.Label({x:20,y:3}).setFontType(\"Bold\")\n                .setFontColor(JColor.blue).setSize({width:80,height:24}).setBGColor(JColor.red).setTextPos({x:15,y:4});\n            if(GMain.SelectedGoods.isUsed){\n                btnZBSY.setText(\"\u79fb\u9664\u88c5\u5907\");\n            }else{\n                btnZBSY.setText(\"\u4f7f\u7528\u9053\u5177\");\n            }\n            btnZBSY.onClick=function(){\n                if(GMain.SelectedGoods.isUsed)GMain.BattlesGameRole[0][GMain.SelectLeaderNum].deleteCombatGear(GMain.SelectedGoods);\n                else GMain.BattlesGameRole[0][GMain.SelectLeaderNum].useGoods(GMain.SelectedGoods);\n                GMain.DataPanel.loadData();\n                return true;\n            }\n            this.addControlInLast([btnZBSY]);\n            var i=0;\n            var h=18, ls=5,th=30;\n            this.addControlInLast([new JControls.Label({x:ls,y:h*(i++)+th},goodsName).setFontType(\"Bold\").setFontColor(JColor.gray)]);\n            this.addControlInLast([new JControls.Label({x:ls,y:h*(i++)+th},\n                \"\u7ea7\u522b\uff1a\"+ResourceData.Evaluation[parseInt(GMain.SelectedGoods.goodsData.goodsLevel)])]);\n            this.addControlInLast([new JControls.Label({x:ls,y:h*(i++)+th},\n                \"\u7c7b\u578b\uff1a\"+ResourceData.GoodsType[GMain.SelectedGoods.goodsData.goodsType])]);\n            for(var attribute in GMain.SelectedGoods.goodsData.attributes){\n                this.addControlInLast([new JControls.Label({x:ls,y:h*(i++)+th},ResourceData.AttributesName[attribute]+\"\uff1a\"+ GMain.SelectedGoods.goodsData.attributes[attribute])]);\n            }\n\n        }\n    };\n    var ButtonPanel=new JControls.Panel({x:w1+w2,y:450},{width:w3,height:30});\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    ButtonPanel.loadData=function(){\/\/\u7ee7\u7eed\u6e38\u620f\u6309\u94ae\n        this.clearControls();\n        var btnGoBack=new JControls.Button({x:20,y:0},{width:110,height:30}).setBGColor(JColor.gray).setText(\"\u7ee7\u7eed\u6e38\u620f\");\n        btnGoBack.onClick=function(){\n            GFunction.showMapPanel();\n            return true;\n        }\n        this.addControlInLast([btnGoBack]);\n    }\n    var BaseStatsPanel=new JControls.Panel({x:0,y:216},{width:w1,height:336});\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    BaseStatsPanel.loadData=function(){\/\/\u52a0\u8f7d\u9009\u4e2d\u4e3b\u89d2\u7684\u5404\u9879\u6570\u636e\n        this.clearControls();\n        var bh=20;\n        var i=0\n        var SelectLeader=GMain.BattlesGameRole[0][GMain.SelectLeaderNum];\n        var baseStatsItem=[\n            new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.Level+\":\"+SelectLeader.level)\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.EXP+\":\"+SelectLeader.EXP+\"\/\"+SelectLeader.getLevelExp())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.HP+\":\"+SelectLeader.HP+\"\/\"+SelectLeader.getMaxHP())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.MP+\":\"+SelectLeader.MP+\"\/\"+SelectLeader.getMaxMP())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.STR+\":\"+SelectLeader.getSTR())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.VIT+\":\"+SelectLeader.getVIT())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.DEX+\":\"+SelectLeader.getDEX())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.INT+\":\"+SelectLeader.getINT())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.ATK+\":\"+SelectLeader.getATK())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.DEF+\":\"+SelectLeader.getDEF())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.MATK+\":\"+SelectLeader.getMATK())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.MDEF+\":\"+SelectLeader.getMDEF())\n            ,new JControls.Label({x:2,y:2+bh*i++},ResourceData.AttributesName.SPD+\":\"+SelectLeader.getSpeed())\n        ];\n        for(var i=0;i&lt;baseStatsItem.length;i++)baseStatsItem[i].setFontType(\"Bold\")\n        this.addControlInLast(baseStatsItem);\n    };\n    GMain.DataPanel.addControlInLast([GameRoleHeadPanel,LeadersPanel,BaseStatsPanel,EquipmentPanel,GoodsPanel,GoodsStatsPanel,ButtonPanel]);\n};\n\u9664\u4e86\u4e0a\u9762\u7684\u8fd9\u4e9b\u754c\u9762\u5916\uff0c\u8fd8\u6709\u5b58\u6863\u754c\u9762\uff0c\u5546\u5e97\u754c\u9762\u7b49\u3002\n\u81f3\u6b64\uff0c\u5b66\u4e60HTML5\u5f00\u53d1RPG\u6e38\u620f\u5c31\u7ed3\u675f\u4e86\uff0c\u8fd9\u4e9b\u535a\u6587\u53ea\u662f\u8ba9\u5927\u5bb6\u6709\u4e2a\u5927\u6982\u4e86\u89e3\uff0c\u5177\u4f53\u8bf7\u770b\u6e90\u7801\u3002","categories":"\u7b2c\u4e94\u6b65","tags":["HTML5"]}]