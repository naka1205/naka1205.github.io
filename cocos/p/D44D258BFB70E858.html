<!DOCTYPE HTML>
<html lang=""> 
<head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title> A*寻路 · Cocos教程</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="这一篇介绍A*寻路算法。在RPG、SLG、模拟经营类游戏，有需要给角色寻路的需求，一般寻路我们采用A*寻路算法，A*寻路算法是一种广度优先启发性算法。">
    <meta name="keywords" content="CocosCreator 教程">
    <meta name="generator" content="PKBook">
    <link rel="stylesheet" href="https://naka1205.github.io/cocos/assets/css/style.css">
    <link rel="stylesheet" href="https://naka1205.github.io/cocos/assets/css/search.css">
    <link rel="stylesheet" href="https://naka1205.github.io/cocos/assets/css/ebook.css">
    <link rel="stylesheet" href="https://naka1205.github.io/cocos/assets/css/website.css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/github.min.css" rel="stylesheet">
    <meta name="HandheldFriendly" content="true" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://naka1205.github.io/cocos/assets/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="https://naka1205.github.io/cocos/assets/images/favicon.ico" type="image/x-icon">
</head>
<body>
<div class="book">
    <div class="book-summary">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="输入关键词搜索" />
        </div>
        <nav role="navigation">
    <ul class="summary">
        <li><a href="https://naka1205.github.io/cocos/index.html" target="blank" class="header">序言</a></li>
        <li class="divider"></li>
                <li class="header">教程</li>
                        <li class="chapter " data-level="1.1" data-path="https://naka1205.github.io/cocos/p/60DA9CE88BF3343E.html"><a href="https://naka1205.github.io/cocos/p/60DA9CE88BF3343E.html">初识creator</a></li>
                        <li class="chapter " data-level="1.2" data-path="https://naka1205.github.io/cocos/p/30A5A7449E53FF36.html"><a href="https://naka1205.github.io/cocos/p/30A5A7449E53FF36.html">资源管理</a></li>
                        <li class="chapter " data-level="1.3" data-path="https://naka1205.github.io/cocos/p/11A6F2117472174E.html"><a href="https://naka1205.github.io/cocos/p/11A6F2117472174E.html">弹窗管理</a></li>
                        <li class="chapter " data-level="1.4" data-path="https://naka1205.github.io/cocos/p/BFFA75863D9BB58A.html"><a href="https://naka1205.github.io/cocos/p/BFFA75863D9BB58A.html">网络通信</a></li>
                        <li class="chapter " data-level="1.5" data-path="https://naka1205.github.io/cocos/p/37322E7BA0648835.html"><a href="https://naka1205.github.io/cocos/p/37322E7BA0648835.html">日志系统</a></li>
                        <li class="chapter " data-level="1.6" data-path="https://naka1205.github.io/cocos/p/748D14A6DC9142BB.html"><a href="https://naka1205.github.io/cocos/p/748D14A6DC9142BB.html">消息分发</a></li>
                        <li class="chapter " data-level="1.7" data-path="https://naka1205.github.io/cocos/p/DE657CA8EE77BE83.html"><a href="https://naka1205.github.io/cocos/p/DE657CA8EE77BE83.html">MVC架构</a></li>
                        <li class="chapter " data-level="1.8" data-path="https://naka1205.github.io/cocos/p/E593CAA756CFDE55.html"><a href="https://naka1205.github.io/cocos/p/E593CAA756CFDE55.html">代码结构</a></li>
                        <li class="chapter " data-level="1.9" data-path="https://naka1205.github.io/cocos/p/22AC2C263EC626A0.html"><a href="https://naka1205.github.io/cocos/p/22AC2C263EC626A0.html">瓦片地图</a></li>
                        <li class="chapter  active " data-level="1.10" data-path="https://naka1205.github.io/cocos/p/D44D258BFB70E858.html"><a href="https://naka1205.github.io/cocos/p/D44D258BFB70E858.html"> A*寻路</a></li>
                        <li class="chapter " data-level="1.11" data-path="https://naka1205.github.io/cocos/p/FB97038B212BD9C7.html"><a href="https://naka1205.github.io/cocos/p/FB97038B212BD9C7.html">有限状态机和行为树</a></li>
                    <li class="divider"></li>
                <li><a href="https://github.com/naka1205/pkbook" target="blank" class="gitbook-link">Published with PKBook</a></li>
    </ul>
</nav>
    </div>
    
    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
                <h1><i class="fa fa-circle-o-notch fa-spin"></i><a href="https://naka1205.github.io/cocos/p/D44D258BFB70E858.html"> A*寻路</a></h1>
            </div>
            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                    <div id="book-search-results">
                        <div class="search-noresults">
                            <section class="normal markdown-section">
                                <h2 id="A%2A%E5%AF%BB%E8%B7%AF" name="A%2A%E5%AF%BB%E8%B7%AF">A*寻路</h2>
<p>这一篇介绍A<em>寻路算法。在RPG、SLG、模拟经营类游戏，有需要给角色寻路的需求，一般寻路我们采用A</em>寻路算法，A*寻路算法是一种广度优先启发性算法。</p>
<p>先说说什么叫广度优先。搜索分为广度优先和深度优先，主要体现在对节点的展开上。深度优先一直往一个方向查找，如果没办法查找下去，在当前节点改变方向继续查找，直到找到终点。如果无法继续查找，就回退上一格重复操作。广度优先把当前节点放入待探索列表，循环从待探索列表里取出节点进行展开，直到找到终点。如果待探索列表为空，说明没有路可走。</p>
<p>启发性指算法在待探索列表里取节点时，先预测哪个节点的路径可能会最短，优先对该节点展开，A*算法基于对未探索路径的假设和预测，假设所有路都能通行前提下总路径最短值。在图论里，介绍过有一种寻找最短路径的算法叫Dijkstra算法，该算法基于贪心算法，即当前选择探索的节点，为尚未确定最短路径，当前源点能到达且路径最短的节点。Dijkstra算法基于已知距离源点最短。为了便于理解这两种算法的区别，先介绍下Dijkstra算法。</p>
<p>Dijkstra算法知道所有可能的节点，如下图，知道总共有ABCDE5个节点，寻找从A点出发到各点的最短路径。</p>
<p><img src="http://files.kmei.org/1552962587107.jpg" alt="寻路算法" title="寻路算法" /></p>
<ol>
<li>
<p>算法有两个数组，一个维护当前已知最终最短路径的节点数组S，找到为路径字符串和长度，否则为空字符串，初始只有起点A点标记为“A”。另一个数组V，维护各个节点“目前所知”从源点出发最短的路径长度（不一定是最终的最短路径，初始B标记为6，D为7），已经找到最终最短路径的标记为0（初始时起点A标记为0），目前无法到达的标记为无穷大。</p>
</li>
<li>
<p>循环从数组V中获取标记非0，非无穷大，路径最短的节点，在数组S中标记为1，修正V中其他节点的最短路径。直到数组S中所有节点都标记为1</p>
</li>
</ol>
<p>如上图，寻路的过程为：</p>
<p>V：（A，0），（B：6），（C：无穷大），（D：7），（E：无穷大），S：（A，“A”），（B：“”），（C：“”），（D：“”），（E：“”）</p>
<p>V：（A，0），（B：0），（C：11），（D：7），（E：18），S：（A，“A”），（B：“AB”），（C：“”），（D：“”），（E：“”）</p>
<p>V：（A，0），（B：0），（C：10），（D：0），（E：18），S：（A，“A”），（B：“AB”），（C：“”），（D：“AD”），（E：“”）</p>
<p>V：（A，0），（B：0），（C：0），（D：0），（E：18），S：（A，“A”），（B：“AB”），（C：“ADC”），（D：“AD”），（E：“”）</p>
<p>V：（A，0），（B：0），（C：0），（D：0），（E：0），S：（A，“A”），（B：“AB”），（C：“ADC”），（D：“AD”），（E：“ABE”）</p>
<p>这里，Dijkstra算法基于知道所有可能的节点，目标节点也有多个，每个节点可以直接到达的节点数没有限制。</p>
<p>游戏里的寻路是目标节点只有一个，中间节点可能有多个，每个节点可以直接到达的节点数最多4个（如果是8个方向是8）</p>
<p><img src="http://files.kmei.org/1552962686977.jpg" alt="游戏寻路" title="游戏寻路" /></p>
<p>将数组改成列表会更灵活，现在将数组V改成open队列，将数组S改成close队列。如上图，要找到A到E的路径，仍然按照Dijkstra算法思路，</p>
<ol>
<li>
<p>先将A放入open队列，路径长度为0</p>
</li>
<li>
<p>循环从open列表里拿出路径长度最短的节点，将其放入close队列并记录上一节点，对其4个方向进行展开，如果已经在open、close队列，修正其最短路径长度；如果不可走，忽略；否则放入open队列并计算其路径长度。</p>
</li>
<li>
<p>如果找到E点，通过E点的上一节点，上一节点的上一节点...一直反推到A点，形成反推路径，从而找到A到E的最短路径。</p>
</li>
<li>
<p>如果还没找到E点，open 队列为空，A到E路不通。</p>
</li>
</ol>
<p>如上图，从Dijkstra算法修改过来的寻路算法，按照红色、绿色、蓝色、黄色节点，逐步展开寻找才找到A到E的最短路径，很多没用的分支，效率低。</p>
<p>A<em>的优化思路主要在挑选节点展开时，假设找到一个中间节点B后，中间节点B到E的路都是可走的。这时候最短路径长度是计算经过B点A到E的最短路径（AB）+（BE）。在RPG游戏中，最简单的情况是，A到B的路径长度等于从A走到B经过的格子数，B到E的路径长度等于假设B到E的路都相通情况下B走到E经过的格子数。A</em>算法每次展开节点时都尽可能的往可能最短的路径去展开寻找，减少没必要的分支，提高寻路效率。</p>
<p>下面是A*寻路算法过程</p>
<ol>
<li>
<p>先将A放入open队列，记录其上一节点为空</p>
</li>
<li>
<p>循环从open列表里拿出节点N，N为经过该点N，A到E路径预测长度最短的节点，将其放入close队列；对其4个方向进行展开，如果已经在open、close队列，修正其上一节点；如果不可走，忽略；否则放入open队列并记录其上一节点为N。</p>
</li>
<li>
<p>如果找到E点，通过E点的上一节点，上一节点的上一节点...一直反推到A点，形成反推路径，从而找到A到E的最短路径。</p>
</li>
<li>
<p>如果还没找到E点，open 队列为空，A到E路不通。</p>
</li>
</ol>
<p>A*寻路算法先说到这里，下一篇我们将介绍有限状态机和行为树。</p>                            </section>
                        </div>
                        <div class="search-results">
                            <div class="has-results">
                                <h1 class="search-results-title">
                                    关于"<span class='search-query'></span>"的搜索结果共<span class='search-results-count'></span>条
                                </h1>
                                <ul class="search-results-list"></ul>
                            </div>
                            <div class="no-results">
                                <h1 class="search-results-title">没有"<span class='search-query'></span>"相关内容</h1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <a href="https://naka1205.github.io/cocos/p/22AC2C263EC626A0.html" class="navigation navigation-prev " aria-label="瓦片地图">
            <i class="fa fa-angle-left"></i>
        </a>
                <a href="https://naka1205.github.io/cocos/p/FB97038B212BD9C7.html" class="navigation navigation-next " aria-label="有限状态机和行为树">
            <i class="fa fa-angle-right"></i>
        </a>
               
    </div>
<script>
var gitbook = gitbook || [];
gitbook.push(function() {
    gitbook.page.hasChanged({
        "page": {
            "title":  " A*寻路",
            "next": {
                "title": "有限状态机和行为树"
            },
            "previous": {
                "title": "瓦片地图"
            }
        },
        "config": {
            "gitbook": "*",
            "theme": "default",
            "variables": {},
            "plugins": ["-lunr", "-search", "-highlight","search-pro"],
            "pluginsConfig": {
                "search-pro": {},
                "highlight": {},
                "sharing": {},
                "fontsettings": {},
                "theme-default": {}
            },
            "structure": {},
            "pdf": {},
            "styles": {}
        },
        "file": {},
        "gitbook": {},
        "basePath": "https://naka1205.github.io/cocos",
        "book": {}
    });
});
</script>
</div>
<script src="https://naka1205.github.io/cocos/assets/js/gitbook.js"></script>
<script src="https://naka1205.github.io/cocos/assets/js/theme.js"></script>
<script src="https://naka1205.github.io/cocos/assets/js/jquery.mark.min.js"></script>
<script src="https://naka1205.github.io/cocos/assets/js/search.js"></script>
<script src="https://naka1205.github.io/cocos/assets/js/buttons.js"></script>
<script src="https://naka1205.github.io/cocos/assets/js/fontsettings.js"></script>
<script src="https://naka1205.github.io/cocos/assets/js/plugin.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
</body>
</html>