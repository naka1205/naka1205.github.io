<!DOCTYPE HTML>
<html lang=""> 
<head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>指针，可怕的指针 · 笨办法学C</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="指针是C中的一个著名的谜之特性，我会试着通过教授你一些用于处理它们的词汇，使之去神秘化。指针实际上并不复杂，只不过它们经常以一些奇怪的方式被滥用，这样使它们变得难以使用。如果你避免这些愚蠢的方法来使用指针，你会发现它们难以置信的简单。">
    <meta name="keywords" content="笨办法学C">
    <meta name="generator" content="PKBook">
    <link rel="stylesheet" href="https://naka1205.github.io/lcthw/assets/css/style.css">
    <link rel="stylesheet" href="https://naka1205.github.io/lcthw/assets/css/search.css">
    <link rel="stylesheet" href="https://naka1205.github.io/lcthw/assets/css/ebook.css">
    <link rel="stylesheet" href="https://naka1205.github.io/lcthw/assets/css/website.css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/github.min.css" rel="stylesheet">
    <meta name="HandheldFriendly" content="true" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://naka1205.github.io/lcthw/assets/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="https://naka1205.github.io/lcthw/assets/images/favicon.ico" type="image/x-icon">
</head>
<body>
<div class="book">
    <div class="book-summary">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="输入关键词搜索" />
        </div>
        <nav role="navigation">
    <ul class="summary">
        <li><a href="https://naka1205.github.io/lcthw/index.html" target="blank" class="header">导言：C的笛卡尔之梦</a></li>
        <li class="divider"></li>
                <li class="header">练习</li>
                        <li class="chapter " data-level="1.1" data-path="https://naka1205.github.io/lcthw/p/C3D207FADFAF5841.html"><a href="https://naka1205.github.io/lcthw/p/C3D207FADFAF5841.html">准备</a></li>
                        <li class="chapter " data-level="1.2" data-path="https://naka1205.github.io/lcthw/p/6C82D57E03DDE1F0.html"><a href="https://naka1205.github.io/lcthw/p/6C82D57E03DDE1F0.html">启用编译器</a></li>
                        <li class="chapter " data-level="1.3" data-path="https://naka1205.github.io/lcthw/p/44DB81B8DEDE247B.html"><a href="https://naka1205.github.io/lcthw/p/44DB81B8DEDE247B.html">用Make来代替Python</a></li>
                        <li class="chapter " data-level="1.4" data-path="https://naka1205.github.io/lcthw/p/D3BE6C8A075EF92E.html"><a href="https://naka1205.github.io/lcthw/p/D3BE6C8A075EF92E.html">格式化输出</a></li>
                        <li class="chapter " data-level="1.5" data-path="https://naka1205.github.io/lcthw/p/B9CDA195B24A4F6A.html"><a href="https://naka1205.github.io/lcthw/p/B9CDA195B24A4F6A.html">Valgrind 介绍</a></li>
                        <li class="chapter " data-level="1.6" data-path="https://naka1205.github.io/lcthw/p/624C7D3C62504470.html"><a href="https://naka1205.github.io/lcthw/p/624C7D3C62504470.html">一个C程序的结构</a></li>
                        <li class="chapter " data-level="1.7" data-path="https://naka1205.github.io/lcthw/p/33CC823F6781FDB9.html"><a href="https://naka1205.github.io/lcthw/p/33CC823F6781FDB9.html">变量类型</a></li>
                        <li class="chapter " data-level="1.8" data-path="https://naka1205.github.io/lcthw/p/171C2758259C8DE1.html"><a href="https://naka1205.github.io/lcthw/p/171C2758259C8DE1.html">更多变量和一些算术</a></li>
                        <li class="chapter " data-level="1.9" data-path="https://naka1205.github.io/lcthw/p/C2C3F49A54034E72.html"><a href="https://naka1205.github.io/lcthw/p/C2C3F49A54034E72.html">大小和数组</a></li>
                        <li class="chapter " data-level="1.10" data-path="https://naka1205.github.io/lcthw/p/3046A11FC869E5C2.html"><a href="https://naka1205.github.io/lcthw/p/3046A11FC869E5C2.html">数组和字符串</a></li>
                        <li class="chapter " data-level="1.11" data-path="https://naka1205.github.io/lcthw/p/3018A6B457AE4FF5.html"><a href="https://naka1205.github.io/lcthw/p/3018A6B457AE4FF5.html">字符串数组和循环</a></li>
                        <li class="chapter " data-level="1.12" data-path="https://naka1205.github.io/lcthw/p/F552B2B9C8E36656.html"><a href="https://naka1205.github.io/lcthw/p/F552B2B9C8E36656.html">While循环和布尔表达式</a></li>
                        <li class="chapter " data-level="1.13" data-path="https://naka1205.github.io/lcthw/p/71D0E364C2783A96.html"><a href="https://naka1205.github.io/lcthw/p/71D0E364C2783A96.html">If，Else If，Else</a></li>
                        <li class="chapter " data-level="1.14" data-path="https://naka1205.github.io/lcthw/p/0E9AB6AD5C029EF6.html"><a href="https://naka1205.github.io/lcthw/p/0E9AB6AD5C029EF6.html">Switch语句</a></li>
                        <li class="chapter " data-level="1.15" data-path="https://naka1205.github.io/lcthw/p/5D2945A8677CE165.html"><a href="https://naka1205.github.io/lcthw/p/5D2945A8677CE165.html">编写并使用函数</a></li>
                        <li class="chapter " data-level="1.16" data-path="https://naka1205.github.io/lcthw/p/8B5745CD2156FCC3.html"><a href="https://naka1205.github.io/lcthw/p/8B5745CD2156FCC3.html">指针，可怕的指针</a></li>
                        <li class="chapter " data-level="1.17" data-path="https://naka1205.github.io/lcthw/p/CDCC108031940336.html"><a href="https://naka1205.github.io/lcthw/p/CDCC108031940336.html">结构体和指向它们的指针</a></li>
                        <li class="chapter " data-level="1.18" data-path="https://naka1205.github.io/lcthw/p/178F8DDE733AD0DD.html"><a href="https://naka1205.github.io/lcthw/p/178F8DDE733AD0DD.html">堆和栈的内存分配</a></li>
                        <li class="chapter " data-level="1.19" data-path="https://naka1205.github.io/lcthw/p/DC3B5E7AC8CF3946.html"><a href="https://naka1205.github.io/lcthw/p/DC3B5E7AC8CF3946.html">函数指针</a></li>
                        <li class="chapter " data-level="1.20" data-path="https://naka1205.github.io/lcthw/p/746ADCFC76734882.html"><a href="https://naka1205.github.io/lcthw/p/746ADCFC76734882.html">一个简单的对象系统</a></li>
                        <li class="chapter " data-level="1.21" data-path="https://naka1205.github.io/lcthw/p/8BBFC8E0CA1C348B.html"><a href="https://naka1205.github.io/lcthw/p/8BBFC8E0CA1C348B.html">Zed的强大的调试宏</a></li>
                        <li class="chapter " data-level="1.22" data-path="https://naka1205.github.io/lcthw/p/B67D461964D39489.html"><a href="https://naka1205.github.io/lcthw/p/B67D461964D39489.html">高级数据类型和控制结构</a></li>
                        <li class="chapter " data-level="1.23" data-path="https://naka1205.github.io/lcthw/p/6822F5C25F64C05F.html"><a href="https://naka1205.github.io/lcthw/p/6822F5C25F64C05F.html">栈、作用域和全局</a></li>
                        <li class="chapter " data-level="1.24" data-path="https://naka1205.github.io/lcthw/p/F6AD606057D5DA1A.html"><a href="https://naka1205.github.io/lcthw/p/F6AD606057D5DA1A.html">认识达夫设备</a></li>
                        <li class="chapter " data-level="1.25" data-path="https://naka1205.github.io/lcthw/p/2F13B44DB3CFDC2E.html"><a href="https://naka1205.github.io/lcthw/p/2F13B44DB3CFDC2E.html">输入输出和文件</a></li>
                        <li class="chapter " data-level="1.26" data-path="https://naka1205.github.io/lcthw/p/2852FA26A8BCFAD2.html"><a href="https://naka1205.github.io/lcthw/p/2852FA26A8BCFAD2.html">变参函数</a></li>
                        <li class="chapter " data-level="1.27" data-path="https://naka1205.github.io/lcthw/p/41ABE0D9F5D3164C.html"><a href="https://naka1205.github.io/lcthw/p/41ABE0D9F5D3164C.html">编写第一个真正的程序</a></li>
                        <li class="chapter " data-level="1.28" data-path="https://naka1205.github.io/lcthw/p/FFD032B7FC697307.html"><a href="https://naka1205.github.io/lcthw/p/FFD032B7FC697307.html">创造性和防御性编程</a></li>
                        <li class="chapter " data-level="1.29" data-path="https://naka1205.github.io/lcthw/p/5C8A5BE0B219BE30.html"><a href="https://naka1205.github.io/lcthw/p/5C8A5BE0B219BE30.html">Makefile 进阶</a></li>
                        <li class="chapter " data-level="1.30" data-path="https://naka1205.github.io/lcthw/p/09D69E06B935E885.html"><a href="https://naka1205.github.io/lcthw/p/09D69E06B935E885.html">库和链接</a></li>
                        <li class="chapter " data-level="1.31" data-path="https://naka1205.github.io/lcthw/p/866A23BE27D0D7E6.html"><a href="https://naka1205.github.io/lcthw/p/866A23BE27D0D7E6.html">自动化测试</a></li>
                        <li class="chapter " data-level="1.32" data-path="https://naka1205.github.io/lcthw/p/B6E48A0ED7072528.html"><a href="https://naka1205.github.io/lcthw/p/B6E48A0ED7072528.html">代码调试</a></li>
                        <li class="chapter " data-level="1.33" data-path="https://naka1205.github.io/lcthw/p/364477FB0CED1A03.html"><a href="https://naka1205.github.io/lcthw/p/364477FB0CED1A03.html">双向链表</a></li>
                        <li class="chapter " data-level="1.34" data-path="https://naka1205.github.io/lcthw/p/219AB7A902A81B94.html"><a href="https://naka1205.github.io/lcthw/p/219AB7A902A81B94.html">链表算法</a></li>
                        <li class="chapter " data-level="1.35" data-path="https://naka1205.github.io/lcthw/p/4375976486E9101E.html"><a href="https://naka1205.github.io/lcthw/p/4375976486E9101E.html">动态数组</a></li>
                        <li class="chapter " data-level="1.36" data-path="https://naka1205.github.io/lcthw/p/F674E4CC423F4082.html"><a href="https://naka1205.github.io/lcthw/p/F674E4CC423F4082.html">排序和搜索</a></li>
                        <li class="chapter " data-level="1.37" data-path="https://naka1205.github.io/lcthw/p/95C8D9CEC85F55BD.html"><a href="https://naka1205.github.io/lcthw/p/95C8D9CEC85F55BD.html">更安全的字符串</a></li>
                        <li class="chapter " data-level="1.38" data-path="https://naka1205.github.io/lcthw/p/19B22BBE112EDD42.html"><a href="https://naka1205.github.io/lcthw/p/19B22BBE112EDD42.html">哈希表</a></li>
                        <li class="chapter " data-level="1.39" data-path="https://naka1205.github.io/lcthw/p/8ACDB75ECC6C4448.html"><a href="https://naka1205.github.io/lcthw/p/8ACDB75ECC6C4448.html">哈希算法</a></li>
                        <li class="chapter " data-level="1.40" data-path="https://naka1205.github.io/lcthw/p/1D54A74DB0C212CF.html"><a href="https://naka1205.github.io/lcthw/p/1D54A74DB0C212CF.html">字符串算法</a></li>
                        <li class="chapter " data-level="1.41" data-path="https://naka1205.github.io/lcthw/p/64206F3FDC812F26.html"><a href="https://naka1205.github.io/lcthw/p/64206F3FDC812F26.html">二叉搜索树</a></li>
                        <li class="chapter " data-level="1.42" data-path="https://naka1205.github.io/lcthw/p/35162CDAACDA8825.html"><a href="https://naka1205.github.io/lcthw/p/35162CDAACDA8825.html">将 Cachegrind 和 Callgrind 用于性能调优</a></li>
                        <li class="chapter " data-level="1.43" data-path="https://naka1205.github.io/lcthw/p/288E5C87D0D80787.html"><a href="https://naka1205.github.io/lcthw/p/288E5C87D0D80787.html">栈和队列</a></li>
                        <li class="chapter " data-level="1.44" data-path="https://naka1205.github.io/lcthw/p/EFA4890803FAB6F6.html"><a href="https://naka1205.github.io/lcthw/p/EFA4890803FAB6F6.html">一个简单的统计引擎</a></li>
                        <li class="chapter " data-level="1.45" data-path="https://naka1205.github.io/lcthw/p/E0AFFDAFB6FE468C.html"><a href="https://naka1205.github.io/lcthw/p/E0AFFDAFB6FE468C.html">环形缓冲区</a></li>
                        <li class="chapter " data-level="1.46" data-path="https://naka1205.github.io/lcthw/p/EEC00C835A3D8361.html"><a href="https://naka1205.github.io/lcthw/p/EEC00C835A3D8361.html">一个简单的TCP/IP客户端</a></li>
                        <li class="chapter " data-level="1.47" data-path="https://naka1205.github.io/lcthw/p/51762D35312252D6.html"><a href="https://naka1205.github.io/lcthw/p/51762D35312252D6.html">三叉搜索树</a></li>
                        <li class="chapter " data-level="1.48" data-path="https://naka1205.github.io/lcthw/p/A0F3E9CEEB1897B5.html"><a href="https://naka1205.github.io/lcthw/p/A0F3E9CEEB1897B5.html">一个快速的URL路由</a></li>
                    <li class="divider"></li>
                <li class="header">后记</li>
                        <li class="chapter " data-level="2.1" data-path="https://naka1205.github.io/lcthw/p/ACB13F6E3D683928.html"><a href="https://naka1205.github.io/lcthw/p/ACB13F6E3D683928.html">解构 K&amp;R C&rdquo; 已死</a></li>
                    <li class="divider"></li>
                <li><a href="https://github.com/naka1205/pkbook" target="blank" class="gitbook-link">Published with PKBook</a></li>
    </ul>
</nav>
    </div>
    
    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
                <h1><i class="fa fa-circle-o-notch fa-spin"></i><a href="https://naka1205.github.io/lcthw/p/8B5745CD2156FCC3.html">指针，可怕的指针</a></h1>
            </div>
            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                    <div id="book-search-results">
                        <div class="search-noresults">
                            <section class="normal markdown-section">
                                <h1 id="%E6%8C%87%E9%92%88%EF%BC%8C%E5%8F%AF%E6%80%95%E7%9A%84%E6%8C%87%E9%92%88" name="%E6%8C%87%E9%92%88%EF%BC%8C%E5%8F%AF%E6%80%95%E7%9A%84%E6%8C%87%E9%92%88">指针，可怕的指针</h1>
<p>指针是C中的一个著名的谜之特性，我会试着通过教授你一些用于处理它们的词汇，使之去神秘化。指针实际上并不复杂，只不过它们经常以一些奇怪的方式被滥用，这样使它们变得难以使用。如果你避免这些愚蠢的方法来使用指针，你会发现它们难以置信的简单。</p>
<p>要想以一种我们可以谈论的方式来讲解指针，我会编写一个无意义的程序，它以三种方式打印了一组人的年龄：</p>
<pre><code class="c">#include &lt;stdio.h&gt;

int main(int argc, char *argv[])
{
    // create two arrays we care about
    int ages[] = {23, 43, 12, 89, 2};
    char *names[] = {
        "Alan", "Frank",
        "Mary", "John", "Lisa"
    };

    // safely get the size of ages
    int count = sizeof(ages) / sizeof(int);
    int i = 0;

    // first way using indexing
    for(i = 0; i &lt; count; i++) {
        printf("%s has %d years alive.\n",
                names[i], ages[i]);
    }

    printf("---\n");

    // setup the pointers to the start of the arrays
    int *cur_age = ages;
    char **cur_name = names;

    // second way using pointers
    for(i = 0; i &lt; count; i++) {
        printf("%s is %d years old.\n",
                *(cur_name+i), *(cur_age+i));
    }

    printf("---\n");

    // third way, pointers are just arrays
    for(i = 0; i &lt; count; i++) {
        printf("%s is %d years old again.\n",
                cur_name[i], cur_age[i]);
    }

    printf("---\n");

    // fourth way with pointers in a stupid complex way
    for(cur_name = names, cur_age = ages;
            (cur_age - ages) &lt; count;
            cur_name++, cur_age++)
    {
        printf("%s lived %d years so far.\n",
                *cur_name, *cur_age);
    }

    return 0;
}</code></pre>
<p>在解释指针如何工作之前，让我们逐行分解这个程序，这样你可以对发生了什么有所了解。当你浏览这个详细说明时，试着自己在纸上回答问题，之后看看你猜测的结果符合我对指针的描述。</p>
<p>ex15.c:6-10</p>
<p>创建了两个数组，<code>ages</code>储存了一些<code>int</code>数据，<code>names</code>储存了一个字符串数组。</p>
<p>ex15.c:12-13</p>
<p>为之后的<code>for</code>循环创建了一些变量。</p>
<p>ex15.c:16-19</p>
<p>你知道这只是遍历了两个数组，并且打印出每个人的年龄。它使用了<code>i</code>来对数组索引。</p>
<p>ex15.c:24</p>
<p>创建了一个指向<code>ages</code>的指针。注意<code>int *</code>创建“指向整数的指针”的指针类型的用法。它很像<code>char *</code>，意义是“指向字符的指针”，而且字符串是字符的数组。是不是很相似呢？</p>
<p>ex15.c:25</p>
<p>创建了指向<code>names</code>的指针。<code>char *</code>已经是“指向<code>char</code>的指针”了，所以它只是个字符串。你需要两个层级，因为<code>names</code>是二维的，也就是说你需要<code>char **</code>作为“指向‘指向字符的指针’的指针”。把它学会，并且自己解释它。</p>
<p>ex15.c:28-31</p>
<p>遍历<code>ages</code>和<code>names</code>，但是使用“指针加偏移<code>i</code>”。<code>*(cur_name+i)</code>和<code>name[i]</code>是一样的，你应该把它读作“‘<code>cur_name</code>指针加<code>i</code>’的值”。</p>
<p>ex15.c:35-39</p>
<p>这里展示了访问数组元素的语法和指针是相同的。</p>
<p>ex15.c:44-50</p>
<p>另一个十分愚蠢的循环和其它两个循环做着相同的事情，但是它用了各种指针算术运算来代替：</p>
<p>ex15.c:44</p>
<p>通过将<code>cur_name</code>和<code>cur_age</code>置为<code>names</code>和<code>age</code>数组的起始位置来初始化<code>for</code>循环。</p>
<p>ex15.c:45</p>
<p><code>for</code>循环的测试部分比较<code>cur_age</code>指针和<code>ages</code>起始位置的距离，为什么可以这样写呢？</p>
<p>ex15.c:46</p>
<p><code>for</code>循环的增加部分增加了<code>cur_name</code>和<code>cur_age</code>的值，这样它们可以只想<code>names</code>和<code>ages</code>的下一个元素。</p>
<p>ex15.c:48-49</p>
<p><code>cur_name</code>和<code>cur_age</code>的值现在指向了相应数组中的一个元素，我们我可以通过<code>*cur_name</code>和<code>*cur_age</code>来打印它们，这里的意思是“<code>cur_name</code>和<code>cur_age</code>指向的值”。</p>
<p>这个看似简单的程序却包含了大量的信息，其目的是在我向你讲解之前尝试让你自己弄清楚指针。直到你写下你认为指针做了什么之前，不要往下阅读。</p>
<h2 id="%E4%BD%A0%E4%BC%9A%E7%9C%8B%E5%88%B0%E4%BB%80%E4%B9%88" name="%E4%BD%A0%E4%BC%9A%E7%9C%8B%E5%88%B0%E4%BB%80%E4%B9%88">你会看到什么</h2>
<p>在你运行这个程序之后，尝试根据打印出的每一行追溯到代码中产生它们的那一行。在必要情况下，修改<code>printf</code>调用来确认你得到了正确的行号：</p>
<pre><code class="sh">$ make ex15
cc -Wall -g    ex15.c   -o ex15
$ ./ex15
Alan has 23 years alive.
Frank has 43 years alive.
Mary has 12 years alive.
John has 89 years alive.
Lisa has 2 years alive.
---
Alan is 23 years old.
Frank is 43 years old.
Mary is 12 years old.
John is 89 years old.
Lisa is 2 years old.
---
Alan is 23 years old again.
Frank is 43 years old again.
Mary is 12 years old again.
John is 89 years old again.
Lisa is 2 years old again.
---
Alan lived 23 years so far.
Frank lived 43 years so far.
Mary lived 12 years so far.
John lived 89 years so far.
Lisa lived 2 years so far.
$</code></pre>
<h2 id="%E8%A7%A3%E9%87%8A%E6%8C%87%E9%92%88" name="%E8%A7%A3%E9%87%8A%E6%8C%87%E9%92%88">解释指针</h2>
<p>当你写下一些类似<code>ages[i]</code>的东西时，你实际上在用<code>i</code>中的数字来索引<code>ages</code>。如果<code>i</code>的值为0，那么就等同于写下<code>ages[0]</code>。我们把<code>i</code>叫做下标，因为它是<code>ages</code>中的一个位置。它也能称为地址，这是“我想要<code>ages</code>位于地址<code>i</code>处的整数”中的说法。</p>
<p>如果<code>i</code>是个下标，那么<code>ages</code>又是什么？对C来说<code>ages</code>是在计算机中那些整数的起始位置。当然它也是个地址，C编译器会把任何你键入<code>ages</code>的地方替换为数组中第一个整数的地址。另一个理解它的办法就是把<code>ages</code>当作“数组内部第一个整数的地址”，但是它是整个计算机中的地址，而不是像<code>i</code>一样的<code>ages</code>中的地址。<code>ages</code>数组的名字在计算机中实际上是个地址。</p>
<p>这就产生了一种特定的实现：C把你的计算机看成一个庞大的字节数组。显然这样不会有什么用处，于是C就在它的基础上构建出类型和大小的概念。你已经在前面的练习中看到了它是如何工作的，但现在你可以开始了解C对你的数组做了下面一些事情：</p>
<ul>
<li>在你的计算机中开辟一块内存。</li>
<li>将<code>ages</code>这个名字“指向”它的起始位置。</li>
<li>通过选取<code>ages</code>作为基址，并且获取位置为<code>i</code>的元素，来对内存块进行索引。</li>
<li>将<code>ages+i</code>处的元素转换成大小正确的有效的<code>int</code>，这样就返回了你想要的结果：下标<code>i</code>处的<code>int</code>。</li>
</ul>
<p>如果你可以选取<code>ages</code>作为基址，之后加上比如<code>i</code>的另一个地址，你是否就能随时构造出指向这一地址的指针呢？是的，这种东西就叫做指针。这也是<code>cur_age</code>和<code>cur_name</code>所做的事情，它们是指向计算机中这一位置的变量，<code>ages</code>和<code>names</code>就处于这一位置。之后，示例程序移动它们，或者做了一些算数运算，来从内存中获取值。在其中一个实例中，只是简单地将<code>cur_age</code>加上<code>i</code>，这样等同于<code>array[i]</code>。在最后一个<code>for</code>循环中，这两个指针在没有<code>i</code>辅助的情况下自己移动，被当做数组基址和整数偏移合并到一起的组合。</p>
<p>指针仅仅是指向计算机中的某个地址，并带有类型限定符，所以你可以通过它得到正确大小的数据。它类似于将<code>ages</code>和<code>i</code>组合为一个数据类型的东西。C了解指针指向什么地方，所指向的数据类型，这些类型的大小，以及如何为你获取数据。你可以像<code>i</code>一样增加它们，减少它们，对他们做加减运算。然而它们也像是<code>ages</code>，你可以通过它获取值，放入新的值，或执行全部的数组操作。</p>
<p>指针的用途就是让你手动对内存块进行索引，一些情况下数组并不能做到。绝大多数情况中，你可能打算使用数组，但是一些处理原始内存块的情况，是指针的用武之地。指针向你提供了原始的、直接的内存块访问途径，让你能够处理它们。</p>
<p>在这一阶段需要掌握的最后一件事，就是你可以对数组和指针操作混用它们绝大多数的语法。你可以对一个指针使用数组的语法来访问指向的东西，也可以对数组的名字做指针的算数运算。</p>
<h2 id="%E5%AE%9E%E7%94%A8%E7%9A%84%E6%8C%87%E9%92%88%E7%94%A8%E6%B3%95" name="%E5%AE%9E%E7%94%A8%E7%9A%84%E6%8C%87%E9%92%88%E7%94%A8%E6%B3%95">实用的指针用法</h2>
<p>你可以用指针做下面四个最基本的操作：</p>
<ul>
<li>向OS申请一块内存，并且用指针处理它。这包括字符串，和一些你从来没见过的东西，比如结构体。</li>
<li>通过指针向函数传递大块的内存（比如很大的结构体），这样不必把全部数据都传递进去。</li>
<li>获取函数的地址用于动态调用。</li>
<li>对一块内存做复杂的搜索，比如，转换网络套接字中的字节，或者解析文件。</li>
</ul>
<p>对于你看到的其它所有情况，实际上应当使用数组。在早期，由于编译器不擅长优化数组，人们使用指针来加速它们的程序。然而，现在访问数组和指针的语法都会翻译成相同的机器码，并且表现一致。由此，你应该每次尽可能使用数组，并且按需将指针用作提升性能的手段。</p>
<h2 id="%E6%8C%87%E9%92%88%E8%AF%8D%E5%BA%93" name="%E6%8C%87%E9%92%88%E8%AF%8D%E5%BA%93">指针词库</h2>
<p>现在我打算向你提供一个词库，用于读写指针。当你遇到复杂的指针语句时，试着参考它并且逐字拆分语句（或者不要使用这个语句，因为有可能并不好）：</p>
<p><code>type *ptr</code></p>
<p><code>type</code>类型的指针，名为<code>ptr</code>。</p>
<p><code>*ptr</code></p>
<p><code>ptr</code>所指向位置的值。</p>
<p><code>*(ptr + i)</code></p>
<p>（<code>ptr</code>所指向位置加上<code>i</code>）的值。</p>
<blockquote>
<p>译者注：以字节为单位的话，应该是<code>ptr</code>所指向的位置再加上<code>sizeof(type) * i</code>。</p>
</blockquote>
<p><code>&amp;thing</code></p>
<p><code>thing</code>的地址。</p>
<p><code>type *ptr = &amp;thing</code></p>
<p>名为<code>ptr</code>，<code>type</code>类型的指针，值设置为<code>thing</code>的地址。</p>
<p><code>ptr++</code></p>
<p>自增<code>ptr</code>指向的位置。</p>
<p>我们将会使用这份简单的词库来拆解这本书中所有的指针用例。</p>
<h2 id="%E6%8C%87%E9%92%88%E5%B9%B6%E4%B8%8D%E6%98%AF%E6%95%B0%E7%BB%84" name="%E6%8C%87%E9%92%88%E5%B9%B6%E4%B8%8D%E6%98%AF%E6%95%B0%E7%BB%84">指针并不是数组</h2>
<p>无论怎么样，你都不应该把指针和数组混为一谈。它们并不是相同的东西，即使C让你以一些相同的方法来使用它们。例如，如果你访问上面代码中的<code>sizeof(cur_age)</code>，你会得到指针的大小，而不是它指向数组的大小。如果你想得到整个数组的大小，你应该使用数组的名称<code>age</code>，就像第12行那样。</p>
<blockquote>
<p>译者注，除了<code>sizeof</code>、<code>&amp;</code>操作和声明之外，数组名称都会被编译器推导为指向其首个元素的指针。对于这些情况，不要用“是”这个词，而是要用“推导”。</p>
</blockquote>
<h2 id="%E5%A6%82%E4%BD%95%E4%BD%BF%E5%AE%83%E5%B4%A9%E6%BA%83" name="%E5%A6%82%E4%BD%95%E4%BD%BF%E5%AE%83%E5%B4%A9%E6%BA%83">如何使它崩溃</h2>
<p>你可以通过将指针指向错误的位置来使程序崩溃：</p>
<ul>
<li>试着将<code>cur_age</code>指向<code>names</code>。可以需要C风格转换来强制执行，试着查阅相关资料把它弄明白。</li>
<li>在最后的<code>for</code>循环中，用一些古怪的方式使计算发生错误。</li>
<li>试着重写循环，让它们从数组的最后一个元素开始遍历到首个元素。这比看上去要困难。</li>
</ul>
<h2 id="%E9%99%84%E5%8A%A0%E9%A2%98" name="%E9%99%84%E5%8A%A0%E9%A2%98">附加题</h2>
<ul>
<li>使用访问指针的方式重写所有使用数组的地方。</li>
<li>使用访问数组的方式重写所有使用指针的地方。</li>
<li>在其它程序中使用指针来代替数组访问。</li>
<li>使用指针来处理命令行参数，就像处理<code>names</code>那样。</li>
<li>将获取值和获取地址组合到一起。</li>
<li>在程序末尾添加一个<code>for</code>循环，打印出这些指针所指向的地址。你需要在<code>printf</code>中使用<code>%p</code>。</li>
<li>对于每一种打印数组的方法，使用函数来重写程序。试着向函数传递指针来处理数据。记住你可以声明接受指针的函数，但是可以像数组那样用它。</li>
<li>将<code>for</code>循环改为<code>while</code>循环，并且观察对于每种指针用法哪种循环更方便。</li>
</ul>                            </section>
                        </div>
                        <div class="search-results">
                            <div class="has-results">
                                <h1 class="search-results-title">
                                    关于"<span class='search-query'></span>"的搜索结果共<span class='search-results-count'></span>条
                                </h1>
                                <ul class="search-results-list"></ul>
                            </div>
                            <div class="no-results">
                                <h1 class="search-results-title">没有"<span class='search-query'></span>"相关内容</h1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <a href="https://naka1205.github.io/lcthw/p/5D2945A8677CE165.html" class="navigation navigation-prev " aria-label="编写并使用函数">
            <i class="fa fa-angle-left"></i>
        </a>
                <a href="https://naka1205.github.io/lcthw/p/CDCC108031940336.html" class="navigation navigation-next " aria-label="结构体和指向它们的指针">
            <i class="fa fa-angle-right"></i>
        </a>
               
    </div>
<script>
var gitbook = gitbook || [];
gitbook.push(function() {
    gitbook.page.hasChanged({
        "page": {
            "title":  "指针，可怕的指针",
            "next": {
                "title": "结构体和指向它们的指针"
            },
            "previous": {
                "title": "编写并使用函数"
            }
        },
        "config": {
            "gitbook": "*",
            "theme": "default",
            "variables": {},
            "plugins": ["-lunr", "-search", "-highlight","search-pro"],
            "pluginsConfig": {
                "search-pro": {},
                "highlight": {},
                "sharing": {},
                "fontsettings": {},
                "theme-default": {}
            },
            "structure": {},
            "pdf": {},
            "styles": {}
        },
        "file": {},
        "gitbook": {},
        "basePath": "https://naka1205.github.io/lcthw",
        "book": {}
    });
});
</script>
</div>
<script src="https://naka1205.github.io/lcthw/assets/js/gitbook.js"></script>
<script src="https://naka1205.github.io/lcthw/assets/js/theme.js"></script>
<script src="https://naka1205.github.io/lcthw/assets/js/jquery.mark.min.js"></script>
<script src="https://naka1205.github.io/lcthw/assets/js/search.js"></script>
<script src="https://naka1205.github.io/lcthw/assets/js/buttons.js"></script>
<script src="https://naka1205.github.io/lcthw/assets/js/fontsettings.js"></script>
<script src="https://naka1205.github.io/lcthw/assets/js/plugin.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
</body>
</html>