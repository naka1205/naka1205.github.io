<!DOCTYPE HTML>
<html lang=""> 
<head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>故事大纲实例 · C++实例教程</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="耐心一点,等我们把前面介绍的所有内容都放进来,整个程序就算完工了,最后说明一下执行事件的script,实例在附赠光盘的“chapter9”文件夹底下。">
    <meta name="keywords" content="角色扮演 教程">
    <meta name="generator" content="PKBook">
    <link rel="stylesheet" href="https://naka1205.github.io/rpgsample/assets/css/style.css">
    <link rel="stylesheet" href="https://naka1205.github.io/rpgsample/assets/css/search.css">
    <link rel="stylesheet" href="https://naka1205.github.io/rpgsample/assets/css/ebook.css">
    <link rel="stylesheet" href="https://naka1205.github.io/rpgsample/assets/css/website.css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/github.min.css" rel="stylesheet">
    <meta name="HandheldFriendly" content="true" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://naka1205.github.io/rpgsample/assets/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="https://naka1205.github.io/rpgsample/assets/images/favicon.ico" type="image/x-icon">
</head>
<body>
<div class="book">
    <div class="book-summary">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="输入关键词搜索" />
        </div>
        <nav role="navigation">
    <ul class="summary">
        <li><a href="https://naka1205.github.io/rpgsample/index.html" target="blank" class="header">说明</a></li>
        <li class="divider"></li>
                <li class="header">写一个角色扮演游戏</li>
                        <li class="chapter " data-level="1.1" data-path="https://naka1205.github.io/rpgsample/p/FEEC8D8FB78C0C58.html"><a href="https://naka1205.github.io/rpgsample/p/FEEC8D8FB78C0C58.html">何谓角色扮演游戏（RPG）</a></li>
                        <li class="chapter " data-level="1.2" data-path="https://naka1205.github.io/rpgsample/p/BC79B4D3134C347C.html"><a href="https://naka1205.github.io/rpgsample/p/BC79B4D3134C347C.html">RPG分类</a></li>
                        <li class="chapter " data-level="1.3" data-path="https://naka1205.github.io/rpgsample/p/F20DC96FA50A49C7.html"><a href="https://naka1205.github.io/rpgsample/p/F20DC96FA50A49C7.html">写RPG时的软硬件需求</a></li>
                    <li class="divider"></li>
                <li class="header">游戏系统的设计</li>
                        <li class="chapter " data-level="2.1" data-path="https://naka1205.github.io/rpgsample/p/057DE479BA15F0C2.html"><a href="https://naka1205.github.io/rpgsample/p/057DE479BA15F0C2.html">RPG系统</a></li>
                        <li class="chapter " data-level="2.2" data-path="https://naka1205.github.io/rpgsample/p/98A9BEB4C06AB6F5.html"><a href="https://naka1205.github.io/rpgsample/p/98A9BEB4C06AB6F5.html">RPG的必备功能和设计</a></li>
                    <li class="divider"></li>
                <li class="header">Windows程序设计</li>
                        <li class="chapter " data-level="3.1" data-path="https://naka1205.github.io/rpgsample/p/29DEF3B121E67E34.html"><a href="https://naka1205.github.io/rpgsample/p/29DEF3B121E67E34.html">游戏的必备功能</a></li>
                        <li class="chapter " data-level="3.2" data-path="https://naka1205.github.io/rpgsample/p/E250E5C20EC8FDF3.html"><a href="https://naka1205.github.io/rpgsample/p/E250E5C20EC8FDF3.html">开启窗口</a></li>
                        <li class="chapter " data-level="3.3" data-path="https://naka1205.github.io/rpgsample/p/7FA5E0693CC56877.html"><a href="https://naka1205.github.io/rpgsample/p/7FA5E0693CC56877.html">显示CG</a></li>
                        <li class="chapter " data-level="3.4" data-path="https://naka1205.github.io/rpgsample/p/FF11E655570F0335.html"><a href="https://naka1205.github.io/rpgsample/p/FF11E655570F0335.html">显示CG的应用软件</a></li>
                        <li class="chapter " data-level="3.5" data-path="https://naka1205.github.io/rpgsample/p/FD772D011D420B30.html"><a href="https://naka1205.github.io/rpgsample/p/FD772D011D420B30.html">CG/Sprite的重叠显示</a></li>
                        <li class="chapter " data-level="3.6" data-path="https://naka1205.github.io/rpgsample/p/9505172717587147.html"><a href="https://naka1205.github.io/rpgsample/p/9505172717587147.html">贴图零件(sprite)显示</a></li>
                    <li class="divider"></li>
                <li class="header">显示地图和人物</li>
                        <li class="chapter " data-level="4.1" data-path="https://naka1205.github.io/rpgsample/p/D669497E6697FA89.html"><a href="https://naka1205.github.io/rpgsample/p/D669497E6697FA89.html">地图坐标系</a></li>
                        <li class="chapter " data-level="4.2" data-path="https://naka1205.github.io/rpgsample/p/CB9C77BD644B1669.html"><a href="https://naka1205.github.io/rpgsample/p/CB9C77BD644B1669.html">Sprite的显示</a></li>
                        <li class="chapter " data-level="4.3" data-path="https://naka1205.github.io/rpgsample/p/D4F60F30B7F0944A.html"><a href="https://naka1205.github.io/rpgsample/p/D4F60F30B7F0944A.html">显示的程序实例</a></li>
                    <li class="divider"></li>
                <li class="header">人物移动</li>
                        <li class="chapter " data-level="5.1" data-path="https://naka1205.github.io/rpgsample/p/9BDC29F23C108FCD.html"><a href="https://naka1205.github.io/rpgsample/p/9BDC29F23C108FCD.html">移动的思维方式</a></li>
                        <li class="chapter " data-level="5.2" data-path="https://naka1205.github.io/rpgsample/p/294F9E27361163C8.html"><a href="https://naka1205.github.io/rpgsample/p/294F9E27361163C8.html">移动的动画</a></li>
                        <li class="chapter " data-level="5.3" data-path="https://naka1205.github.io/rpgsample/p/850A8F5D7D49913A.html"><a href="https://naka1205.github.io/rpgsample/p/850A8F5D7D49913A.html">移动的程序实例</a></li>
                    <li class="divider"></li>
                <li class="header">战斗</li>
                        <li class="chapter " data-level="6.1" data-path="https://naka1205.github.io/rpgsample/p/714FCCE62BEAE7EF.html"><a href="https://naka1205.github.io/rpgsample/p/714FCCE62BEAE7EF.html">读入地图数据</a></li>
                        <li class="chapter " data-level="6.2" data-path="https://naka1205.github.io/rpgsample/p/DE18A13DD466BCF5.html"><a href="https://naka1205.github.io/rpgsample/p/DE18A13DD466BCF5.html">战斗规则</a></li>
                        <li class="chapter " data-level="6.3" data-path="https://naka1205.github.io/rpgsample/p/372F73F2A1CBD002.html"><a href="https://naka1205.github.io/rpgsample/p/372F73F2A1CBD002.html">攻击时的动画</a></li>
                        <li class="chapter " data-level="6.4" data-path="https://naka1205.github.io/rpgsample/p/D6377D95C3DAE065.html"><a href="https://naka1205.github.io/rpgsample/p/D6377D95C3DAE065.html">魔法攻击的处理</a></li>
                        <li class="chapter " data-level="6.5" data-path="https://naka1205.github.io/rpgsample/p/84AF096B75C4D0F4.html"><a href="https://naka1205.github.io/rpgsample/p/84AF096B75C4D0F4.html">CPU端的思维模式</a></li>
                        <li class="chapter " data-level="6.6" data-path="https://naka1205.github.io/rpgsample/p/ECD1A205E33A1347.html"><a href="https://naka1205.github.io/rpgsample/p/ECD1A205E33A1347.html">CPU端人物的攻击</a></li>
                        <li class="chapter " data-level="6.7" data-path="https://naka1205.github.io/rpgsample/p/FAC327CB74DDD86D.html"><a href="https://naka1205.github.io/rpgsample/p/FAC327CB74DDD86D.html">执行程序实例</a></li>
                    <li class="divider"></li>
                <li class="header">事件</li>
                        <li class="chapter " data-level="7.1" data-path="https://naka1205.github.io/rpgsample/p/9308712D0BA44B6C.html"><a href="https://naka1205.github.io/rpgsample/p/9308712D0BA44B6C.html">事件的执行方法</a></li>
                        <li class="chapter " data-level="7.2" data-path="https://naka1205.github.io/rpgsample/p/EA6BA727743E6636.html"><a href="https://naka1205.github.io/rpgsample/p/EA6BA727743E6636.html">命令的执行处理</a></li>
                        <li class="chapter " data-level="7.3" data-path="https://naka1205.github.io/rpgsample/p/1FD117B39A12879F.html"><a href="https://naka1205.github.io/rpgsample/p/1FD117B39A12879F.html">效果</a></li>
                    <li class="divider"></li>
                <li class="header">编辑参数</li>
                        <li class="chapter " data-level="8.1" data-path="https://naka1205.github.io/rpgsample/p/BE63E223F2902F52.html"><a href="https://naka1205.github.io/rpgsample/p/BE63E223F2902F52.html">参数</a></li>
                        <li class="chapter " data-level="8.2" data-path="https://naka1205.github.io/rpgsample/p/FCD874DB5CE467EB.html"><a href="https://naka1205.github.io/rpgsample/p/FCD874DB5CE467EB.html">参数编辑器</a></li>
                    <li class="divider"></li>
                <li class="header">大功告成</li>
                        <li class="chapter " data-level="9.1" data-path="https://naka1205.github.io/rpgsample/p/1107A00384B06596.html"><a href="https://naka1205.github.io/rpgsample/p/1107A00384B06596.html">增补其他功能</a></li>
                        <li class="chapter " data-level="9.2" data-path="https://naka1205.github.io/rpgsample/p/4E29E074EC583114.html"><a href="https://naka1205.github.io/rpgsample/p/4E29E074EC583114.html">从外部文件读入参数</a></li>
                        <li class="chapter " data-level="9.3" data-path="https://naka1205.github.io/rpgsample/p/466677A509CFE1D8.html"><a href="https://naka1205.github.io/rpgsample/p/466677A509CFE1D8.html">结合战斗部分和故事大纳</a></li>
                        <li class="chapter " data-level="9.4" data-path="https://naka1205.github.io/rpgsample/p/A7636FB800B97FD5.html"><a href="https://naka1205.github.io/rpgsample/p/A7636FB800B97FD5.html">播放音乐</a></li>
                        <li class="chapter " data-level="9.5" data-path="https://naka1205.github.io/rpgsample/p/6CB6CA31DF912DC1.html"><a href="https://naka1205.github.io/rpgsample/p/6CB6CA31DF912DC1.html">存储/装入</a></li>
                        <li class="chapter " data-level="9.6" data-path="https://naka1205.github.io/rpgsample/p/DFAF0C32BFFE733B.html"><a href="https://naka1205.github.io/rpgsample/p/DFAF0C32BFFE733B.html">播放音效</a></li>
                        <li class="chapter " data-level="9.7" data-path="https://naka1205.github.io/rpgsample/p/26C22A438848C588.html"><a href="https://naka1205.github.io/rpgsample/p/26C22A438848C588.html">提升等级</a></li>
                        <li class="chapter " data-level="9.8" data-path="https://naka1205.github.io/rpgsample/p/B5D1DD2411A4AD87.html"><a href="https://naka1205.github.io/rpgsample/p/B5D1DD2411A4AD87.html">直接跳跃</a></li>
                        <li class="chapter  active " data-level="9.9" data-path="https://naka1205.github.io/rpgsample/p/3F050F1718FBC3D8.html"><a href="https://naka1205.github.io/rpgsample/p/3F050F1718FBC3D8.html">故事大纲实例</a></li>
                    <li class="divider"></li>
                <li class="header">浅谈即时系统</li>
                        <li class="chapter " data-level="10.1" data-path="https://naka1205.github.io/rpgsample/p/3A99ECF04F2323C2.html"><a href="https://naka1205.github.io/rpgsample/p/3A99ECF04F2323C2.html">战略型即时系统的基本概念</a></li>
                    <li class="divider"></li>
                <li><a href="https://github.com/naka1205/pkbook" target="blank" class="gitbook-link">Published with PKBook</a></li>
    </ul>
</nav>
    </div>
    
    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
                <h1><i class="fa fa-circle-o-notch fa-spin"></i><a href="https://naka1205.github.io/rpgsample/p/3F050F1718FBC3D8.html">故事大纲实例</a></h1>
            </div>
            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                    <div id="book-search-results">
                        <div class="search-noresults">
                            <section class="normal markdown-section">
                                <h3 id="%E6%95%85%E4%BA%8B%E5%A4%A7%E7%BA%B2%E5%AE%9E%E4%BE%8B" name="%E6%95%85%E4%BA%8B%E5%A4%A7%E7%BA%B2%E5%AE%9E%E4%BE%8B">故事大纲实例</h3>
<p>耐心一点,等我们把前面介绍的所有内容都放进来,整个程序就算完工了,最后说明一下执行事件的script,实例在附赠光盘的“chapter9”文件夹底下。</p>
<p>请边看下面的事件故事大纲,边执行程序实例,这样会比较能了解命令的用法。如果认为“先看故事大纲反而降低兴致”,先执行程序实例之后再看故事大纲也无所谓。不过先声明,这个故事大纲是为了配合“程序说明”,所以“尽量不多占版面”,请不要过度期待能看到像“魔戒”那样场面浩大的冒险故事。</p>
<p>事大纲实例(main.txt)</p>
<pre><code class="C++">; 主选单
;
; 设为系统模式
; 这样就不能储存主选单
mode system

; 读入标题画面
load bg title
wipein

*mainloop

; 显示主选单
menu result
新游戏
继续游戏进度
游戏结束
end

if result == 1 goto start       ; 新游戏
if result == 2 goto continue        ; 继续游戏进度
if result == 3 goto end         ; 游戏结束
goto mainloop

*start                  ; 新游戏
  system clear              ; 清除参数
  exec start                ; 读入start.scr
goto mainloop

*continue               ; 继续游戏进度
  system load               ; 开启加载画面
goto mainloop

*end                    ; 游戏结束
  system exit               ; 应用软件结束
goto mainloop</code></pre>
<p>一激活程序,就会执行“main.txt”。利用这个script来打开主菜单。而主菜单其实就是利用一般的“menu”命令。</p>
<p>菜单的选择结果存储在变量result,根据这个结果再去“分支”。游戏本身写在“start.txt”,要用“exec”命令调用。</p>
<p>故事大纲实例(start.txt)</p>
<pre><code class="C++">wipeout                 ; 清除选单画面

load bg bg001           ; 把背景读入到内存
load ov priest_01       ; 把人物读入到内存

fadein                  ; 显示合成结果
                        ; 淡入处理
text
「勇者老大，接下来要去哪里？」
.


fadeout                 ; 清除画面

load bg map             ; 读入地图
load ov witch_02        ; 把人物读入到内存
wipein                  ; 显示

text
「这次的工作是消灭山里的怪物吧」
.

text
「北山有很多怪物，南山比较少」
.

text
「南山山里好像有会让北山怪物自动走避的果实，
要不要先去南山采果实再去打怪物呢？」
.

*loop1              ; 宣告标签「loop1」

clear ov
wipein

load work map_hot       ; 设定地图范围

*loop2

clear text

click result            ; 在点选位置分支
255 0 0                 ; 红
0 255 0                 ; 绿
0 0 255                 ; 蓝
255 255 0               ; 黄
0 255 255               ; 淡蓝
end

if result == 1 goto red
if result == 2 goto green
if result == 3 goto blue
if result == 4 goto yellow
if result == 5 goto cyan

;
; 不在地图之内
;
*cyan

text
「你在指哪里？」
.

text
「好奇怪的勇者…」
.

goto loop2

;
; 海边
;
*yellow

text
「来海边做什么？」
.

text
「那是反方向哦…」
.

goto loop2

;
; 城镇
;
*green

text
「刚刚才出城门而已」
.

text
「忘了带什么东西吗？」
.

text
「嗯，也不是那样子啦…」
.

goto loop2

*red

load ov witch_01        ; 把人物读入到内存
update ov

text
「喔，这样比较保险吧！」
.

load ov witch_03        ; 把人物读入到内存
update now

text
「好像有点丢勇者的脸…」
.

text
「既然决定了，那就赶快出发吧！」
.

goto battle

*blue

load ov priest_03       ; 把人物读入到内存
update ov

text
「啥米！」
.

text
「真的要先去北山吗？」
.

menu result
就是北山！
再考虑看看
end

if result == 2 goto loop1

load ov priest_01       ; 把人物读入到内存
update now

text
「要不要再考虑看看」
.

menu result
还是走吧
走走走，Go.Go.Go.
我就是勇者！
再考虑看看
end

if result == 4 goto loop1

load ov priest_02       ; 把人物读入到内存
update now

text
「真是没办法…」
.

clear ov
update wipe

load ov witch_04        ; 把人物读入到内存
update wipe

text
「真是的…」
.

mode system             ; 设为不可储存
battle map3             ; 没有胜算，会被打败

if battle == 1 goto win1

load ov witch_04        ; 把人物读入到内存
update wipe

text
「我不是老早就告诉你了吗……」
.

goto gameover

*win1

load ov priest_03       ; 把人物读入到内存
update wipe

text
「真是奇迹……」
.

goto end

;
; 以下是真正的故事内容
;
*battle

mode system             ; 设为不可储存
battle map1             ; 第1次战斗

if battle == 0 goto gameover

load ov witch_02        ; 把人物读入到内存
update wipe

text
「三两下就清洁溜溜喔」
.

mode scenario           ; 设为可储存
load bg bg001
load ov priest_01       ; 把人物读入到内存
wipein

text
「那么，取得果实朝北山出发吧」
.

fadeout

load bg bg001
fadein

load ov witch_02
update over

text
「去北山啰～」
.

text
「好快…」
.

load ov witch_03
update now

text
「还有很多问题的啦」
.

load ov witch_01
update now

text
「等等，好像有敌人」
.

battle map2             ; 第2次战斗

if battle == 0 goto gameover

load bg event           ; 若为事件，则将CG读入到BG
                        ; 后面均同
wipein

text
「太好了～」
.

text
「打赢了！」
.

text

        HAPPY END
.

goto end

;
; 游戏结束
;
*gameover

load ov gameover        ; 显示GAMEOVER
update wipe

sound A5_06179          ; 游戏结束的音效
wait 1                  ; 稍候一会

*end

end</code></pre>
<h4 id="%E6%95%85%E4%BA%8B%E5%A4%A7%E7%BA%B2%E8%AF%B4%E6%98%8E" name="%E6%95%85%E4%BA%8B%E5%A4%A7%E7%BA%B2%E8%AF%B4%E6%98%8E">故事大纲说明</h4>
<p>在这里我们挑一些故事大纲实例的重点部分做说明。</p>
<p>第一个分支是利用“click”命令。也可以选去了也没用的位置,不过因为故事大纲的编排关系,即使选了也去不成。可移动的只有“北山”和“南山”,选择北山时会显示文字内容的菜单。</p>
<p>北山是“map3”的战斗(随便乱设的而已),往南走会有“map1”战斗和“map2”战斗,最后显示事件CG(这才是正确的路线)。</p>
<p>事件CG并不是又另外写命令,只是读入到背景上,不使用重叠CG直接显示。CG的全画面显示也是同样的道理。</p>
<p>战斗结束后,不重新换过背景,只读入重叠CG后显示。这样的设计也可以进行“打败时的故事大纲”。</p>
<p>或许与其在这边解释得口沫横飞,不如请各位边看故事大纲、边执行程序还比要容易了解。因为战斗确实会打赢,所以照这样走也可以看得到结尾。</p>
<p>如果觉得这样太麻烦,请直接利用参数编辑器把敌方人物的HP降成1/2,就能轻松打赢啦!参数编辑器就在附赠光盘的“chapter/MAP”文件夹下面。</p>                            </section>
                        </div>
                        <div class="search-results">
                            <div class="has-results">
                                <h1 class="search-results-title">
                                    关于"<span class='search-query'></span>"的搜索结果共<span class='search-results-count'></span>条
                                </h1>
                                <ul class="search-results-list"></ul>
                            </div>
                            <div class="no-results">
                                <h1 class="search-results-title">没有"<span class='search-query'></span>"相关内容</h1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <a href="https://naka1205.github.io/rpgsample/p/B5D1DD2411A4AD87.html" class="navigation navigation-prev " aria-label="直接跳跃">
            <i class="fa fa-angle-left"></i>
        </a>
                <a href="https://naka1205.github.io/rpgsample/p/3A99ECF04F2323C2.html" class="navigation navigation-next " aria-label="战略型即时系统的基本概念">
            <i class="fa fa-angle-right"></i>
        </a>
               
    </div>
<script>
var gitbook = gitbook || [];
gitbook.push(function() {
    gitbook.page.hasChanged({
        "page": {
            "title":  "故事大纲实例",
            "next": {
                "title": "战略型即时系统的基本概念"
            },
            "previous": {
                "title": "直接跳跃"
            }
        },
        "config": {
            "gitbook": "*",
            "theme": "default",
            "variables": {},
            "plugins": ["-lunr", "-search", "-highlight","search-pro"],
            "pluginsConfig": {
                "search-pro": {},
                "highlight": {},
                "sharing": {},
                "fontsettings": {},
                "theme-default": {}
            },
            "structure": {},
            "pdf": {},
            "styles": {}
        },
        "file": {},
        "gitbook": {},
        "basePath": "https://naka1205.github.io/rpgsample",
        "book": {}
    });
});
</script>
</div>
<script src="https://naka1205.github.io/rpgsample/assets/js/gitbook.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/theme.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/jquery.mark.min.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/search.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/buttons.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/fontsettings.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/plugin.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
</body>
</html>