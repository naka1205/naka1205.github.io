<!DOCTYPE HTML>
<html lang=""> 
<head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>移动的动画 · C++实例教程</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="在处理人物的移动时,要是转瞬间就突然出现在移动位置,好像太单调了一点。一般人物造型可以让它“走过去”,而怪兽、机器人造型也可以边做什么动作、边移动过去,这样不是很有趣吗?">
    <meta name="keywords" content="角色扮演 教程">
    <meta name="generator" content="PKBook">
    <link rel="stylesheet" href="https://naka1205.github.io/rpgsample/assets/css/style.css">
    <link rel="stylesheet" href="https://naka1205.github.io/rpgsample/assets/css/search.css">
    <link rel="stylesheet" href="https://naka1205.github.io/rpgsample/assets/css/ebook.css">
    <link rel="stylesheet" href="https://naka1205.github.io/rpgsample/assets/css/website.css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/github.min.css" rel="stylesheet">
    <meta name="HandheldFriendly" content="true" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://naka1205.github.io/rpgsample/assets/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="https://naka1205.github.io/rpgsample/assets/images/favicon.ico" type="image/x-icon">
</head>
<body>
<div class="book">
    <div class="book-summary">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="输入关键词搜索" />
        </div>
        <nav role="navigation">
    <ul class="summary">
        <li><a href="https://naka1205.github.io/rpgsample/index.html" target="blank" class="header">说明</a></li>
        <li class="divider"></li>
                <li class="header">写一个角色扮演游戏</li>
                        <li class="chapter " data-level="1.1" data-path="https://naka1205.github.io/rpgsample/p/FEEC8D8FB78C0C58.html"><a href="https://naka1205.github.io/rpgsample/p/FEEC8D8FB78C0C58.html">何谓角色扮演游戏（RPG）</a></li>
                        <li class="chapter " data-level="1.2" data-path="https://naka1205.github.io/rpgsample/p/BC79B4D3134C347C.html"><a href="https://naka1205.github.io/rpgsample/p/BC79B4D3134C347C.html">RPG分类</a></li>
                        <li class="chapter " data-level="1.3" data-path="https://naka1205.github.io/rpgsample/p/F20DC96FA50A49C7.html"><a href="https://naka1205.github.io/rpgsample/p/F20DC96FA50A49C7.html">写RPG时的软硬件需求</a></li>
                    <li class="divider"></li>
                <li class="header">游戏系统的设计</li>
                        <li class="chapter " data-level="2.1" data-path="https://naka1205.github.io/rpgsample/p/057DE479BA15F0C2.html"><a href="https://naka1205.github.io/rpgsample/p/057DE479BA15F0C2.html">RPG系统</a></li>
                        <li class="chapter " data-level="2.2" data-path="https://naka1205.github.io/rpgsample/p/98A9BEB4C06AB6F5.html"><a href="https://naka1205.github.io/rpgsample/p/98A9BEB4C06AB6F5.html">RPG的必备功能和设计</a></li>
                    <li class="divider"></li>
                <li class="header">Windows程序设计</li>
                        <li class="chapter " data-level="3.1" data-path="https://naka1205.github.io/rpgsample/p/29DEF3B121E67E34.html"><a href="https://naka1205.github.io/rpgsample/p/29DEF3B121E67E34.html">游戏的必备功能</a></li>
                        <li class="chapter " data-level="3.2" data-path="https://naka1205.github.io/rpgsample/p/E250E5C20EC8FDF3.html"><a href="https://naka1205.github.io/rpgsample/p/E250E5C20EC8FDF3.html">开启窗口</a></li>
                        <li class="chapter " data-level="3.3" data-path="https://naka1205.github.io/rpgsample/p/7FA5E0693CC56877.html"><a href="https://naka1205.github.io/rpgsample/p/7FA5E0693CC56877.html">显示CG</a></li>
                        <li class="chapter " data-level="3.4" data-path="https://naka1205.github.io/rpgsample/p/FF11E655570F0335.html"><a href="https://naka1205.github.io/rpgsample/p/FF11E655570F0335.html">显示CG的应用软件</a></li>
                        <li class="chapter " data-level="3.5" data-path="https://naka1205.github.io/rpgsample/p/FD772D011D420B30.html"><a href="https://naka1205.github.io/rpgsample/p/FD772D011D420B30.html">CG/Sprite的重叠显示</a></li>
                        <li class="chapter " data-level="3.6" data-path="https://naka1205.github.io/rpgsample/p/9505172717587147.html"><a href="https://naka1205.github.io/rpgsample/p/9505172717587147.html">贴图零件(sprite)显示</a></li>
                    <li class="divider"></li>
                <li class="header">显示地图和人物</li>
                        <li class="chapter " data-level="4.1" data-path="https://naka1205.github.io/rpgsample/p/D669497E6697FA89.html"><a href="https://naka1205.github.io/rpgsample/p/D669497E6697FA89.html">地图坐标系</a></li>
                        <li class="chapter " data-level="4.2" data-path="https://naka1205.github.io/rpgsample/p/CB9C77BD644B1669.html"><a href="https://naka1205.github.io/rpgsample/p/CB9C77BD644B1669.html">Sprite的显示</a></li>
                        <li class="chapter " data-level="4.3" data-path="https://naka1205.github.io/rpgsample/p/D4F60F30B7F0944A.html"><a href="https://naka1205.github.io/rpgsample/p/D4F60F30B7F0944A.html">显示的程序实例</a></li>
                    <li class="divider"></li>
                <li class="header">人物移动</li>
                        <li class="chapter " data-level="5.1" data-path="https://naka1205.github.io/rpgsample/p/9BDC29F23C108FCD.html"><a href="https://naka1205.github.io/rpgsample/p/9BDC29F23C108FCD.html">移动的思维方式</a></li>
                        <li class="chapter  active " data-level="5.2" data-path="https://naka1205.github.io/rpgsample/p/294F9E27361163C8.html"><a href="https://naka1205.github.io/rpgsample/p/294F9E27361163C8.html">移动的动画</a></li>
                        <li class="chapter " data-level="5.3" data-path="https://naka1205.github.io/rpgsample/p/850A8F5D7D49913A.html"><a href="https://naka1205.github.io/rpgsample/p/850A8F5D7D49913A.html">移动的程序实例</a></li>
                    <li class="divider"></li>
                <li><a href="https://github.com/naka1205/pkbook" target="blank" class="gitbook-link">Published with PKBook</a></li>
    </ul>
</nav>
    </div>
    
    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
                <h1><i class="fa fa-circle-o-notch fa-spin"></i><a href="https://naka1205.github.io/rpgsample/p/294F9E27361163C8.html">移动的动画</a></h1>
            </div>
            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                    <div id="book-search-results">
                        <div class="search-noresults">
                            <section class="normal markdown-section">
                                <h3 id="%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%8A%A8%E7%94%BB" name="%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%8A%A8%E7%94%BB">移动的动画</h3>
<p>在处理人物的移动时,要是转瞬间就突然出现在移动位置,好像太单调了一点。一般人物造型可以让它“走过去”,而怪兽、机器人造型也可以边做什么动作、边移动过去,这样不是很有趣吗?</p>
<p>试试看吧,做个动画格式让人物大摇大摆的走过去。</p>
<h4 id="%E5%8A%A8%E7%94%BB%E6%A0%BC%E5%BC%8F" name="%E5%8A%A8%E7%94%BB%E6%A0%BC%E5%BC%8F">动画格式</h4>
<p>有脚的人物前进时,是两脚一左一右往前踏出去。</p>
<p>也就是说,只要不断切换右脚向前和左脚向前的CG,就能产生行走的视觉效果。但是两个动作之间总是要有其他动作帮忙串场,所以还要有一张两脚在同样位置的CG插在中间才会自然。动画格式的CG其实不需要太细微的小动作,中间衔接的CG只要拿站立静止姿势的CG就很好用了。</p>
<p>如图5-11不断重复“右一中间一左-中间-右……”,同时配合移动人物位置,步行的姿态就很自然了。</p>
<p>这个模式是所需CG图数量最少的步行模式。虽然说数量已经很少,但如图5-12所示,光一个移动的动作就需要12个不同模式的CG图。</p>
<p>当然如果你坚持慢工出细活,也没什么错,不过请先考虑一下每个出现的人物都要有4个方向的模式,制作得太精致反而会加重作业的负荷喔!</p>
<h4 id="%E7%99%BB%E5%BD%95%E5%8A%A8%E7%94%BB" name="%E7%99%BB%E5%BD%95%E5%8A%A8%E7%94%BB">登录动画</h4>
<p>移动是利用前面4个模式,按照“中间”一“右脚前”+“中间”一“左脚前”的顺序不断循环。因此把1个方格内的移动设成1个循环的话,以后只要用同一个模式即可,而且循环的结束动作若设为“中间CG”,停下来的时候就不需要特别做处理。</p>
<p>请根据这几个原则,想一想要如何寻找移动路线和登录动画。</p>
<pre><code class="C++">void MoveCharacter(int x, int y, int 步数)
{
    if(回到起点){
        return;         //结束
    }
    步数++;
    if(上一格的步数 == 步数){
        MoveCharacter(x, y-1, 步数);
        登录动画(下);
    }
    else if(下一格的步数 == 步数)){
        MoveCharacter(x, y+1, 步数);
        登录动画(上);
    }
    else if(左一格的步数 == 步数)){
        MoveCharacter(x-1, y, 步数);
        登录动画(右);
    }
    else if(右一格的步数 == 步数)){
        MoveCharacter(x+1, y, 步数);
        登录动画(左);
    }
}</code></pre>
<p>寻找路线是先找到“目前步数(脚印)+1”的步数的方格并移动过去,再回到起点后才算结束。寻找的顺序是“上一下一右一左”,往条件符合的方向前进。</p>
<p>这个部分也使用了递归。等到从MoveCharacter成员函数的调用返回之后,再把符合移动方向的动画登录到内存。</p>
<p>我们按照动作顺序走走看,假设抵达位置的坐标是(3,4),出发点坐标是(2,2),如图5-13所示。</p>
<p>整个寻找路线的处理可整理如下:</p>
<ul>
<li>先调用一开始的MoveCharacter(3,4,1)</li>
<li>因为“上一格”符合条件,故调用MoveCharacter(3,3,2)</li>
<li>因为“上一格”符合条件,故调用MoveCharacter(3,2,3)</li>
<li>因为“左一格”符合条件,故调用MoveCharacter(2,4)</li>
<li>此时,已经回到起点,故“return”</li>
<li>从MoveCharacter(2,2,4)返回,登录“动画(右)”</li>
<li>从MoveCharacter(3,2,3)返回,登录“动画(下)”</li>
<li>从MoveCharacter(3,3,2)返回,登录“动画(下)”</li>
<li>最后,从一开始的MoveCharacter(3,4,1)返回并结束</li>
</ul>
<p>我们得到的动画登录顺序是“右+一下”,照这样移动看看!从图5-13的④(坐标2,2)依照这个移动顺序出发,就会抵达①(坐标3,4)。原来“反序”登录是这个意思。</p>
<p>最后一个动作,利用计时器依序让已登录的动画模式在画面上跑,设定的人物就会开始步行移动。</p>
<hr />
<p>递归调用(recursivecall)</p>
<hr />
<p>有些人认为逆归调用是最难搞懂的部分之一,其实递归调用本身并没那么难,比较难懂的应该是使用时机。</p>
<p>“不知道怎么用,所以没用过”,“没用过,所以也没想过要去了解”,“没1下过功夫,所以还是一头家水”,怎样,听起来很熟悉吧?</p>
<p>递归调用中最常出现的就是“阶乘”,即“n!=n*(n-1)1(但n为1时,其值为1)”,写成程序则为:</p>
<pre><code class="C++">int factortal(int n)
{
    if(n == 1)
        return 1;
    return n * factortal(n-1);
}</code></pre>
<p>有时候利用循环可能还比递归调用更有效率,而且很多时候就算使用递归调用也不见得有什么好处,也许这就是一般人不太熟悉递归调用用法的最大理由。</p>
<p>就拿本书的程序实例来说,寻我移动范围(FindDistance)时利用递归调用会比较好写,但寻找移动顺序(MoveCharacter)若想用循环也是三两下就搞定。</p>
<p>先考虑用循环去写,若发现用循环结构可能会变得很复杂时,不妨改用逃归的概念反而可以化繁为简。觉得先考虑递归结构,遇到“尾端递归(tailrecursion)”时再改成循环当然也通喔!</p>
<p>尾端递归是指在处理的“尾端”做递归。</p>                            </section>
                        </div>
                        <div class="search-results">
                            <div class="has-results">
                                <h1 class="search-results-title">
                                    关于"<span class='search-query'></span>"的搜索结果共<span class='search-results-count'></span>条
                                </h1>
                                <ul class="search-results-list"></ul>
                            </div>
                            <div class="no-results">
                                <h1 class="search-results-title">没有"<span class='search-query'></span>"相关内容</h1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <a href="https://naka1205.github.io/rpgsample/p/9BDC29F23C108FCD.html" class="navigation navigation-prev " aria-label="移动的思维方式">
            <i class="fa fa-angle-left"></i>
        </a>
                <a href="https://naka1205.github.io/rpgsample/p/850A8F5D7D49913A.html" class="navigation navigation-next " aria-label="移动的程序实例">
            <i class="fa fa-angle-right"></i>
        </a>
               
    </div>
<script>
var gitbook = gitbook || [];
gitbook.push(function() {
    gitbook.page.hasChanged({
        "page": {
            "title":  "移动的动画",
            "next": {
                "title": "移动的程序实例"
            },
            "previous": {
                "title": "移动的思维方式"
            }
        },
        "config": {
            "gitbook": "*",
            "theme": "default",
            "variables": {},
            "plugins": ["-lunr", "-search", "-highlight","search-pro"],
            "pluginsConfig": {
                "search-pro": {},
                "highlight": {},
                "sharing": {},
                "fontsettings": {},
                "theme-default": {}
            },
            "structure": {},
            "pdf": {},
            "styles": {}
        },
        "file": {},
        "gitbook": {},
        "basePath": "https://naka1205.github.io/rpgsample",
        "book": {}
    });
});
</script>
</div>
<script src="https://naka1205.github.io/rpgsample/assets/js/gitbook.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/theme.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/jquery.mark.min.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/search.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/buttons.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/fontsettings.js"></script>
<script src="https://naka1205.github.io/rpgsample/assets/js/plugin.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
</body>
</html>